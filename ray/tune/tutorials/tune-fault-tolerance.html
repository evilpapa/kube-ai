
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>How to Enable Fault Tolerance in Ray Tune &#8212; Ray 2.7.2</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/versionwarning.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../_static/js/docsearch.js"></script>
    <script defer="defer" src="../../_static/js/csat.js"></script>
    <script defer="defer" src="../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../_static/js/custom.js"></script>
    <script defer="defer" src="../../_static/js/top-navigation.js"></script>
    <script src="../../_static/js/tags.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/tune/tutorials/tune-fault-tolerance.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="A Guide To Callbacks &amp; Metrics in Tune" href="tune-metrics.html" />
    <link rel="prev" title="How to Configure Persistent Storage in Ray Tune" href="tune-storage.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
  data-modal-disclaimer = "Results are automated and may be incorrect or contain inappropriate information. Do not include any personal data or confidential information."
  data-modal-title = "Ray Docs AI - Ask a Question"
  data-button-position-bottom = "60px"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 2.7.2</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    欢迎来到 Ray ！
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/index.html">
   概述「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/getting-started.html">
   入门
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/installation.html">
   安装「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/use-cases.html">
   用例「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/examples.html">
   示例库「1%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/ray-libraries.html">
   生态「3%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-core/walkthrough.html">
   Ray 核心「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data/data.html">
   Ray 数据「75%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../train/train.html">
   Ray 训练「0%」
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Ray 调参「0%」
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../getting-started.html">
     入门
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../key-concepts.html">
     关键概念
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="overview.html">
     用户指南
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="tune-run.html">
       运行基础实验
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tune-output.html">
       Logging and Outputs in Tune
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tune-resources.html">
       Setting Trial Resources
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tune-search-spaces.html">
       Using Search Spaces
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tune-stopping.html">
       How to Define Stopping Criteria for a Ray Tune Experiment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tune-trial-checkpoints.html">
       How to Save and Load Trial Checkpoints
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tune-storage.html">
       How to Configure Persistent Storage in Ray Tune
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       How to Enable Fault Tolerance in Ray Tune
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tune-metrics.html">
       Using Callbacks and Metrics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tune_get_data_in_and_out.html">
       Getting Data in and out of Tune
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../examples/tune_analyze_results.html">
       Analyzing Tune Experiment Results
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../examples/pbt_guide.html">
       A Guide to Population Based Training with Tune
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tune-distributed.html">
       Deploying Tune in the Cloud
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tune-lifecycle.html">
       Tune 架构
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tune-scalability.html">
       Scalability Benchmarks
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../examples/index.html">
     Ray Tune 示例
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../faq.html">
     Ray Tune 问答
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/api.html">
     Ray Tune API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-more-libs/index.html">
   更多类库「40%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cluster/getting-started.html">
   Ray 集群「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-observability/index.html">
   监控调试「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-references/api.html">
   参考「20%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-contribute/index.html">
   开发者指引「30%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-security/index.html">
   安全「100%」
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Ftune/tutorials/tune-fault-tolerance.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/tune/tutorials/tune-fault-tolerance.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/tune/tutorials/tune-fault-tolerance.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#experiment-level-fault-tolerance-in-tune">
   Experiment-level Fault Tolerance in Tune
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#restore-a-tune-experiment">
     Restore a Tune Experiment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#restore-configurations">
     Restore Configurations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#auto-resume">
     Auto-resume
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tune-experiment-restoration-with-ray-object-references-advanced">
     Tune Experiment Restoration with Ray Object References (Advanced)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#example">
       Example
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trial-level-fault-tolerance-in-tune">
   Trial-level Fault Tolerance in Tune
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>How to Enable Fault Tolerance in Ray Tune</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#experiment-level-fault-tolerance-in-tune">
   Experiment-level Fault Tolerance in Tune
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#restore-a-tune-experiment">
     Restore a Tune Experiment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#restore-configurations">
     Restore Configurations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#auto-resume">
     Auto-resume
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tune-experiment-restoration-with-ray-object-references-advanced">
     Tune Experiment Restoration with Ray Object References (Advanced)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#example">
       Example
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trial-level-fault-tolerance-in-tune">
   Trial-level Fault Tolerance in Tune
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="how-to-enable-fault-tolerance-in-ray-tune">
<span id="tune-fault-tolerance-ref"></span><h1>How to Enable Fault Tolerance in Ray Tune<a class="headerlink" href="#how-to-enable-fault-tolerance-in-ray-tune" title="Permalink to this headline">#</a></h1>
<p>Fault tolerance is an important feature for distributed machine learning experiments
that can help mitigate the impact of node failures due to out of memory and out of disk issues.</p>
<p>With fault tolerance, users can:</p>
<ul class="simple">
<li><p><strong>Save time and resources by preserving training progress</strong> even if a node fails.</p></li>
<li><p><strong>Access the cost savings of preemptible spot instance nodes</strong> in the distributed setting.</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>In a <em>distributed</em> Tune experiment, a prerequisite to enabling fault tolerance
is configuring some form of persistent storage where all trial results and
checkpoints can be consolidated. See <a class="reference internal" href="tune-storage.html#tune-storage-options"><span class="std std-ref">How to Configure Persistent Storage in Ray Tune</span></a>.</p>
</div>
<p>In this guide, we will cover how to enable different types of fault tolerance offered by Ray Tune.</p>
<section id="experiment-level-fault-tolerance-in-tune">
<span id="tune-experiment-level-fault-tolerance"></span><h2>Experiment-level Fault Tolerance in Tune<a class="headerlink" href="#experiment-level-fault-tolerance-in-tune" title="Permalink to this headline">#</a></h2>
<p>At the experiment level, <a class="reference internal" href="../api/doc/ray.tune.Tuner.restore.html#ray.tune.Tuner.restore" title="ray.tune.Tuner.restore"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tuner.restore</span></code></a>
resumes a previously interrupted experiment from where it left off.</p>
<p>You should use <a class="reference internal" href="../api/doc/ray.tune.Tuner.restore.html#ray.tune.Tuner.restore" title="ray.tune.Tuner.restore"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tuner.restore</span></code></a> in the following cases:</p>
<ol class="arabic simple">
<li><p>The driver script that calls <a class="reference internal" href="../api/doc/ray.tune.Tuner.fit.html#ray.tune.Tuner.fit" title="ray.tune.Tuner.fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tuner.fit()</span></code></a> errors out (e.g., due to the head node running out of memory or out of disk).</p></li>
<li><p>The experiment is manually interrupted with <code class="docutils literal notranslate"><span class="pre">Ctrl+C</span></code>.</p></li>
<li><p>The entire cluster, and the experiment along with it, crashes due to an ephemeral error such as the network going down or Ray object store memory filling up.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../api/doc/ray.tune.Tuner.restore.html#ray.tune.Tuner.restore" title="ray.tune.Tuner.restore"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tuner.restore</span></code></a> is <em>not</em> meant for resuming a terminated
experiment and modifying hyperparameter search spaces or stopping criteria.
Rather, experiment restoration is meant to resume and complete the <em>exact job</em>
that was previously submitted via <a class="reference internal" href="../api/doc/ray.tune.Tuner.fit.html#ray.tune.Tuner.fit" title="ray.tune.Tuner.fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tuner.fit</span></code></a>.</p>
<p>For example, consider a Tune experiment configured to run for <code class="docutils literal notranslate"><span class="pre">10</span></code> training iterations,
where all trials have already completed.
<a class="reference internal" href="../api/doc/ray.tune.Tuner.restore.html#ray.tune.Tuner.restore" title="ray.tune.Tuner.restore"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tuner.restore</span></code></a> cannot be used to restore the experiment,
change the number of training iterations to <code class="docutils literal notranslate"><span class="pre">20</span></code>, then continue training.</p>
<p>Instead, this should be achieved by starting a <em>new</em> experiment and initializing
your model weights with a checkpoint from the previous experiment.
See <a class="reference internal" href="../faq.html#tune-iterative-experimentation"><span class="std std-ref">this FAQ post</span></a> for an example.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Bugs in your user-defined training loop cannot be fixed with restoration. Instead, the issue
that caused the experiment to crash in the first place should be <em>ephemeral</em>,
meaning that the retry attempt after restoring can succeed the next time.</p>
</div>
<section id="restore-a-tune-experiment">
<span id="tune-experiment-restore-example"></span><h3>Restore a Tune Experiment<a class="headerlink" href="#restore-a-tune-experiment" title="Permalink to this headline">#</a></h3>
<p>Let’s say your initial Tune experiment is configured as follows.
The actual training loop is just for demonstration purposes: the important detail is that
<a class="reference internal" href="tune-trial-checkpoints.html#tune-trial-checkpoint"><span class="std std-ref">saving and loading checkpoints has been implemented in the trainable</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">train</span><span class="p">,</span> <span class="n">tune</span>
<span class="kn">from</span> <span class="nn">ray.train</span> <span class="kn">import</span> <span class="n">Checkpoint</span>


<span class="k">def</span> <span class="nf">trainable</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="c1"># Checkpoint loading</span>
    <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">get_checkpoint</span><span class="p">()</span>
    <span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">checkpoint</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">checkpoint</span><span class="o">.</span><span class="n">as_directory</span><span class="p">()</span> <span class="k">as</span> <span class="n">checkpoint_dir</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">checkpoint_dir</span><span class="p">,</span> <span class="s2">&quot;checkpoint.json&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;num_epochs&quot;</span><span class="p">]):</span>
        <span class="c1"># Do some training...</span>

        <span class="c1"># Checkpoint saving</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_checkpoint_dir</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_checkpoint_dir</span><span class="p">,</span> <span class="s2">&quot;checkpoint.json&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="s2">&quot;epoch&quot;</span><span class="p">:</span> <span class="n">epoch</span><span class="p">},</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">train</span><span class="o">.</span><span class="n">report</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;epoch&quot;</span><span class="p">:</span> <span class="n">epoch</span><span class="p">},</span>
                <span class="n">checkpoint</span><span class="o">=</span><span class="n">Checkpoint</span><span class="o">.</span><span class="n">from_directory</span><span class="p">(</span><span class="n">temp_checkpoint_dir</span><span class="p">),</span>
            <span class="p">)</span>


<span class="n">tuner</span> <span class="o">=</span> <span class="n">tune</span><span class="o">.</span><span class="n">Tuner</span><span class="p">(</span>
    <span class="n">trainable</span><span class="p">,</span>
    <span class="n">param_space</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_epochs&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
    <span class="n">run_config</span><span class="o">=</span><span class="n">train</span><span class="o">.</span><span class="n">RunConfig</span><span class="p">(</span>
        <span class="n">storage_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/ray_results&quot;</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;tune_fault_tolerance_guide&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">result_grid</span> <span class="o">=</span> <span class="n">tuner</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p>The results and checkpoints of the experiment are saved to <code class="docutils literal notranslate"><span class="pre">~/ray_results/tune_fault_tolerance_guide</span></code>,
as configured by <a class="reference internal" href="../../train/api/doc/ray.train.RunConfig.html#ray.train.RunConfig" title="ray.train.RunConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">RunConfig</span></code></a>.
If the experiment has been interrupted due to one of the reasons listed above, use this path to resume:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tuner</span> <span class="o">=</span> <span class="n">tune</span><span class="o">.</span><span class="n">Tuner</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/ray_results/tune_fault_tolerance_guide&quot;</span><span class="p">),</span>
    <span class="n">trainable</span><span class="o">=</span><span class="n">trainable</span><span class="p">,</span>
    <span class="n">resume_errored</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">tuner</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can also restore the experiment from a cloud bucket path:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tuner</span> <span class="o">=</span> <span class="n">tune</span><span class="o">.</span><span class="n">Tuner</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;s3://cloud-bucket/tune_fault_tolerance_guide&quot;</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="n">trainable</span>
<span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="tune-storage.html#tune-storage-options"><span class="std std-ref">How to Configure Persistent Storage in Ray Tune</span></a>.</p>
</div>
</section>
<section id="restore-configurations">
<h3>Restore Configurations<a class="headerlink" href="#restore-configurations" title="Permalink to this headline">#</a></h3>
<p>Tune allows configuring which trials should be resumed, based on their status when the experiment was interrupted:</p>
<ul class="simple">
<li><p>Unfinished trials left in the <code class="docutils literal notranslate"><span class="pre">RUNNING</span></code> state will be resumed by default.</p></li>
<li><p>Trials that have <code class="docutils literal notranslate"><span class="pre">ERRORED</span></code> can be resumed or retried from scratch.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TERMINATED</span></code> trials <em>cannot</em> be resumed.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tuner</span> <span class="o">=</span> <span class="n">tune</span><span class="o">.</span><span class="n">Tuner</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/ray_results/tune_fault_tolerance_guide&quot;</span><span class="p">),</span>
    <span class="n">trainable</span><span class="o">=</span><span class="n">trainable</span><span class="p">,</span>
    <span class="n">resume_errored</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">restart_errored</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">resume_unfinished</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="auto-resume">
<span id="tune-experiment-autoresume-example"></span><h3>Auto-resume<a class="headerlink" href="#auto-resume" title="Permalink to this headline">#</a></h3>
<p>When running in a production setting, one may want a <em>single script</em> that (1) launches the
initial training run in the beginning and (2) restores the experiment if (1) already happened.</p>
<p>Use the <a class="reference internal" href="../api/doc/ray.tune.Tuner.can_restore.html#ray.tune.Tuner.can_restore" title="ray.tune.Tuner.can_restore"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tuner.can_restore</span></code></a> utility to accomplish this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">train</span><span class="p">,</span> <span class="n">tune</span>

<span class="n">storage_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/ray_results&quot;</span><span class="p">)</span>
<span class="n">exp_name</span> <span class="o">=</span> <span class="s2">&quot;tune_fault_tolerance_guide&quot;</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">storage_path</span><span class="p">,</span> <span class="n">exp_name</span><span class="p">)</span>

<span class="k">if</span> <span class="n">tune</span><span class="o">.</span><span class="n">Tuner</span><span class="o">.</span><span class="n">can_restore</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">tuner</span> <span class="o">=</span> <span class="n">tune</span><span class="o">.</span><span class="n">Tuner</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="n">trainable</span><span class="p">,</span> <span class="n">resume_errored</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">tuner</span> <span class="o">=</span> <span class="n">tune</span><span class="o">.</span><span class="n">Tuner</span><span class="p">(</span>
        <span class="n">trainable</span><span class="p">,</span>
        <span class="n">param_space</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_epochs&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
        <span class="n">run_config</span><span class="o">=</span><span class="n">train</span><span class="o">.</span><span class="n">RunConfig</span><span class="p">(</span><span class="n">storage_path</span><span class="o">=</span><span class="n">storage_path</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">exp_name</span><span class="p">),</span>
    <span class="p">)</span>
<span class="n">tuner</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p>Running this script the first time will launch the initial training run.
Running this script the second time will attempt to resume from the outputs of the first run.</p>
</section>
<section id="tune-experiment-restoration-with-ray-object-references-advanced">
<h3>Tune Experiment Restoration with Ray Object References (Advanced)<a class="headerlink" href="#tune-experiment-restoration-with-ray-object-references-advanced" title="Permalink to this headline">#</a></h3>
<p>Experiment restoration often happens in a different Ray session than the original run,
in which case Ray object references are automatically garbage collected.
If object references are saved along with experiment state (e.g., within each trial’s config),
then attempting to retrieve theses objects will not work properly after restoration:
the objects these references point to no longer exist.</p>
<p>To work around this, you must re-create these objects, put them in the Ray object store,
and then pass the new object references to Tune.</p>
<section id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">#</a></h4>
<p>Let’s say we have some large pre-trained model that we want to use in some way in our training loop.
For example, this could be a image classification model used to calculate an Inception Score
to evaluate the quality of a generative model.
We may have multiple models that we want to tune over, where each trial samples one of the models to use.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">train</span><span class="p">,</span> <span class="n">tune</span>


<span class="k">class</span> <span class="nc">LargeModel</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span> <span class="o">=</span> <span class="n">model_id</span>
        <span class="c1"># Load weights based on the `model_id`...</span>


<span class="k">def</span> <span class="nf">train_fn</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="c1"># Retrieve the model from the object store.</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;model_ref&quot;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_id</span><span class="p">)</span>


<span class="c1"># These models may be large, so `ray.put` them in the Ray Object Store</span>
<span class="c1"># to share the models between trials.</span>
<span class="n">model_refs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ray</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">LargeModel</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">ray</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">LargeModel</span><span class="p">(</span><span class="mi">2</span><span class="p">))]</span>

<span class="n">tuner</span> <span class="o">=</span> <span class="n">tune</span><span class="o">.</span><span class="n">Tuner</span><span class="p">(</span>
    <span class="n">train_fn</span><span class="p">,</span>
    <span class="c1"># Tune over the object references!</span>
    <span class="n">param_space</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;model_ref&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">grid_search</span><span class="p">(</span><span class="n">model_refs</span><span class="p">)},</span>
    <span class="n">run_config</span><span class="o">=</span><span class="n">train</span><span class="o">.</span><span class="n">RunConfig</span><span class="p">(</span>
        <span class="n">storage_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/ray_results&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;restore_object_refs&quot;</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">tuner</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p>To restore, we just need to re-specify the <code class="docutils literal notranslate"><span class="pre">param_space</span></code> via <a class="reference internal" href="../api/doc/ray.tune.Tuner.restore.html#ray.tune.Tuner.restore" title="ray.tune.Tuner.restore"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tuner.restore</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Re-create the objects and put them in the object store.</span>
<span class="n">param_space</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;model_ref&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">grid_search</span><span class="p">([</span><span class="n">ray</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">LargeModel</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">ray</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">LargeModel</span><span class="p">(</span><span class="mi">2</span><span class="p">))])</span>
<span class="p">}</span>

<span class="n">tuner</span> <span class="o">=</span> <span class="n">tune</span><span class="o">.</span><span class="n">Tuner</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/ray_results/restore_object_refs&quot;</span><span class="p">),</span>
    <span class="n">trainable</span><span class="o">=</span><span class="n">train_fn</span><span class="p">,</span>
    <span class="c1"># Re-specify the `param_space` to update the object references.</span>
    <span class="n">param_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span>
    <span class="n">resume_errored</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">tuner</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you’re tuning over <a class="reference internal" href="../../data/data.html#data"><span class="std std-ref">Ray Data</span></a>, you’ll also need to re-specify them in the <code class="docutils literal notranslate"><span class="pre">param_space</span></code>.
Ray Data can contain object references, so the same problems described above apply.</p>
<p>See below for an example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ds_1</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">from_items</span><span class="p">([{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">)])</span>
<span class="n">ds_2</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">from_items</span><span class="p">([{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">i</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">)])</span>

<span class="n">param_space</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;datasets&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">grid_search</span><span class="p">([</span><span class="n">ds_1</span><span class="p">,</span> <span class="n">ds_2</span><span class="p">])},</span>
<span class="p">}</span>

<span class="n">tuner</span> <span class="o">=</span> <span class="n">tune</span><span class="o">.</span><span class="n">Tuner</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">param_space</span><span class="o">=</span><span class="n">param_space</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
</section>
<section id="trial-level-fault-tolerance-in-tune">
<span id="tune-trial-level-fault-tolerance"></span><h2>Trial-level Fault Tolerance in Tune<a class="headerlink" href="#trial-level-fault-tolerance-in-tune" title="Permalink to this headline">#</a></h2>
<p>Trial-level fault tolerance deals with individual trial failures in the cluster, which can be caused by:</p>
<ul class="simple">
<li><p>Running with preemptible spot instances.</p></li>
<li><p>Ephemeral network connection issues.</p></li>
<li><p>Nodes running out of memory or out of disk space.</p></li>
</ul>
<p>Ray Tune provides a way to configure failure handling of individual trials with the <a class="reference internal" href="../../train/api/doc/ray.train.FailureConfig.html#ray.train.FailureConfig" title="ray.train.FailureConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">FailureConfig</span></code></a>.</p>
<p>Assuming that we’re using the <code class="docutils literal notranslate"><span class="pre">trainable</span></code> from the previous example that implements
trial checkpoint saving and loading, here is how to configure <a class="reference internal" href="../../train/api/doc/ray.train.FailureConfig.html#ray.train.FailureConfig" title="ray.train.FailureConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">FailureConfig</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">train</span><span class="p">,</span> <span class="n">tune</span>

<span class="n">tuner</span> <span class="o">=</span> <span class="n">tune</span><span class="o">.</span><span class="n">Tuner</span><span class="p">(</span>
    <span class="n">trainable</span><span class="p">,</span>
    <span class="n">param_space</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_epochs&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
    <span class="n">run_config</span><span class="o">=</span><span class="n">train</span><span class="o">.</span><span class="n">RunConfig</span><span class="p">(</span>
        <span class="n">storage_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/ray_results&quot;</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;trial_fault_tolerance&quot;</span><span class="p">,</span>
        <span class="n">failure_config</span><span class="o">=</span><span class="n">train</span><span class="o">.</span><span class="n">FailureConfig</span><span class="p">(</span><span class="n">max_failures</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">tuner</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p>When a trial encounters a runtime error, the above configuration will re-schedule that trial
up to <code class="docutils literal notranslate"><span class="pre">max_failures=3</span></code> times.</p>
<p>Similarly, if a node failure occurs for node <code class="docutils literal notranslate"><span class="pre">X</span></code> (e.g., pre-empted or lost connection),
this configuration will reschedule all trials that lived on node <code class="docutils literal notranslate"><span class="pre">X</span></code> up to <code class="docutils literal notranslate"><span class="pre">3</span></code> times.</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">#</a></h2>
<p>In this user guide, we covered how to enable experiment-level and trial-level fault tolerance in Ray Tune.</p>
<p>See the following resources for more information:</p>
<ul class="simple">
<li><p><a class="reference internal" href="tune-storage.html#tune-storage-options"><span class="std std-ref">How to Configure Persistent Storage in Ray Tune</span></a></p></li>
<li><p><a class="reference internal" href="tune-distributed.html#tune-distributed-ref"><span class="std std-ref">Running Distributed Experiments with Ray Tune</span></a></p></li>
<li><p><a class="reference internal" href="tune-trial-checkpoints.html#tune-trial-checkpoint"><span class="std std-ref">How to Save and Load Trial Checkpoints</span></a></p></li>
</ul>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="tune-storage.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">How to Configure Persistent Storage in Ray Tune</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="tune-metrics.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">A Guide To Callbacks &amp; Metrics in Tune</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><!-- Override the footer area for the sphinx-book-theme to include the CSAT widget -->
<div id="csat">
  <div id="csat-feedback-received" class="csat-hidden">
    <span>谢谢你的反馈！</span>
  </div>
  <div id="csat-inputs">
    <span>是否能帮助到你？</span>
    <div id="csat-yes" class="csat-button">
      <svg id="csat-yes-icon" class="csat-hidden csat-icon" width="18" height="13" viewBox="0 0 18 13" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.00023 10.172L16.1922 0.979004L17.6072 2.393L7.00023 13L0.63623 6.636L2.05023 5.222L7.00023 10.172Z" fill="black"/>
      </svg>
      <span>是<span>
    </div>
    <div id="csat-no" class="csat-button">
      <svg id="csat-no-icon" class="csat-hidden csat-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.00023 5.58599L11.9502 0.635986L13.3642 2.04999L8.41423 6.99999L13.3642 11.95L11.9502 13.364L7.00023 8.41399L2.05023 13.364L0.63623 11.95L5.58623 6.99999L0.63623 2.04999L2.05023 0.635986L7.00023 5.58599Z" fill="black"/>
      </svg>
      <span>否<span>
    </div>
  </div>
  <div id="csat-textarea-group" class="csat-hidden">
    <span id="csat-feedback-label">反馈</span>
    <textarea id="csat-textarea"></textarea>
    <div id="csat-submit">提交</div>
  </div>
</div><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2024, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>