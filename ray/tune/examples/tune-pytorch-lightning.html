
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Using PyTorch Lightning with Tune &#8212; Ray 2.7.2</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/versionwarning.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../_static/js/docsearch.js"></script>
    <script defer="defer" src="../../_static/js/csat.js"></script>
    <script defer="defer" src="../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../_static/js/custom.js"></script>
    <script defer="defer" src="../../_static/js/top-navigation.js"></script>
    <script src="../../_static/js/tags.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/tune/examples/tune-pytorch-lightning.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Model selection and serving with Ray Tune and Ray Serve" href="tune-serve-integration-mnist.html" />
    <link rel="prev" title="How to use Tune with PyTorch" href="tune-pytorch-cifar.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
  data-modal-disclaimer = "Results are automated and may be incorrect or contain inappropriate information. Do not include any personal data or confidential information."
  data-modal-title = "Ray Docs AI - Ask a Question"
  data-button-position-bottom = "60px"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 2.7.2</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    欢迎来到 Ray ！
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/index.html">
   概述「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/getting-started.html">
   入门
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/installation.html">
   安装「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/use-cases.html">
   用例「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/examples.html">
   示例库「1%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/ray-libraries.html">
   生态「3%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-core/walkthrough.html">
   Ray 核心「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data/data.html">
   Ray 数据「75%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../train/train.html">
   Ray 训练「0%」
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Ray 调参「0%」
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../getting-started.html">
     入门
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../key-concepts.html">
     关键概念
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/overview.html">
     用户指南
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="index.html">
     Ray Tune 示例
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3 current active has-children">
      <a class="reference internal" href="ml-frameworks.html">
       Examples using Ray Tune with ML Frameworks
      </a>
      <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul class="current">
       <li class="toctree-l4">
        <a class="reference internal" href="tune-sklearn.html">
         Scikit-Learn 示例
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="tune_mnist_keras.html">
         Keras 示例
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="tune-pytorch-cifar.html">
         PyTorch 示例
        </a>
       </li>
       <li class="toctree-l4 current active">
        <a class="current reference internal" href="#">
         PyTorch Lightning 示例
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="tune-serve-integration-mnist.html">
         Ray Serve 示例
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="pbt_ppo_example.html">
         Ray RLlib 示例
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="tune-xgboost.html">
         XGBoost 示例
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="lightgbm_example.html">
         LightGBM 示例
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="horovod_simple.html">
         Horovod 示例
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="pbt_transformers.html">
         Hugging Face Transformers 示例
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="experiment-tracking.html">
       Tune Experiment Tracking Examples
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hpo-frameworks.html">
       Tune Hyperparameter Optimization Framework Examples
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="other-examples.html">
       其他示例
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="exercises.html">
       练习
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../faq.html">
     Ray Tune 问答
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/api.html">
     Ray Tune API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-more-libs/index.html">
   更多类库「40%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cluster/getting-started.html">
   Ray 集群「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-observability/index.html">
   监控调试「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-references/api.html">
   参考「20%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-contribute/index.html">
   开发者指引「30%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-security/index.html">
   安全「100%」
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Ftune/examples/tune-pytorch-lightning.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/tune/examples/tune-pytorch-lightning.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/tune/examples/tune-pytorch-lightning.ipynb.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytorch-lightning-classifier-for-mnist">
   PyTorch Lightning classifier for MNIST
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tuning-the-model-parameters">
   Tuning the model parameters
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configuring-the-search-space">
     Configuring the search space
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selecting-a-scheduler">
     Selecting a scheduler
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#training-with-gpus">
     Training with GPUs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#putting-it-together">
     Putting it together
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-pytorch-lightning-examples">
   More PyTorch Lightning Examples
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Using PyTorch Lightning with Tune</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytorch-lightning-classifier-for-mnist">
   PyTorch Lightning classifier for MNIST
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tuning-the-model-parameters">
   Tuning the model parameters
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configuring-the-search-space">
     Configuring the search space
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selecting-a-scheduler">
     Selecting a scheduler
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#training-with-gpus">
     Training with GPUs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#putting-it-together">
     Putting it together
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-pytorch-lightning-examples">
   More PyTorch Lightning Examples
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="using-pytorch-lightning-with-tune">
<h1>Using PyTorch Lightning with Tune<a class="headerlink" href="#using-pytorch-lightning-with-tune" title="Permalink to this headline">#</a></h1>
<p id="tune-pytorch-lightning-ref">PyTorch Lightning is a framework which brings structure into training PyTorch models. It aims to avoid boilerplate code, so you don’t have to write the same training loops all over again when building a new model.</p>
<img alt="../../_images/pytorch_lightning_full.png" class="align-center" src="../../_images/pytorch_lightning_full.png" />
<p>The main abstraction of PyTorch Lightning is the <code class="docutils literal notranslate"><span class="pre">LightningModule</span></code> class, which should be extended by your application. There is <a class="reference external" href="https://towardsdatascience.com/from-pytorch-to-pytorch-lightning-a-gentle-introduction-b371b7caaf09">a great post on how to transfer your models from vanilla PyTorch to Lightning</a>.</p>
<p>The class structure of PyTorch Lightning makes it very easy to define and tune model parameters. This tutorial will show you how to use Tune with Ray Train’s <a class="reference internal" href="../../train/api/doc/ray.train.torch.TorchTrainer.html#ray.train.torch.TorchTrainer" title="ray.train.torch.TorchTrainer"><code class="xref py py-class docutils literal notranslate"><span class="pre">TorchTrainer</span></code></a> to find the best set of parameters for your application on the example of training a MNIST classifier. Notably, the <code class="docutils literal notranslate"><span class="pre">LightningModule</span></code> does not have to be altered at all for this - so you can use it plug and play for your existing models, assuming their parameters are configurable!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run this example, you will need to install the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install <span class="s2">&quot;ray[tune]&quot;</span> torch torchvision pytorch_lightning
</pre></div>
</div>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#pytorch-lightning-classifier-for-mnist" id="id1">PyTorch Lightning classifier for MNIST</a></p></li>
<li><p><a class="reference internal" href="#tuning-the-model-parameters" id="id2">Tuning the model parameters</a></p>
<ul>
<li><p><a class="reference internal" href="#configuring-the-search-space" id="id3">Configuring the search space</a></p></li>
<li><p><a class="reference internal" href="#selecting-a-scheduler" id="id4">Selecting a scheduler</a></p></li>
<li><p><a class="reference internal" href="#training-with-gpus" id="id5">Training with GPUs</a></p></li>
<li><p><a class="reference internal" href="#putting-it-together" id="id6">Putting it together</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#more-pytorch-lightning-examples" id="id7">More PyTorch Lightning Examples</a></p></li>
</ul>
</div>
<section id="pytorch-lightning-classifier-for-mnist">
<h2>PyTorch Lightning classifier for MNIST<a class="headerlink" href="#pytorch-lightning-classifier-for-mnist" title="Permalink to this headline">#</a></h2>
<p>Let’s first start with the basic PyTorch Lightning implementation of an MNIST classifier. This classifier does not include any tuning code at this point.</p>
<p>First, we run some imports:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">pytorch_lightning</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">from</span> <span class="nn">filelock</span> <span class="kn">import</span> <span class="n">FileLock</span>
<span class="kn">from</span> <span class="nn">torchmetrics</span> <span class="kn">import</span> <span class="n">Accuracy</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">random_split</span>
<span class="kn">from</span> <span class="nn">torchvision.datasets</span> <span class="kn">import</span> <span class="n">MNIST</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">transforms</span>
</pre></div>
</div>
</div>
</div>
<p>Our example builds on the MNIST example from the <a class="reference external" href="https://towardsdatascience.com/from-pytorch-to-pytorch-lightning-a-gentle-introduction-b371b7caaf09">blog post</a> we mentioned before. We adapted the original model and dataset definitions into <code class="docutils literal notranslate"><span class="pre">MNISTClassifier</span></code> and <code class="docutils literal notranslate"><span class="pre">MNISTDataModule</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MNISTClassifier</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">LightningModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MNISTClassifier</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span> <span class="o">=</span> <span class="n">Accuracy</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;multiclass&quot;</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_1_size</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;layer_1_size&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_2_size</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;layer_2_size&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;lr&quot;</span><span class="p">]</span>

        <span class="c1"># mnist images are (1, 28, 28) (channels, width, height)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span> <span class="o">*</span> <span class="mi">28</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_1_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_1_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_2_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_3</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_2_size</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_loss</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_accuracy</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">cross_entropy_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logits</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">nll_loss</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">batch_size</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">training_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">train_batch</span>
        <span class="n">logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_entropy_loss</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;ptl/train_loss&quot;</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;ptl/train_accuracy&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loss</span>

    <span class="k">def</span> <span class="nf">validation_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val_batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">val_batch</span>
        <span class="n">logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_entropy_loss</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_loss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_accuracy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;val_loss&quot;</span><span class="p">:</span> <span class="n">loss</span><span class="p">,</span> <span class="s2">&quot;val_accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">on_validation_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">avg_loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_loss</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">avg_acc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_accuracy</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;ptl/val_loss&quot;</span><span class="p">,</span> <span class="n">avg_loss</span><span class="p">,</span> <span class="n">sync_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;ptl/val_accuracy&quot;</span><span class="p">,</span> <span class="n">avg_acc</span><span class="p">,</span> <span class="n">sync_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_loss</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_accuracy</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">configure_optimizers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">optimizer</span>


<span class="k">class</span> <span class="nc">MNISTDataModule</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">LightningDataModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
            <span class="p">[</span><span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">((</span><span class="mf">0.1307</span><span class="p">,),</span> <span class="p">(</span><span class="mf">0.3081</span><span class="p">,))]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">FileLock</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="si">}</span><span class="s2">.lock&quot;</span><span class="p">):</span>
            <span class="n">mnist</span> <span class="o">=</span> <span class="n">MNIST</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mnist_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnist_val</span> <span class="o">=</span> <span class="n">random_split</span><span class="p">(</span><span class="n">mnist</span><span class="p">,</span> <span class="p">[</span><span class="mi">55000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mnist_test</span> <span class="o">=</span> <span class="n">MNIST</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">train_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DataLoader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mnist_train</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">val_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DataLoader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mnist_val</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DataLoader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mnist_test</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">default_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;layer_1_size&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
    <span class="s2">&quot;layer_2_size&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
    <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Define a training function that creates model, datamodule, and lightning trainer with Ray Train utilities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ray.train.lightning</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RayDDPStrategy</span><span class="p">,</span>
    <span class="n">RayLightningEnvironment</span><span class="p">,</span>
    <span class="n">RayTrainReportCallback</span><span class="p">,</span>
    <span class="n">prepare_trainer</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">train_func</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="n">dm</span> <span class="o">=</span> <span class="n">MNISTDataModule</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;batch_size&quot;</span><span class="p">])</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MNISTClassifier</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="n">trainer</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span>
        <span class="n">devices</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">accelerator</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">strategy</span><span class="o">=</span><span class="n">RayDDPStrategy</span><span class="p">(),</span>
        <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">RayTrainReportCallback</span><span class="p">()],</span>
        <span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">RayLightningEnvironment</span><span class="p">()],</span>
        <span class="n">enable_progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">trainer</span> <span class="o">=</span> <span class="n">prepare_trainer</span><span class="p">(</span><span class="n">trainer</span><span class="p">)</span>
    <span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">datamodule</span><span class="o">=</span><span class="n">dm</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="tuning-the-model-parameters">
<h2>Tuning the model parameters<a class="headerlink" href="#tuning-the-model-parameters" title="Permalink to this headline">#</a></h2>
<p>The parameters above should give you a good accuracy of over 90% already. However, we might improve on this simply by changing some of the hyperparameters. For instance, maybe we get an even higher accuracy if we used a smaller learning rate and larger middle layer size.</p>
<p>Instead of manually loop through all the parameter combinitions, let’s use Tune to systematically try out parameter combinations and find the best performing set.</p>
<p>First, we need some additional imports:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">tune</span>
<span class="kn">from</span> <span class="nn">ray.tune.schedulers</span> <span class="kn">import</span> <span class="n">ASHAScheduler</span>
</pre></div>
</div>
</div>
</div>
<section id="configuring-the-search-space">
<h3>Configuring the search space<a class="headerlink" href="#configuring-the-search-space" title="Permalink to this headline">#</a></h3>
<p>Now we configure the parameter search space. We would like to choose between different layer dimensions, learning rate, and batch sizes. The learning rate should be sampled uniformly between <code class="docutils literal notranslate"><span class="pre">0.0001</span></code> and <code class="docutils literal notranslate"><span class="pre">0.1</span></code>. The <code class="docutils literal notranslate"><span class="pre">tune.loguniform()</span></code> function is syntactic sugar to make sampling between these different orders of magnitude easier, specifically we are able to also sample small values. Similarly for <code class="docutils literal notranslate"><span class="pre">tune.choice()</span></code>, which samples from all the provided options.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_space</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;layer_1_size&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">]),</span>
    <span class="s2">&quot;layer_2_size&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">]),</span>
    <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">loguniform</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">),</span>
    <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">]),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="selecting-a-scheduler">
<h3>Selecting a scheduler<a class="headerlink" href="#selecting-a-scheduler" title="Permalink to this headline">#</a></h3>
<p>In this example, we use an <a class="reference external" href="https://blog.ml.cmu.edu/2018/12/12/massively-parallel-hyperparameter-optimization/">Asynchronous Hyperband</a>
scheduler. This scheduler decides at each iteration which trials are likely to perform
badly, and stops these trials. This way we don’t waste any resources on bad hyperparameter
configurations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The maximum training epochs</span>
<span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># Number of sampls from parameter space</span>
<span class="n">num_samples</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
</div>
<p>If you have more resources available, you can modify the above parameters accordingly. e.g. more epochs, more parameter samples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scheduler</span> <span class="o">=</span> <span class="n">ASHAScheduler</span><span class="p">(</span><span class="n">max_t</span><span class="o">=</span><span class="n">num_epochs</span><span class="p">,</span> <span class="n">grace_period</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">reduction_factor</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="training-with-gpus">
<h3>Training with GPUs<a class="headerlink" href="#training-with-gpus" title="Permalink to this headline">#</a></h3>
<p>We can specify the number of resources, including GPUs, that Tune should request for each trial.</p>
<p><code class="docutils literal notranslate"><span class="pre">TorchTrainer</span></code> takes care of environment setup for Distributed Data Parallel training, the model and data will automatically get distributed across GPUs. You only need to set the number of GPUs per worker in <code class="docutils literal notranslate"><span class="pre">ScalingConfig</span></code> and also set <code class="docutils literal notranslate"><span class="pre">accelerator=&quot;auto&quot;</span></code> in your training function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ray.train</span> <span class="kn">import</span> <span class="n">RunConfig</span><span class="p">,</span> <span class="n">ScalingConfig</span><span class="p">,</span> <span class="n">CheckpointConfig</span>

<span class="n">scaling_config</span> <span class="o">=</span> <span class="n">ScalingConfig</span><span class="p">(</span>
    <span class="n">num_workers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">use_gpu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resources_per_worker</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;CPU&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;GPU&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">)</span>

<span class="n">run_config</span> <span class="o">=</span> <span class="n">RunConfig</span><span class="p">(</span>
    <span class="n">checkpoint_config</span><span class="o">=</span><span class="n">CheckpointConfig</span><span class="p">(</span>
        <span class="n">num_to_keep</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">checkpoint_score_attribute</span><span class="o">=</span><span class="s2">&quot;ptl/val_accuracy&quot;</span><span class="p">,</span>
        <span class="n">checkpoint_score_order</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ray.train.torch</span> <span class="kn">import</span> <span class="n">TorchTrainer</span>

<span class="c1"># Define a TorchTrainer without hyper-parameters for Tuner</span>
<span class="n">ray_trainer</span> <span class="o">=</span> <span class="n">TorchTrainer</span><span class="p">(</span>
    <span class="n">train_func</span><span class="p">,</span>
    <span class="n">scaling_config</span><span class="o">=</span><span class="n">scaling_config</span><span class="p">,</span>
    <span class="n">run_config</span><span class="o">=</span><span class="n">run_config</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="putting-it-together">
<h3>Putting it together<a class="headerlink" href="#putting-it-together" title="Permalink to this headline">#</a></h3>
<p>Lastly, we need to create a <code class="docutils literal notranslate"><span class="pre">Tuner()</span></code> object and start Ray Tune with <code class="docutils literal notranslate"><span class="pre">tuner.fit()</span></code>. The full code looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tune_mnist_asha</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">scheduler</span> <span class="o">=</span> <span class="n">ASHAScheduler</span><span class="p">(</span><span class="n">max_t</span><span class="o">=</span><span class="n">num_epochs</span><span class="p">,</span> <span class="n">grace_period</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">reduction_factor</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">tuner</span> <span class="o">=</span> <span class="n">tune</span><span class="o">.</span><span class="n">Tuner</span><span class="p">(</span>
        <span class="n">ray_trainer</span><span class="p">,</span>
        <span class="n">param_space</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;train_loop_config&quot;</span><span class="p">:</span> <span class="n">search_space</span><span class="p">},</span>
        <span class="n">tune_config</span><span class="o">=</span><span class="n">tune</span><span class="o">.</span><span class="n">TuneConfig</span><span class="p">(</span>
            <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;ptl/val_accuracy&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span><span class="p">,</span>
            <span class="n">scheduler</span><span class="o">=</span><span class="n">scheduler</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">tuner</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>


<span class="n">results</span> <span class="o">=</span> <span class="n">tune_mnist_asha</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class="tuneStatus">
  <div style="display: flex;flex-direction: row">
    <div style="display: flex;flex-direction: column;">
      <h3>Tune Status</h3>
      <table>
<tbody>
<tr><td>Current time:</td><td>2023-09-07 14:03:52</td></tr>
<tr><td>Running for: </td><td>00:05:13.92        </td></tr>
<tr><td>Memory:      </td><td>20.5/186.6 GiB     </td></tr>
</tbody>
</table>
    </div>
    <div class="vDivider"></div>
    <div class="systemInfo">
      <h3>System Info</h3>
      Using AsyncHyperBand: num_stopped=10<br>Bracket: Iter 4.000: 0.9709362387657166 | Iter 2.000: 0.9617255330085754 | Iter 1.000: 0.9477165043354034<br>Logical resource usage: 4.0/48 CPUs, 3.0/4 GPUs (0.0/1.0 accelerator_type:None)
    </div>

  </div>
  <div class="hDivider"></div>
  <div class="trialStatus">
    <h3>Trial Status</h3>
    <table>
<thead>
<tr><th>Trial name              </th><th>status    </th><th>loc             </th><th style="text-align: right;">   train_loop_config/ba
tch_size</th><th style="text-align: right;">    train_loop_config/la
yer_1_size</th><th style="text-align: right;">    train_loop_config/la
yer_2_size</th><th style="text-align: right;">  train_loop_config/lr</th><th style="text-align: right;">  iter</th><th style="text-align: right;">  total time (s)</th><th style="text-align: right;">  ptl/train_loss</th><th style="text-align: right;">  ptl/train_accuracy</th><th style="text-align: right;">  ptl/val_loss</th></tr>
</thead>
<tbody>
<tr><td>TorchTrainer_5144b_00000</td><td>TERMINATED</td><td>10.0.0.84:63990 </td><td style="text-align: right;">32</td><td style="text-align: right;"> 64</td><td style="text-align: right;">256</td><td style="text-align: right;">           0.0316233  </td><td style="text-align: right;">     5</td><td style="text-align: right;">         29.3336</td><td style="text-align: right;">      0.973613  </td><td style="text-align: right;">            0.766667</td><td style="text-align: right;">     0.580943 </td></tr>
<tr><td>TorchTrainer_5144b_00001</td><td>TERMINATED</td><td>10.0.0.84:71294 </td><td style="text-align: right;">64</td><td style="text-align: right;">128</td><td style="text-align: right;"> 64</td><td style="text-align: right;">           0.0839278  </td><td style="text-align: right;">     1</td><td style="text-align: right;">         12.2275</td><td style="text-align: right;">      2.19514   </td><td style="text-align: right;">            0.266667</td><td style="text-align: right;">     1.56644  </td></tr>
<tr><td>TorchTrainer_5144b_00002</td><td>TERMINATED</td><td>10.0.0.84:73540 </td><td style="text-align: right;">32</td><td style="text-align: right;"> 64</td><td style="text-align: right;">256</td><td style="text-align: right;">           0.000233034</td><td style="text-align: right;">     5</td><td style="text-align: right;">         29.1314</td><td style="text-align: right;">      0.146903  </td><td style="text-align: right;">            0.933333</td><td style="text-align: right;">     0.114229 </td></tr>
<tr><td>TorchTrainer_5144b_00003</td><td>TERMINATED</td><td>10.0.0.84:80840 </td><td style="text-align: right;">64</td><td style="text-align: right;">128</td><td style="text-align: right;"> 64</td><td style="text-align: right;">           0.00109259 </td><td style="text-align: right;">     5</td><td style="text-align: right;">         21.6534</td><td style="text-align: right;">      0.0474913 </td><td style="text-align: right;">            0.966667</td><td style="text-align: right;">     0.0714878</td></tr>
<tr><td>TorchTrainer_5144b_00004</td><td>TERMINATED</td><td>10.0.0.84:88077 </td><td style="text-align: right;">32</td><td style="text-align: right;"> 32</td><td style="text-align: right;">128</td><td style="text-align: right;">           0.00114083 </td><td style="text-align: right;">     5</td><td style="text-align: right;">         29.6367</td><td style="text-align: right;">      0.0990443 </td><td style="text-align: right;">            0.966667</td><td style="text-align: right;">     0.0891999</td></tr>
<tr><td>TorchTrainer_5144b_00005</td><td>TERMINATED</td><td>10.0.0.84:95388 </td><td style="text-align: right;">32</td><td style="text-align: right;"> 64</td><td style="text-align: right;"> 64</td><td style="text-align: right;">           0.00924264 </td><td style="text-align: right;">     4</td><td style="text-align: right;">         25.7089</td><td style="text-align: right;">      0.0349707 </td><td style="text-align: right;">            1       </td><td style="text-align: right;">     0.153937 </td></tr>
<tr><td>TorchTrainer_5144b_00006</td><td>TERMINATED</td><td>10.0.0.84:101434</td><td style="text-align: right;">32</td><td style="text-align: right;">128</td><td style="text-align: right;">256</td><td style="text-align: right;">           0.00325671 </td><td style="text-align: right;">     5</td><td style="text-align: right;">         29.5763</td><td style="text-align: right;">      0.0708755 </td><td style="text-align: right;">            0.966667</td><td style="text-align: right;">     0.0820903</td></tr>
<tr><td>TorchTrainer_5144b_00007</td><td>TERMINATED</td><td>10.0.0.84:108750</td><td style="text-align: right;">32</td><td style="text-align: right;"> 32</td><td style="text-align: right;"> 64</td><td style="text-align: right;">           0.000123766</td><td style="text-align: right;">     1</td><td style="text-align: right;">         13.9326</td><td style="text-align: right;">      0.27464   </td><td style="text-align: right;">            0.966667</td><td style="text-align: right;">     0.401102 </td></tr>
<tr><td>TorchTrainer_5144b_00008</td><td>TERMINATED</td><td>10.0.0.84:111019</td><td style="text-align: right;">64</td><td style="text-align: right;">128</td><td style="text-align: right;">256</td><td style="text-align: right;">           0.00371762 </td><td style="text-align: right;">     5</td><td style="text-align: right;">         21.8337</td><td style="text-align: right;">      0.00108961</td><td style="text-align: right;">            1       </td><td style="text-align: right;">     0.0579874</td></tr>
<tr><td>TorchTrainer_5144b_00009</td><td>TERMINATED</td><td>10.0.0.84:118255</td><td style="text-align: right;">32</td><td style="text-align: right;">128</td><td style="text-align: right;">128</td><td style="text-align: right;">           0.00397956 </td><td style="text-align: right;">     5</td><td style="text-align: right;">         29.8334</td><td style="text-align: right;">      0.00940019</td><td style="text-align: right;">            1       </td><td style="text-align: right;">     0.0685028</td></tr>
</tbody>
</table>
  </div>
</div>
<style>
.tuneStatus {
  color: var(--jp-ui-font-color1);
}
.tuneStatus .systemInfo {
  display: flex;
  flex-direction: column;
}
.tuneStatus td {
  white-space: nowrap;
}
.tuneStatus .trialStatus {
  display: flex;
  flex-direction: column;
}
.tuneStatus h3 {
  font-weight: bold;
}
.tuneStatus .hDivider {
  border-bottom-width: var(--jp-border-width);
  border-bottom-color: var(--jp-border-color0);
  border-bottom-style: solid;
}
.tuneStatus .vDivider {
  border-left-width: var(--jp-border-width);
  border-left-color: var(--jp-border-color0);
  border-left-style: solid;
  margin: 0.5em 1em 0.5em 1em;
}
</style>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=63990)</span> 2023-09-07 13:58:43.025064: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=63990)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=63990)</span> 2023-09-07 13:58:43.165187: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=63990)</span> 2023-09-07 13:58:43.907088: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=63990)</span> 2023-09-07 13:58:43.907153: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=63990)</span> 2023-09-07 13:58:43.907160: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TorchTrainer pid=63990)</span> Starting distributed worker processes: [&#39;64101 (10.0.0.84)&#39;, &#39;64102 (10.0.0.84)&#39;, &#39;64103 (10.0.0.84)&#39;]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> Setting up process group for: env:// [rank=0, world_size=3]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> 2023-09-07 13:58:50.419714: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> 2023-09-07 13:58:50.419718: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> 2023-09-07 13:58:50.555450: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> 2023-09-07 13:58:51.317522: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> 2023-09-07 13:58:51.317610: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> 2023-09-07 13:58:51.317618: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00000_0_batch_size=32,layer_1_size=64,layer_2_size=256,lr=0.0316_2023-09-07_13-58-38/lightning_logs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> /home/ray/anaconda3/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py:92: PossibleUserWarning: `max_epochs` was not set. Setting it to 1000 epochs. To train without an epoch limit, set `max_epochs=-1`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span>   rank_zero_warn(
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> GPU available: True, used: True
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> TPU available: False, using: 0 TPU cores
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> IPU available: False, using: 0 IPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> HPU available: False, using: 0 HPUs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz to /tmp/tmpydcy4598/MNIST/raw/train-images-idx3-ubyte.gz
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 9912422/9912422 [00:00&lt;00:00, 120812916.07it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 101305832.98it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> Extracting /tmp/tmpydcy4598/MNIST/raw/train-images-idx3-ubyte.gz to /tmp/tmpydcy4598/MNIST/raw
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1,2]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span>   | Name     | Type               | Params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> 0 | accuracy | MulticlassAccuracy | 0     
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> 1 | layer_1  | Linear             | 50.2 K
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> 2 | layer_2  | Linear             | 16.6 K
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> 3 | layer_3  | Linear             | 2.6 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> 69.5 K    Trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> 0         Non-trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> 69.5 K    Total params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> 0.278     Total estimated model params size (MB)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Faint -Color-Bold-Faint-Cyan">(autoscaler +7m33s)</span> [autoscaler] Current infeasible resource requests: {&quot;resourcesBundle&quot;:{&quot;bundle_group_289661bddaad4820732f117e33d702000000&quot;:0.001}}, {&quot;resourcesBundle&quot;:{&quot;bundle_group_d14ed93ffcb267f77984fc5e097c02000000&quot;:0.001}}, {&quot;resourcesBundle&quot;:{&quot;bundle_group_9d0f0584af89d9185ad87362359402000000&quot;:0.001}}, {&quot;resourcesBundle&quot;:{&quot;bundle_group_b8fdebe2246b003d6e5d0451465b02000000&quot;:0.001}}, {&quot;resourcesBundle&quot;:{&quot;bundle_group_35d0a11b5707ef020363a907e5fc02000000&quot;:0.001}}, {&quot;resourcesBundle&quot;:{&quot;bundle_group_ba2b3c448809cad351fc7dc545a402000000&quot;:0.001}}, {&quot;resourcesBundle&quot;:{&quot;bundle_group_05283c0cbfbb775ad68aacf47bc702000000&quot;:0.001}}, {&quot;resourcesBundle&quot;:{&quot;bundle_group_2cd0e3d931d1e356a1ab0f3afb6a02000000&quot;:0.001}}, {&quot;resourcesBundle&quot;:{&quot;bundle_group_14f2bd9329dfcde35c77e8474b0f02000000&quot;:0.001}}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00000_0_batch_size=32,layer_1_size=64,layer_2_size=256,lr=0.0316_2023-09-07_13-58-38/checkpoint_000000)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64103)</span> 2023-09-07 13:58:50.448640: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64103)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> 2023-09-07 13:58:50.555450: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> 2023-09-07 13:58:51.317611: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64<span class=" -Color -Color-Green"> [repeated 4x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> 2023-09-07 13:58:51.317618: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00000_0_batch_size=32,layer_1_size=64,layer_2_size=256,lr=0.0316_2023-09-07_13-58-38/lightning_logs<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
100%|██████████| 4542/4542 [00:00&lt;00:00, 42147187.54it/s]<span class=" -Color -Color-Green"> [repeated 11x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1,2]<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00000_0_batch_size=32,layer_1_size=64,layer_2_size=256,lr=0.0316_2023-09-07_13-58-38/checkpoint_000002)<span class=" -Color -Color-Green"> [repeated 6x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64102)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00000_0_batch_size=32,layer_1_size=64,layer_2_size=256,lr=0.0316_2023-09-07_13-58-38/checkpoint_000004)<span class=" -Color -Color-Green"> [repeated 6x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=71294)</span> 2023-09-07 13:59:19.340985: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=71294)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00000_0_batch_size=32,layer_1_size=64,layer_2_size=256,lr=0.0316_2023-09-07_13-58-38/checkpoint_000004)<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=71294)</span> 2023-09-07 13:59:19.479380: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=71294)</span> 2023-09-07 13:59:20.227539: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=71294)</span> 2023-09-07 13:59:20.227616: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=71294)</span> 2023-09-07 13:59:20.227623: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TorchTrainer pid=71294)</span> Starting distributed worker processes: [&#39;71407 (10.0.0.84)&#39;, &#39;71408 (10.0.0.84)&#39;, &#39;71409 (10.0.0.84)&#39;]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> Setting up process group for: env:// [rank=0, world_size=3]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71408)</span> 2023-09-07 13:59:26.852631: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71408)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> 2023-09-07 13:59:26.854221: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71408)</span> 2023-09-07 13:59:26.986178: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71408)</span> 2023-09-07 13:59:27.752593: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71408)</span> 2023-09-07 13:59:27.752672: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71408)</span> 2023-09-07 13:59:27.752679: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> /home/ray/anaconda3/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py:92: PossibleUserWarning: `max_epochs` was not set. Setting it to 1000 epochs. To train without an epoch limit, set `max_epochs=-1`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span>   rank_zero_warn(
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> GPU available: True, used: True
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> TPU available: False, using: 0 TPU cores
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> IPU available: False, using: 0 IPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> HPU available: False, using: 0 HPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71408)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00001_1_batch_size=64,layer_1_size=128,layer_2_size=64,lr=0.0839_2023-09-07_13-58-38/lightning_logs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71408)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz to /tmp/tmpt8k8jglf/MNIST/raw/t10k-labels-idx1-ubyte.gz<span class=" -Color -Color-Green"> [repeated 11x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> Extracting /tmp/tmpt8k8jglf/MNIST/raw/t10k-labels-idx1-ubyte.gz to /tmp/tmpt8k8jglf/MNIST/raw<span class=" -Color -Color-Green"> [repeated 11x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=64101)</span> <span class=" -Color -Color-Green"> [repeated 11x across cluster]</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/9912422 [00:00&lt;?, ?it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 100664900.56it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 86590268.41it/s]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71408)</span> LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1,2]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span>   | Name     | Type               | Params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> 0 | accuracy | MulticlassAccuracy | 0     
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> 1 | layer_1  | Linear             | 100 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> 2 | layer_2  | Linear             | 8.3 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> 3 | layer_3  | Linear             | 650   
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> 109 K     Trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> 0         Non-trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> 109 K     Total params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> 0.438     Total estimated model params size (MB)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71408)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00001_1_batch_size=64,layer_1_size=128,layer_2_size=64,lr=0.0839_2023-09-07_13-58-38/checkpoint_000000)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71409)</span> 2023-09-07 13:59:26.851614: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71409)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71409)</span> 2023-09-07 13:59:26.986178: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71409)</span> 2023-09-07 13:59:27.752674: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64<span class=" -Color -Color-Green"> [repeated 4x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71409)</span> 2023-09-07 13:59:27.752681: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=73540)</span> 2023-09-07 13:59:38.336002: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=73540)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71409)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00001_1_batch_size=64,layer_1_size=128,layer_2_size=64,lr=0.0839_2023-09-07_13-58-38/lightning_logs<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
100%|██████████| 4542/4542 [00:00&lt;00:00, 23461242.33it/s]<span class=" -Color -Color-Green"> [repeated 11x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71407)</span> <span class=" -Color -Color-Green"> [repeated 5x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71409)</span> LOCAL_RANK: 2 - CUDA_VISIBLE_DEVICES: [0,1,2]<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71408)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71409)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00001_1_batch_size=64,layer_1_size=128,layer_2_size=64,lr=0.0839_2023-09-07_13-58-38/checkpoint_000000)<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=73540)</span> 2023-09-07 13:59:38.476177: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=73540)</span> 2023-09-07 13:59:39.222782: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=73540)</span> 2023-09-07 13:59:39.222788: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TorchTrainer pid=73540)</span> Starting distributed worker processes: [&#39;73647 (10.0.0.84)&#39;, &#39;73648 (10.0.0.84)&#39;, &#39;73649 (10.0.0.84)&#39;]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> Setting up process group for: env:// [rank=0, world_size=3]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73648)</span> 2023-09-07 13:59:45.901023: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73648)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73648)</span> 2023-09-07 13:59:46.041760: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73649)</span> 2023-09-07 13:59:45.964229: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73649)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73648)</span> 2023-09-07 13:59:46.807096: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73648)</span> 2023-09-07 13:59:46.807173: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73648)</span> 2023-09-07 13:59:46.807180: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73648)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00002_2_batch_size=32,layer_1_size=64,layer_2_size=256,lr=0.0002_2023-09-07_13-58-38/lightning_logs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> /home/ray/anaconda3/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py:92: PossibleUserWarning: `max_epochs` was not set. Setting it to 1000 epochs. To train without an epoch limit, set `max_epochs=-1`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span>   rank_zero_warn(
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> GPU available: True, used: True
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> TPU available: False, using: 0 TPU cores
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> IPU available: False, using: 0 IPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> HPU available: False, using: 0 HPUs
  0%|          | 0/9912422 [00:00&lt;?, ?it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 88411180.44it/s]
 60%|█████▉    | 5931008/9912422 [00:00&lt;00:00, 57942493.14it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73648)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73648)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz to /tmp/tmpcy67mfe_/MNIST/raw/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 13x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71409)</span> Extracting /tmp/tmpmxchio03/MNIST/raw/t10k-labels-idx1-ubyte.gz to /tmp/tmpmxchio03/MNIST/raw<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=71409)</span> <span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73648)</span> LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1,2]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span>   | Name     | Type               | Params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> 0 | accuracy | MulticlassAccuracy | 0     
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> 1 | layer_1  | Linear             | 50.2 K
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> 2 | layer_2  | Linear             | 16.6 K
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> 3 | layer_3  | Linear             | 2.6 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> 69.5 K    Trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> 0         Non-trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> 69.5 K    Total params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> 0.278     Total estimated model params size (MB)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73648)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73648)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00002_2_batch_size=32,layer_1_size=64,layer_2_size=256,lr=0.0002_2023-09-07_13-58-38/checkpoint_000000)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> 2023-09-07 13:59:46.102948: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> 2023-09-07 13:59:45.969366: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> 2023-09-07 13:59:46.898646: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64<span class=" -Color -Color-Green"> [repeated 4x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> 2023-09-07 13:59:46.898654: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00002_2_batch_size=32,layer_1_size=64,layer_2_size=256,lr=0.0002_2023-09-07_13-58-38/lightning_logs<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
100%|██████████| 4542/4542 [00:00&lt;00:00, 45575427.67it/s]<span class=" -Color -Color-Green"> [repeated 11x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> <span class=" -Color -Color-Green"> [repeated 4x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1,2]<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73648)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00002_2_batch_size=32,layer_1_size=64,layer_2_size=256,lr=0.0002_2023-09-07_13-58-38/checkpoint_000002)<span class=" -Color -Color-Green"> [repeated 6x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73648)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00002_2_batch_size=32,layer_1_size=64,layer_2_size=256,lr=0.0002_2023-09-07_13-58-38/checkpoint_000004)<span class=" -Color -Color-Green"> [repeated 6x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=80840)</span> 2023-09-07 14:00:14.333330: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=80840)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=80840)</span> 2023-09-07 14:00:14.472277: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00002_2_batch_size=32,layer_1_size=64,layer_2_size=256,lr=0.0002_2023-09-07_13-58-38/checkpoint_000004)<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=80840)</span> 2023-09-07 14:00:15.216259: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=80840)</span> 2023-09-07 14:00:15.216329: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=80840)</span> 2023-09-07 14:00:15.216336: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TorchTrainer pid=80840)</span> Starting distributed worker processes: [&#39;80950 (10.0.0.84)&#39;, &#39;80951 (10.0.0.84)&#39;, &#39;80952 (10.0.0.84)&#39;]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> Setting up process group for: env:// [rank=0, world_size=3]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> 2023-09-07 14:00:21.817341: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80951)</span> 2023-09-07 14:00:21.817340: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80951)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> 2023-09-07 14:00:21.952950: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> 2023-09-07 14:00:22.721445: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> 2023-09-07 14:00:22.721524: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> 2023-09-07 14:00:22.721531: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> /home/ray/anaconda3/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py:92: PossibleUserWarning: `max_epochs` was not set. Setting it to 1000 epochs. To train without an epoch limit, set `max_epochs=-1`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span>   rank_zero_warn(
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> GPU available: True, used: True
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> TPU available: False, using: 0 TPU cores
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> IPU available: False, using: 0 IPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> HPU available: False, using: 0 HPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00003_3_batch_size=64,layer_1_size=128,layer_2_size=64,lr=0.0011_2023-09-07_13-58-38/lightning_logs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz to /tmp/tmpdj6sv23q/MNIST/raw/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> Extracting /tmp/tmpjm0jv6rr/MNIST/raw/t10k-labels-idx1-ubyte.gz to /tmp/tmpjm0jv6rr/MNIST/raw<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=73647)</span> <span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 9912422/9912422 [00:00&lt;00:00, 120421348.01it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 111998101.50it/s]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1,2]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span>   | Name     | Type               | Params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> 0 | accuracy | MulticlassAccuracy | 0     
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> 1 | layer_1  | Linear             | 100 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> 2 | layer_2  | Linear             | 8.3 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> 3 | layer_3  | Linear             | 650   
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> 109 K     Trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> 0         Non-trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> 109 K     Total params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> 0.438     Total estimated model params size (MB)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00003_3_batch_size=64,layer_1_size=128,layer_2_size=64,lr=0.0011_2023-09-07_13-58-38/checkpoint_000000)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80952)</span> 2023-09-07 14:00:21.817339: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80952)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80952)</span> 2023-09-07 14:00:21.952959: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80952)</span> 2023-09-07 14:00:22.721494: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64<span class=" -Color -Color-Green"> [repeated 4x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80952)</span> 2023-09-07 14:00:22.721502: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80952)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00003_3_batch_size=64,layer_1_size=128,layer_2_size=64,lr=0.0011_2023-09-07_13-58-38/lightning_logs<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
100%|██████████| 4542/4542 [00:00&lt;00:00, 39279440.76it/s]<span class=" -Color -Color-Green"> [repeated 11x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80952)</span> LOCAL_RANK: 2 - CUDA_VISIBLE_DEVICES: [0,1,2]<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80952)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80950)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00003_3_batch_size=64,layer_1_size=128,layer_2_size=64,lr=0.0011_2023-09-07_13-58-38/checkpoint_000003)<span class=" -Color -Color-Green"> [repeated 9x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=88077)</span> 2023-09-07 14:00:43.334099: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=88077)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80952)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00003_3_batch_size=64,layer_1_size=128,layer_2_size=64,lr=0.0011_2023-09-07_13-58-38/checkpoint_000004)<span class=" -Color -Color-Green"> [repeated 5x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=88077)</span> 2023-09-07 14:00:43.474522: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=88077)</span> 2023-09-07 14:00:44.217911: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=88077)</span> 2023-09-07 14:00:44.217986: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=88077)</span> 2023-09-07 14:00:44.217994: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TorchTrainer pid=88077)</span> Starting distributed worker processes: [&#39;88184 (10.0.0.84)&#39;, &#39;88185 (10.0.0.84)&#39;, &#39;88186 (10.0.0.84)&#39;]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> Setting up process group for: env:// [rank=0, world_size=3]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88186)</span> 2023-09-07 14:00:50.980950: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88186)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88185)</span> 2023-09-07 14:00:50.969448: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88185)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88186)</span> 2023-09-07 14:00:51.106653: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88186)</span> 2023-09-07 14:00:51.878087: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88186)</span> 2023-09-07 14:00:51.878157: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88186)</span> 2023-09-07 14:00:51.878165: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88186)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00004_4_batch_size=32,layer_1_size=32,layer_2_size=128,lr=0.0011_2023-09-07_13-58-38/lightning_logs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> /home/ray/anaconda3/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py:92: PossibleUserWarning: `max_epochs` was not set. Setting it to 1000 epochs. To train without an epoch limit, set `max_epochs=-1`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span>   rank_zero_warn(
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> GPU available: True, used: True
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> TPU available: False, using: 0 TPU cores
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> IPU available: False, using: 0 IPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> HPU available: False, using: 0 HPUs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88186)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88186)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz to /tmp/tmpd1qkzrfz/MNIST/raw/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80951)</span> Extracting /tmp/tmpyrcbok27/MNIST/raw/t10k-labels-idx1-ubyte.gz to /tmp/tmpyrcbok27/MNIST/raw<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=80951)</span> <span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/9912422 [00:00&lt;?, ?it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 135946084.34it/s]
 61%|██████▏   | 6094848/9912422 [00:00&lt;00:00, 60581952.53it/s]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88186)</span> LOCAL_RANK: 2 - CUDA_VISIBLE_DEVICES: [0,1,2]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span>   | Name     | Type               | Params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> 0 | accuracy | MulticlassAccuracy | 0     
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> 1 | layer_1  | Linear             | 25.1 K
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> 2 | layer_2  | Linear             | 4.2 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> 3 | layer_3  | Linear             | 1.3 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> 30.6 K    Trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> 0         Non-trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> 30.6 K    Total params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> 0.123     Total estimated model params size (MB)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88186)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88186)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00004_4_batch_size=32,layer_1_size=32,layer_2_size=128,lr=0.0011_2023-09-07_13-58-38/checkpoint_000000)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> 2023-09-07 14:00:50.969450: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> 2023-09-07 14:00:51.106653: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> 2023-09-07 14:00:51.876301: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64<span class=" -Color -Color-Green"> [repeated 4x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> 2023-09-07 14:00:51.876309: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00004_4_batch_size=32,layer_1_size=32,layer_2_size=128,lr=0.0011_2023-09-07_13-58-38/lightning_logs<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
100%|██████████| 4542/4542 [00:00&lt;00:00, 47154774.18it/s]<span class=" -Color -Color-Green"> [repeated 11x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> <span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 87231776.04it/s]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1,2]<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88186)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00004_4_batch_size=32,layer_1_size=32,layer_2_size=128,lr=0.0011_2023-09-07_13-58-38/checkpoint_000002)<span class=" -Color -Color-Green"> [repeated 6x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88186)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00004_4_batch_size=32,layer_1_size=32,layer_2_size=128,lr=0.0011_2023-09-07_13-58-38/checkpoint_000004)<span class=" -Color -Color-Green"> [repeated 6x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=95388)</span> 2023-09-07 14:01:20.343383: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=95388)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00004_4_batch_size=32,layer_1_size=32,layer_2_size=128,lr=0.0011_2023-09-07_13-58-38/checkpoint_000004)<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=95388)</span> 2023-09-07 14:01:20.484476: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=95388)</span> 2023-09-07 14:01:21.230226: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=95388)</span> 2023-09-07 14:01:21.230300: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=95388)</span> 2023-09-07 14:01:21.230307: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TorchTrainer pid=95388)</span> Starting distributed worker processes: [&#39;95492 (10.0.0.84)&#39;, &#39;95493 (10.0.0.84)&#39;, &#39;95494 (10.0.0.84)&#39;]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> Setting up process group for: env:// [rank=0, world_size=3]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95494)</span> 2023-09-07 14:01:27.861861: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95494)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> 2023-09-07 14:01:27.861862: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95494)</span> 2023-09-07 14:01:27.995553: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95494)</span> 2023-09-07 14:01:28.761910: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95494)</span> 2023-09-07 14:01:28.761983: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95494)</span> 2023-09-07 14:01:28.761990: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> /home/ray/anaconda3/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py:92: PossibleUserWarning: `max_epochs` was not set. Setting it to 1000 epochs. To train without an epoch limit, set `max_epochs=-1`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span>   rank_zero_warn(
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> GPU available: True, used: True
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> TPU available: False, using: 0 TPU cores
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> IPU available: False, using: 0 IPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> HPU available: False, using: 0 HPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00005_5_batch_size=32,layer_1_size=64,layer_2_size=64,lr=0.0092_2023-09-07_13-58-38/lightning_logs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95494)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95494)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz to /tmp/tmpkvf1rrst/MNIST/raw/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> Extracting /tmp/tmppk4zrz1w/MNIST/raw/t10k-labels-idx1-ubyte.gz to /tmp/tmppk4zrz1w/MNIST/raw<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=88184)</span> <span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/9912422 [00:00&lt;?, ?it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 117459779.70it/s]
 74%|███████▍  | 7372800/9912422 [00:00&lt;00:00, 73213483.02it/s]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95494)</span> LOCAL_RANK: 2 - CUDA_VISIBLE_DEVICES: [0,1,2]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span>   | Name     | Type               | Params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> 0 | accuracy | MulticlassAccuracy | 0     
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> 1 | layer_1  | Linear             | 50.2 K
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> 2 | layer_2  | Linear             | 4.2 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> 3 | layer_3  | Linear             | 650   
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> 55.1 K    Trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> 0         Non-trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> 55.1 K    Total params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> 0.220     Total estimated model params size (MB)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95494)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95494)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00005_5_batch_size=32,layer_1_size=64,layer_2_size=64,lr=0.0092_2023-09-07_13-58-38/checkpoint_000000)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95493)</span> 2023-09-07 14:01:27.861861: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95493)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95493)</span> 2023-09-07 14:01:27.995552: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95493)</span> 2023-09-07 14:01:28.758718: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64<span class=" -Color -Color-Green"> [repeated 4x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95493)</span> 2023-09-07 14:01:28.758742: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95494)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00005_5_batch_size=32,layer_1_size=64,layer_2_size=64,lr=0.0092_2023-09-07_13-58-38/lightning_logs<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
100%|██████████| 4542/4542 [00:00&lt;00:00, 48598287.67it/s]<span class=" -Color -Color-Green"> [repeated 10x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> <span class=" -Color -Color-Green"> [repeated 4x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95493)</span> LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1,2]<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95493)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95494)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00005_5_batch_size=32,layer_1_size=64,layer_2_size=64,lr=0.0092_2023-09-07_13-58-38/checkpoint_000002)<span class=" -Color -Color-Green"> [repeated 6x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=101434)</span> 2023-09-07 14:01:53.326795: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=101434)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95493)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00005_5_batch_size=32,layer_1_size=64,layer_2_size=64,lr=0.0092_2023-09-07_13-58-38/checkpoint_000003)<span class=" -Color -Color-Green"> [repeated 5x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=101434)</span> 2023-09-07 14:01:53.463803: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=101434)</span> 2023-09-07 14:01:54.201636: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=101434)</span> 2023-09-07 14:01:54.201711: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=101434)</span> 2023-09-07 14:01:54.201718: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TorchTrainer pid=101434)</span> Starting distributed worker processes: [&#39;101544 (10.0.0.84)&#39;, &#39;101545 (10.0.0.84)&#39;, &#39;101546 (10.0.0.84)&#39;]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> Setting up process group for: env:// [rank=0, world_size=3]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> 2023-09-07 14:02:00.834273: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> 2023-09-07 14:02:00.834274: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> 2023-09-07 14:02:00.968155: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> 2023-09-07 14:02:01.736107: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> 2023-09-07 14:02:01.736184: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> 2023-09-07 14:02:01.736191: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00006_6_batch_size=32,layer_1_size=128,layer_2_size=256,lr=0.0033_2023-09-07_13-58-38/lightning_logs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> /home/ray/anaconda3/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py:92: PossibleUserWarning: `max_epochs` was not set. Setting it to 1000 epochs. To train without an epoch limit, set `max_epochs=-1`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span>   rank_zero_warn(
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> GPU available: True, used: True
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> TPU available: False, using: 0 TPU cores
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> IPU available: False, using: 0 IPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> HPU available: False, using: 0 HPUs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz to /tmp/tmpyy7a6r11/MNIST/raw/t10k-labels-idx1-ubyte.gz<span class=" -Color -Color-Green"> [repeated 11x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> Extracting /tmp/tmpyy7a6r11/MNIST/raw/t10k-labels-idx1-ubyte.gz to /tmp/tmpyy7a6r11/MNIST/raw<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=95492)</span> <span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/9912422 [00:00&lt;?, ?it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 104607984.65it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> Extracting /tmp/tmpxobpdr_p/MNIST/raw/train-images-idx3-ubyte.gz to /tmp/tmpxobpdr_p/MNIST/raw
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> Extracting /tmp/tmpxobpdr_p/MNIST/raw/train-labels-idx1-ubyte.gz to /tmp/tmpxobpdr_p/MNIST/raw
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> Extracting /tmp/tmpxobpdr_p/MNIST/raw/t10k-images-idx3-ubyte.gz to /tmp/tmpxobpdr_p/MNIST/raw
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> Extracting /tmp/tmpxobpdr_p/MNIST/raw/t10k-labels-idx1-ubyte.gz to /tmp/tmpxobpdr_p/MNIST/raw
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1,2]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span>   | Name     | Type               | Params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> 0 | accuracy | MulticlassAccuracy | 0     
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> 1 | layer_1  | Linear             | 100 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> 2 | layer_2  | Linear             | 33.0 K
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> 3 | layer_3  | Linear             | 2.6 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> 136 K     Trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> 0         Non-trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> 136 K     Total params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> 0.544     Total estimated model params size (MB)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00006_6_batch_size=32,layer_1_size=128,layer_2_size=256,lr=0.0033_2023-09-07_13-58-38/checkpoint_000000)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101546)</span> 2023-09-07 14:02:00.834275: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101546)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101546)</span> 2023-09-07 14:02:00.968160: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101546)</span> 2023-09-07 14:02:01.736182: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64<span class=" -Color -Color-Green"> [repeated 4x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101546)</span> 2023-09-07 14:02:01.736190: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101546)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00006_6_batch_size=32,layer_1_size=128,layer_2_size=256,lr=0.0033_2023-09-07_13-58-38/lightning_logs<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
100%|██████████| 4542/4542 [00:00&lt;00:00, 38642046.18it/s]<span class=" -Color -Color-Green"> [repeated 11x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> <span class=" -Color -Color-Green"> [repeated 3x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101546)</span> LOCAL_RANK: 2 - CUDA_VISIBLE_DEVICES: [0,1,2]<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101544)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00006_6_batch_size=32,layer_1_size=128,layer_2_size=256,lr=0.0033_2023-09-07_13-58-38/checkpoint_000002)<span class=" -Color -Color-Green"> [repeated 6x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101545)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00006_6_batch_size=32,layer_1_size=128,layer_2_size=256,lr=0.0033_2023-09-07_13-58-38/checkpoint_000004)<span class=" -Color -Color-Green"> [repeated 6x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=108750)</span> 2023-09-07 14:02:30.387715: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=108750)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101546)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00006_6_batch_size=32,layer_1_size=128,layer_2_size=256,lr=0.0033_2023-09-07_13-58-38/checkpoint_000004)<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=108750)</span> 2023-09-07 14:02:30.526490: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=108750)</span> 2023-09-07 14:02:31.271200: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=108750)</span> 2023-09-07 14:02:31.271270: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=108750)</span> 2023-09-07 14:02:31.271277: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TorchTrainer pid=108750)</span> Starting distributed worker processes: [&#39;108861 (10.0.0.84)&#39;, &#39;108862 (10.0.0.84)&#39;, &#39;108863 (10.0.0.84)&#39;]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> Setting up process group for: env:// [rank=0, world_size=3]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108862)</span> 2023-09-07 14:02:38.000239: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108862)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108863)</span> 2023-09-07 14:02:38.000240: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108863)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108862)</span> 2023-09-07 14:02:38.137493: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108862)</span> 2023-09-07 14:02:38.911788: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108862)</span> 2023-09-07 14:02:38.911870: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108862)</span> 2023-09-07 14:02:38.911877: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> /home/ray/anaconda3/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py:92: PossibleUserWarning: `max_epochs` was not set. Setting it to 1000 epochs. To train without an epoch limit, set `max_epochs=-1`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span>   rank_zero_warn(
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> GPU available: True, used: True
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> TPU available: False, using: 0 TPU cores
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> IPU available: False, using: 0 IPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> HPU available: False, using: 0 HPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108862)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00007_7_batch_size=32,layer_1_size=32,layer_2_size=64,lr=0.0001_2023-09-07_13-58-38/lightning_logs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108863)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101546)</span> Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz to /tmp/tmpt_if2tuu/MNIST/raw/t10k-labels-idx1-ubyte.gz<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101546)</span> Extracting /tmp/tmpt_if2tuu/MNIST/raw/t10k-labels-idx1-ubyte.gz to /tmp/tmpt_if2tuu/MNIST/raw<span class=" -Color -Color-Green"> [repeated 8x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=101546)</span> <span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/9912422 [00:00&lt;?, ?it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 111226266.99it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 89971437.39it/s]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108862)</span> LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1,2]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span>   | Name     | Type               | Params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> 0 | accuracy | MulticlassAccuracy | 0     
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> 1 | layer_1  | Linear             | 25.1 K
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> 2 | layer_2  | Linear             | 2.1 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> 3 | layer_3  | Linear             | 650   
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> 27.9 K    Trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> 0         Non-trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> 27.9 K    Total params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> 0.112     Total estimated model params size (MB)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108862)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108862)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00007_7_batch_size=32,layer_1_size=32,layer_2_size=64,lr=0.0001_2023-09-07_13-58-38/checkpoint_000000)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> 2023-09-07 14:02:38.000239: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> 2023-09-07 14:02:38.137493: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> 2023-09-07 14:02:38.911832: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64<span class=" -Color -Color-Green"> [repeated 4x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> 2023-09-07 14:02:38.911839: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00007_7_batch_size=32,layer_1_size=32,layer_2_size=64,lr=0.0001_2023-09-07_13-58-38/lightning_logs<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
100%|██████████| 4542/4542 [00:00&lt;00:00, 42054147.39it/s]<span class=" -Color -Color-Green"> [repeated 11x across cluster]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Faint -Color-Bold-Faint-Cyan">(autoscaler +11m23s)</span> [workspace snapshot] New snapshot created successfully (Size: 327.01 KB)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=111019)</span> 2023-09-07 14:02:51.352608: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=111019)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> <span class=" -Color -Color-Green"> [repeated 3x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1,2]<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108861)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00007_7_batch_size=32,layer_1_size=32,layer_2_size=64,lr=0.0001_2023-09-07_13-58-38/checkpoint_000000)<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=111019)</span> 2023-09-07 14:02:51.493509: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=111019)</span> 2023-09-07 14:02:52.239731: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=111019)</span> 2023-09-07 14:02:52.239805: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=111019)</span> 2023-09-07 14:02:52.239812: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TorchTrainer pid=111019)</span> Starting distributed worker processes: [&#39;111129 (10.0.0.84)&#39;, &#39;111130 (10.0.0.84)&#39;, &#39;111131 (10.0.0.84)&#39;]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> Setting up process group for: env:// [rank=0, world_size=3]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111131)</span> 2023-09-07 14:02:58.909958: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111131)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111130)</span> 2023-09-07 14:02:58.910530: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111130)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111131)</span> 2023-09-07 14:02:59.041760: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111131)</span> 2023-09-07 14:02:59.809607: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111131)</span> 2023-09-07 14:02:59.809682: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111131)</span> 2023-09-07 14:02:59.809690: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> /home/ray/anaconda3/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py:92: PossibleUserWarning: `max_epochs` was not set. Setting it to 1000 epochs. To train without an epoch limit, set `max_epochs=-1`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span>   rank_zero_warn(
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> GPU available: True, used: True
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> TPU available: False, using: 0 TPU cores
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> IPU available: False, using: 0 IPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> HPU available: False, using: 0 HPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111131)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00008_8_batch_size=64,layer_1_size=128,layer_2_size=256,lr=0.0037_2023-09-07_13-58-38/lightning_logs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111131)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111131)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz to /tmp/tmpddnnc0iv/MNIST/raw/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 13x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108863)</span> Extracting /tmp/tmpxcg0v86z/MNIST/raw/t10k-labels-idx1-ubyte.gz to /tmp/tmpxcg0v86z/MNIST/raw<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=108863)</span> <span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 9912422/9912422 [00:00&lt;00:00, 109686001.97it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 81254614.76it/s]
100%|██████████| 1648877/1648877 [00:00&lt;00:00, 35741410.23it/s]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111131)</span> LOCAL_RANK: 2 - CUDA_VISIBLE_DEVICES: [0,1,2]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span>   | Name     | Type               | Params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> 0 | accuracy | MulticlassAccuracy | 0     
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> 1 | layer_1  | Linear             | 100 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> 2 | layer_2  | Linear             | 33.0 K
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> 3 | layer_3  | Linear             | 2.6 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> 136 K     Trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> 0         Non-trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> 136 K     Total params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> 0.544     Total estimated model params size (MB)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111131)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111131)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00008_8_batch_size=64,layer_1_size=128,layer_2_size=256,lr=0.0037_2023-09-07_13-58-38/checkpoint_000000)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> 2023-09-07 14:02:58.906403: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> 2023-09-07 14:02:59.041757: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> 2023-09-07 14:02:59.809306: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64<span class=" -Color -Color-Green"> [repeated 4x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> 2023-09-07 14:02:59.809314: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00008_8_batch_size=64,layer_1_size=128,layer_2_size=256,lr=0.0037_2023-09-07_13-58-38/lightning_logs<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
100%|██████████| 4542/4542 [00:00&lt;00:00, 37135533.66it/s]<span class=" -Color -Color-Green"> [repeated 11x across cluster]</span>
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 92298990.88it/s]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> <span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1,2]<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111131)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00008_8_batch_size=64,layer_1_size=128,layer_2_size=256,lr=0.0037_2023-09-07_13-58-38/checkpoint_000003)<span class=" -Color -Color-Green"> [repeated 9x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=118255)</span> 2023-09-07 14:03:20.351292: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=118255)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111129)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00008_8_batch_size=64,layer_1_size=128,layer_2_size=256,lr=0.0037_2023-09-07_13-58-38/checkpoint_000004)<span class=" -Color -Color-Green"> [repeated 5x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=118255)</span> 2023-09-07 14:03:20.492641: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=118255)</span> 2023-09-07 14:03:21.239037: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=118255)</span> 2023-09-07 14:03:21.239106: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TrainTrainable pid=118255)</span> 2023-09-07 14:03:21.239113: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(TorchTrainer pid=118255)</span> Starting distributed worker processes: [&#39;118362 (10.0.0.84)&#39;, &#39;118363 (10.0.0.84)&#39;, &#39;118364 (10.0.0.84)&#39;]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> Setting up process group for: env:// [rank=0, world_size=3]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118363)</span> 2023-09-07 14:03:27.930188: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118363)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118364)</span> 2023-09-07 14:03:27.917602: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118364)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118363)</span> 2023-09-07 14:03:28.052415: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118363)</span> 2023-09-07 14:03:28.822569: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118363)</span> 2023-09-07 14:03:28.822644: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118363)</span> 2023-09-07 14:03:28.822652: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118363)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00009_9_batch_size=32,layer_1_size=128,layer_2_size=128,lr=0.0040_2023-09-07_13-58-38/lightning_logs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> /home/ray/anaconda3/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py:92: PossibleUserWarning: `max_epochs` was not set. Setting it to 1000 epochs. To train without an epoch limit, set `max_epochs=-1`.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span>   rank_zero_warn(
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> GPU available: True, used: True
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> TPU available: False, using: 0 TPU cores
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> IPU available: False, using: 0 IPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> HPU available: False, using: 0 HPUs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118364)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118364)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz to /tmp/tmp0sbwiedt/MNIST/raw/train-images-idx3-ubyte.gz<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111130)</span> Extracting /tmp/tmpfmuq9_qh/MNIST/raw/t10k-labels-idx1-ubyte.gz to /tmp/tmpfmuq9_qh/MNIST/raw<span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=111130)</span> <span class=" -Color -Color-Green"> [repeated 12x across cluster]</span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/9912422 [00:00&lt;?, ?it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 109752309.17it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 92575620.67it/s]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118363)</span> LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1,2]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span>   | Name     | Type               | Params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> 0 | accuracy | MulticlassAccuracy | 0     
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> 1 | layer_1  | Linear             | 100 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> 2 | layer_2  | Linear             | 16.5 K
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> 3 | layer_3  | Linear             | 1.3 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> ------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> 118 K     Trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> 0         Non-trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> 118 K     Total params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> 0.473     Total estimated model params size (MB)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118363)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118363)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00009_9_batch_size=32,layer_1_size=128,layer_2_size=128,lr=0.0040_2023-09-07_13-58-38/checkpoint_000000)
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> 2023-09-07 14:03:27.912682: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> 2023-09-07 14:03:28.050355: I tensorflow/core/util/port.cc:104] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> 2023-09-07 14:03:28.816159: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64<span class=" -Color -Color-Green"> [repeated 4x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> 2023-09-07 14:03:28.816166: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> Missing logger folder: /home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00009_9_batch_size=32,layer_1_size=128,layer_2_size=128,lr=0.0040_2023-09-07_13-58-38/lightning_logs<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
100%|██████████| 4542/4542 [00:00&lt;00:00, 42810177.01it/s]<span class=" -Color -Color-Green"> [repeated 11x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> <span class=" -Color -Color-Green"> [repeated 4x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1,2]<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118362)</span> [W reducer.cpp:1300] Warning: find_unused_parameters=True was specified in DDP constructor, but did not find any unused parameters in the forward pass. This flag results in an extra traversal of the autograd graph every iteration,  which can adversely affect performance. If your model indeed never has any unused parameters in the forward pass, consider turning this flag off. Note that this warning may be a false positive if your model has flow control causing later iterations to have unused parameters. (function operator())<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118363)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00009_9_batch_size=32,layer_1_size=128,layer_2_size=128,lr=0.0040_2023-09-07_13-58-38/checkpoint_000002)<span class=" -Color -Color-Green"> [repeated 6x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=118363)</span> Checkpoint successfully created at: Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00009_9_batch_size=32,layer_1_size=128,layer_2_size=128,lr=0.0040_2023-09-07_13-58-38/checkpoint_000004)<span class=" -Color -Color-Green"> [repeated 6x across cluster]</span>
2023-09-07 14:03:52,186	INFO tune.py:1143 -- Total run time: 313.94 seconds (313.92 seconds for the tuning loop).
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">get_best_result</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s2">&quot;ptl/val_accuracy&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Result(
  metrics={&#39;ptl/train_loss&#39;: 0.00108961365185678, &#39;ptl/train_accuracy&#39;: 1.0, &#39;ptl/val_loss&#39;: 0.05798737704753876, &#39;ptl/val_accuracy&#39;: 0.9820601940155029, &#39;epoch&#39;: 4, &#39;step&#39;: 1435},
  path=&#39;/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00008_8_batch_size=64,layer_1_size=128,layer_2_size=256,lr=0.0037_2023-09-07_13-58-38&#39;,
  filesystem=&#39;local&#39;,
  checkpoint=Checkpoint(filesystem=local, path=/home/ray/ray_results/TorchTrainer_2023-09-07_13-58-38/TorchTrainer_5144b_00008_8_batch_size=64,layer_1_size=128,layer_2_size=256,lr=0.0037_2023-09-07_13-58-38/checkpoint_000004)
)
</pre></div>
</div>
</div>
</div>
<p>In the example above, Tune runs 10 trials with different hyperparameter configurations.</p>
<p>As you can see in the <code class="docutils literal notranslate"><span class="pre">training_iteration</span></code> column, trials with a high loss (and low accuracy) have been terminated early. The best performing trial used
<code class="docutils literal notranslate"><span class="pre">batch_size=64</span></code>, <code class="docutils literal notranslate"><span class="pre">layer_1_size=128</span></code>, <code class="docutils literal notranslate"><span class="pre">layer_2_size=256</span></code>, and <code class="docutils literal notranslate"><span class="pre">lr=0.0037</span></code>.</p>
</section>
</section>
<section id="more-pytorch-lightning-examples">
<h2>More PyTorch Lightning Examples<a class="headerlink" href="#more-pytorch-lightning-examples" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../../train/examples/lightning/lightning_mnist_example.html#lightning-mnist-example"><span class="std std-ref">[Basic] Train a PyTorch Lightning Image Classifier with Ray Train</span></a>.</p></li>
<li><p><a class="reference internal" href="../../train/examples/lightning/lightning_cola_advanced.html#lightning-advanced-example"><span class="std std-ref">[Intermediate] Fine-tune a BERT Text Classifier with PyTorch Lightning and Ray Train</span></a></p></li>
<li><p><a class="reference internal" href="../../train/examples/lightning/dolly_lightning_fsdp_finetuning.html#dolly-lightning-fsdp-finetuning"><span class="std std-ref">[Advanced] Fine-tune dolly-v2-7b with PyTorch Lightning and FSDP</span></a></p></li>
<li><p><a class="reference internal" href="includes/mlflow_ptl_example.html"><span class="doc">MLflow PyTorch Lightning Example</span></a>: Example for using <a class="reference external" href="https://github.com/mlflow/mlflow/">MLflow</a>
and <a class="reference external" href="https://github.com/PyTorchLightning/pytorch-lightning">Pytorch Lightning</a> with Ray Tune.</p></li>
</ul>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="tune-pytorch-cifar.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">How to use Tune with PyTorch</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="tune-serve-integration-mnist.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Model selection and serving with Ray Tune and Ray Serve</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><!-- Override the footer area for the sphinx-book-theme to include the CSAT widget -->
<div id="csat">
  <div id="csat-feedback-received" class="csat-hidden">
    <span>谢谢你的反馈！</span>
  </div>
  <div id="csat-inputs">
    <span>是否能帮助到你？</span>
    <div id="csat-yes" class="csat-button">
      <svg id="csat-yes-icon" class="csat-hidden csat-icon" width="18" height="13" viewBox="0 0 18 13" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.00023 10.172L16.1922 0.979004L17.6072 2.393L7.00023 13L0.63623 6.636L2.05023 5.222L7.00023 10.172Z" fill="black"/>
      </svg>
      <span>是<span>
    </div>
    <div id="csat-no" class="csat-button">
      <svg id="csat-no-icon" class="csat-hidden csat-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.00023 5.58599L11.9502 0.635986L13.3642 2.04999L8.41423 6.99999L13.3642 11.95L11.9502 13.364L7.00023 8.41399L2.05023 13.364L0.63623 11.95L5.58623 6.99999L0.63623 2.04999L2.05023 0.635986L7.00023 5.58599Z" fill="black"/>
      </svg>
      <span>否<span>
    </div>
  </div>
  <div id="csat-textarea-group" class="csat-hidden">
    <span id="csat-feedback-label">反馈</span>
    <textarea id="csat-textarea"></textarea>
    <div id="csat-submit">提交</div>
  </div>
</div><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2024, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>