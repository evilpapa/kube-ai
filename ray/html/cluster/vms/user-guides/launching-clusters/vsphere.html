
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Launching Ray Clusters on vSphere &#8212; Ray 2.7.2</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/js/versionwarning.js"></script>
    <script src="../../../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../../../_static/js/docsearch.js"></script>
    <script defer="defer" src="../../../../_static/js/csat.js"></script>
    <script defer="defer" src="../../../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../../../_static/js/custom.js"></script>
    <script defer="defer" src="../../../../_static/js/top-navigation.js"></script>
    <script src="../../../../_static/js/tags.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../_static/design-tabs.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/cluster/vms/user-guides/launching-clusters/vsphere.html" />
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Launching an On-Premise Cluster" href="on-premises.html" />
    <link rel="prev" title="Launching Ray Clusters on Azure" href="azure.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
  data-modal-disclaimer = "Results are automated and may be incorrect or contain inappropriate information. Do not include any personal data or confidential information."
  data-modal-title = "Ray Docs AI - Ask a Question"
  data-button-position-bottom = "60px"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 2.7.2</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../index.html">
                    欢迎来到 Ray ！
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/index.html">
   概述「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/getting-started.html">
   入门「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/installation.html">
   安装「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/use-cases.html">
   用例「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/examples.html">
   示例库「1%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-overview/ray-libraries.html">
   生态「3%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-core/walkthrough.html">
   Ray 核心「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../data/data.html">
   Ray 数据「85%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../train/train.html">
   Ray 训练「95%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../tune/index.html">
   Ray 调参「0%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../serve/index.html">
   Ray Serve「1%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../rllib/index.html">
   Ray RLlib「0%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-more-libs/index.html">
   更多类库「40%」
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../../getting-started.html">
   Ray 集群「100%」
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../../../key-concepts.html">
     关键概念
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../kubernetes/index.html">
     在 Kubernetes 部署
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../../index.html">
     在虚拟机部署
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="../../getting-started.html">
       Getting Started
      </a>
     </li>
     <li class="toctree-l3 current active has-children">
      <a class="reference internal" href="../index.html">
       用户指南
      </a>
      <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul class="current">
       <li class="toctree-l4 current active">
        <a class="reference internal" href="index.html">
         Launching Ray Clusters on AWS, GCP, Azure, vSphere, On-Prem
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../large-cluster-best-practices.html">
         Best practices for deploying large clusters
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../configuring-autoscaling.html">
         Configuring Autoscaling
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../logging.html">
         Log Persistence
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../community/index.html">
         Community Supported Cluster Managers
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../examples/index.html">
       示例
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../references/index.html">
       API References
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../metrics.html">
     指标收集和监控
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../configure-manage-dashboard.html">
     配置管理 Ray 仪表盘
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../running-applications/index.html">
     应用指引
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../faq.html">
     Ray 集群是否支持多租户？
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../package-overview.html">
     Ray Cluster 管理 API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-observability/index.html">
   监控调试「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-references/api.html">
   参考「20%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-contribute/index.html">
   开发者指引「30%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../ray-security/index.html">
   安全「100%」
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fcluster/vms/user-guides/launching-clusters/vsphere.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/cluster/vms/user-guides/launching-clusters/vsphere.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../../_sources/cluster/vms/user-guides/launching-clusters/vsphere.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prepare-the-vsphere-environment">
   Prepare the vSphere environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prepare-the-frozen-vm">
   Prepare the frozen VM
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-ray-cluster-launcher">
   Install Ray cluster launcher
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-vmware-vsphere-automation-sdk-for-python">
   Install VMware vSphere Automation SDK for Python
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#start-ray-with-the-ray-cluster-launcher">
   Start Ray with the Ray cluster launcher
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configure-vsan-file-service-as-persistent-storage-for-ray-air">
   Configure vSAN File Service as persistent storage for Ray AIR
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Launching Ray Clusters on vSphere</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prepare-the-vsphere-environment">
   Prepare the vSphere environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prepare-the-frozen-vm">
   Prepare the frozen VM
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-ray-cluster-launcher">
   Install Ray cluster launcher
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-vmware-vsphere-automation-sdk-for-python">
   Install VMware vSphere Automation SDK for Python
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#start-ray-with-the-ray-cluster-launcher">
   Start Ray with the Ray cluster launcher
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configure-vsan-file-service-as-persistent-storage-for-ray-air">
   Configure vSAN File Service as persistent storage for Ray AIR
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="launching-ray-clusters-on-vsphere">
<h1>Launching Ray Clusters on vSphere<a class="headerlink" href="#launching-ray-clusters-on-vsphere" title="Permalink to this headline">#</a></h1>
<p>This guide details the steps needed to launch a Ray cluster in a vSphere environment.</p>
<p>To start a vSphere Ray cluster, you will use the Ray cluster launcher with the VMware vSphere Automation SDK for Python.</p>
<section id="prepare-the-vsphere-environment">
<h2>Prepare the vSphere environment<a class="headerlink" href="#prepare-the-vsphere-environment" title="Permalink to this headline">#</a></h2>
<p>If you don’t already have a vSphere deployment, you can learn more about it by reading the <a class="reference external" href="https://docs.vmware.com/en/VMware-vSphere/index.html">vSphere documentation</a>. The following prerequisites are needed in order to create Ray clusters.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-vcenter-esxi-management/GUID-F7818000-26E3-4E2A-93D2-FCDCE7114508.html">A vSphere cluster</a> and <a class="reference external" href="https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-resource-management/GUID-60077B40-66FF-4625-934A-641703ED7601.html">resource pools</a> to host VMs composing Ray Clusters.</p></li>
<li><p>A network port group (either for a <a class="reference external" href="https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-networking/GUID-E198C88A-F82C-4FF3-96C9-E3DF0056AD0C.html">standard switch</a> or <a class="reference external" href="https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-networking/GUID-375B45C7-684C-4C51-BA3C-70E48DFABF04.html">distributed switch</a>) or an <a class="reference external" href="https://docs.vmware.com/en/VMware-NSX/4.1/administration/GUID-316E5027-E588-455C-88AD-A7DA930A4F0B.html">NSX segment</a>. VMs connected to this network should be able to obtain IP address via DHCP.</p></li>
<li><p>A datastore that can be accessed by all the hosts in the vSphere cluster.</p></li>
</ul>
<p>Another way to prepare the vSphere environment is with VMware Cloud Foundation (VCF). VCF is a unified software-defined datacenter (SDDC) platform that seamlessly integrates vSphere, vSAN, and NSX into a natively integrated stack, delivering enterprise-ready cloud infrastructure for both private and public cloud environments. If you are using VCF, you can refer to the VCF documentation to  <a class="reference external" href="https://docs.vmware.com/en/VMware-Cloud-Foundation/5.0/vcf-admin/GUID-3A478CF8-AFF8-43D9-9635-4E40A0E372AD.html">create workload domains</a> for running Ray Clusters. A VCF workload domain comprises one or more vSphere clusters, shared storage like vSAN, and a software-defined network managed by NSX. You can also <a class="reference external" href="https://docs.vmware.com/en/VMware-Cloud-Foundation/5.0/vcf-admin/GUID-D17D0274-7764-43BD-8252-D9333CA7415A.html">create NSX Edge Clusters using VCF</a> and create segment for Ray VMs network.</p>
</section>
<section id="prepare-the-frozen-vm">
<h2>Prepare the frozen VM<a class="headerlink" href="#prepare-the-frozen-vm" title="Permalink to this headline">#</a></h2>
<p>The vSphere Ray cluster launcher requires the vSphere environment to have a VM in a frozen state prior to deploying a Ray cluster. This VM has all the dependencies installed and is later used to rapidly create head and worker nodes by VMware’s <a class="reference external" href="https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-vm-administration/GUID-853B1E2B-76CE-4240-A654-3806912820EB.html">instant clone</a> technology. The internal details of the Ray cluster provisioning process using frozen VM can be found in this <a class="reference external" href="https://github.com/ray-project/ray/blob/master/python/ray/autoscaler/_private/vsphere/ARCHITECTURE.md">Ray on vSphere architecture document</a>.</p>
<p>You can follow <a class="reference external" href="https://via.vmw.com/frozen-vm-ovf">this document</a> to create and set up the frozen VM, or a set of frozen VMs in which each one will be hosted on a distinct ESXi host in the vSphere cluster. By default, Ray clusters’ head and worker node VMs will be placed in the same resource pool as the frozen VM. When building and deploying the frozen VM, there are a couple of things to note:</p>
<ul class="simple">
<li><p>The VM’s network adapter should be connected to the port group or NSX segment configured in the above section. And the <code class="docutils literal notranslate"><span class="pre">Connect</span> <span class="pre">At</span> <span class="pre">Power</span> <span class="pre">On</span></code> check box should be selected.</p></li>
<li><p>After the frozen VM is built, a private key file (<code class="docutils literal notranslate"><span class="pre">ray-bootstrap-key.pem</span></code>) and a public key file (<code class="docutils literal notranslate"><span class="pre">ray_bootstrap_public_key.key</span></code>) will be generated under the HOME directory of the current user. If you want to deploy Ray clusters from another machine, these files should be copied to that machine’s HOME directory to be picked up by the vSphere cluster launcher.</p></li>
<li><p>An OVF will be generated in the content library. If you want to deploy Ray clusters in other vSphere deployments, you can export the OVF and use it to create the frozen VM, instead of building it again from scratch.</p></li>
<li><p>The VM should be in powered-on status before you launch Ray clusters.</p></li>
</ul>
</section>
<section id="install-ray-cluster-launcher">
<h2>Install Ray cluster launcher<a class="headerlink" href="#install-ray-cluster-launcher" title="Permalink to this headline">#</a></h2>
<p>The Ray cluster launcher is part of the <code class="docutils literal notranslate"><span class="pre">ray</span></code> CLI. Use the CLI to start, stop and attach to a running ray cluster using commands such as <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">up</span></code>, <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">down</span></code> and <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">attach</span></code>. You can use pip to install the ray CLI with cluster launcher support. Follow <a class="reference internal" href="../../../../ray-overview/installation.html#installation"><span class="std std-ref">the Ray installation documentation</span></a> for more detailed instructions.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># install ray</span>
pip install -U ray<span class="o">[</span>default<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="install-vmware-vsphere-automation-sdk-for-python">
<h2>Install VMware vSphere Automation SDK for Python<a class="headerlink" href="#install-vmware-vsphere-automation-sdk-for-python" title="Permalink to this headline">#</a></h2>
<p>Next, install the VMware vSphere Automation SDK for Python.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install the VMware vSphere Automation SDK for Python.</span>
pip install <span class="s1">&#39;git+https://github.com/vmware/vsphere-automation-sdk-python.git&#39;</span>
</pre></div>
</div>
<p>You can append a version tag to install a specific version.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install the v8.0.1.0 version of the SDK.</span>
pip install <span class="s1">&#39;git+https://github.com/vmware/vsphere-automation-sdk-python.git@v8.0.1.0&#39;</span>
</pre></div>
</div>
</section>
<section id="start-ray-with-the-ray-cluster-launcher">
<h2>Start Ray with the Ray cluster launcher<a class="headerlink" href="#start-ray-with-the-ray-cluster-launcher" title="Permalink to this headline">#</a></h2>
<p>Once the vSphere Automation SDK is installed, you should be ready to launch your cluster using the cluster launcher. The provided <a class="reference external" href="https://raw.githubusercontent.com/ray-project/ray/master/python/ray/autoscaler/vsphere/example-full.yaml">cluster config file</a> will create a small cluster with a head node configured to autoscale to up to two workers.</p>
<p>Note that you need to configure your vSphere credentials and vCenter server address either via setting environment variables or adding them to the Ray cluster configuration YAML file.</p>
<p>Test that it works by running the following commands from your local machine:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the example-full.yaml</span>
wget https://raw.githubusercontent.com/ray-project/ray/master/python/ray/autoscaler/vsphere/example-full.yaml

<span class="c1"># Setup vSphere credentials using environment variables</span>
<span class="nb">export</span> <span class="nv">VSPHERE_SERVER</span><span class="o">=</span>vcenter-address.example.com
<span class="nb">export</span> <span class="nv">VSPHERE_USER</span><span class="o">=</span>foo
<span class="nb">export</span> <span class="nv">VSPHERE_PASSWORD</span><span class="o">=</span>bar

<span class="c1"># Edit the example-full.yaml to update the frozen VM related configs under vsphere_config. there are 3 options:</span>
<span class="c1"># 1. If you have a single frozen VM, set the &quot;name&quot; under &quot;frozen_vm&quot;.</span>
<span class="c1"># 2. If you have a set of frozen VMs in a resource pool (one VM on each ESXi host), set the &quot;resource_pool&quot; under &quot;frozen_vm&quot;.</span>
<span class="c1"># 3. If you don&#39;t have any existing frozen VM in the vSphere cluster, but you have an OVF template of a frozen VM, set the &quot;library_item&quot; under &quot;frozen_vm&quot;. After that, you need to either set the &quot;name&quot; of the to-be-deployed frozen VM, or set the &quot;resource_pool&quot; to point to an existing resource pool for the to-be-deployed frozen VMs for all the ESXi hosts in the vSphere cluster. Also, the &quot;datastore&quot; must be specified.</span>
<span class="c1"># Optionally configure the head and worker node resource pool and datastore placement.</span>
<span class="c1"># If not configured via environment variables, the vSphere credentials can alternatively be configured in this file.</span>

<span class="c1"># vi example-full.yaml</span>

<span class="c1"># Create or update the cluster. When the command finishes, it will print</span>
<span class="c1"># out the command that can be used to SSH into the cluster head node.</span>
ray up example-full.yaml

<span class="c1"># Get a remote screen on the head node.</span>
ray attach example-full.yaml

<span class="c1"># Try running a Ray program.</span>
python -c <span class="s1">&#39;import ray; ray.init()&#39;</span>
<span class="nb">exit</span>

<span class="c1"># Tear down the cluster.</span>
ray down example-full.yaml
</pre></div>
</div>
<p>Congrats, you have started a Ray cluster on vSphere!</p>
</section>
<section id="configure-vsan-file-service-as-persistent-storage-for-ray-air">
<h2>Configure vSAN File Service as persistent storage for Ray AIR<a class="headerlink" href="#configure-vsan-file-service-as-persistent-storage-for-ray-air" title="Permalink to this headline">#</a></h2>
<p>Starting in Ray 2.7, Ray AIR (Train and Tune) will require users to provide a cloud storage or NFS path when running distributed training or tuning jobs. In a vSphere environment with a vSAN datastore, you can utilize the vSAN File Service feature to employ vSAN as a shared persistent storage. You can refer to <a class="reference external" href="https://docs.vmware.com/en/VMware-vSphere/8.0/vsan-administration/GUID-CA9CF043-9434-454E-86E7-DCA9AD9B0C09.html">this vSAN File Service document</a> to create and configure NFS file shares supported by vSAN. The general steps are as follows:</p>
<ol class="simple">
<li><p>Enable vSAN File Service and configure it with domain information and IP address pools.</p></li>
<li><p>Create a vSAN file share with NFS as the protocol.</p></li>
<li><p>View the file share information to get NFS export path.</p></li>
</ol>
<p>Once a file share is created, you can mount it into the head and worker node and use the mount path as the <code class="docutils literal notranslate"><span class="pre">storage_path</span></code> for Ray AIR’s <code class="docutils literal notranslate"><span class="pre">RunConfig</span></code> parameter. Please refer to <a class="reference external" href="https://raw.githubusercontent.com/ray-project/ray/master/python/ray/autoscaler/vsphere/example-vsan-file-service.yaml">this example YAML</a> as a template on how to mount and configure the path. You will need to modify the NFS export path in the <code class="docutils literal notranslate"><span class="pre">initialization_commands</span></code> list and bind the mounted path within the Ray container. In this example, you will need to put <code class="docutils literal notranslate"><span class="pre">/mnt/shared_storage/experiment_results</span></code> as the <code class="docutils literal notranslate"><span class="pre">storage_path</span></code> for <code class="docutils literal notranslate"><span class="pre">RunConfig</span></code>.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="azure.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Launching Ray Clusters on Azure</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="on-premises.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Launching an On-Premise Cluster</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><!-- Override the footer area for the sphinx-book-theme to include the CSAT widget -->
<div id="csat">
  <div id="csat-feedback-received" class="csat-hidden">
    <span>谢谢你的反馈！</span>
  </div>
  <div id="csat-inputs">
    <span>是否能帮助到你？</span>
    <div id="csat-yes" class="csat-button">
      <svg id="csat-yes-icon" class="csat-hidden csat-icon" width="18" height="13" viewBox="0 0 18 13" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.00023 10.172L16.1922 0.979004L17.6072 2.393L7.00023 13L0.63623 6.636L2.05023 5.222L7.00023 10.172Z" fill="black"/>
      </svg>
      <span>是<span>
    </div>
    <div id="csat-no" class="csat-button">
      <svg id="csat-no-icon" class="csat-hidden csat-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.00023 5.58599L11.9502 0.635986L13.3642 2.04999L8.41423 6.99999L13.3642 11.95L11.9502 13.364L7.00023 8.41399L2.05023 13.364L0.63623 11.95L5.58623 6.99999L0.63623 2.04999L2.05023 0.635986L7.00023 5.58599Z" fill="black"/>
      </svg>
      <span>否<span>
    </div>
  </div>
  <div id="csat-textarea-group" class="csat-hidden">
    <span id="csat-feedback-label">反馈</span>
    <textarea id="csat-textarea"></textarea>
    <div id="csat-submit">提交</div>
  </div>
</div><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2024, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>