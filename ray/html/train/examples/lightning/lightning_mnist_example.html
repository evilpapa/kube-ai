
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>训练 Pytorch Lightning 图像分类器 &#8212; Ray 2.7.2</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/versionwarning.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../../_static/js/docsearch.js"></script>
    <script defer="defer" src="../../../_static/js/csat.js"></script>
    <script defer="defer" src="../../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../../_static/js/custom.js"></script>
    <script defer="defer" src="../../../_static/js/top-navigation.js"></script>
    <script src="../../../_static/js/tags.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/train/examples/lightning/lightning_mnist_example.html" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
  data-modal-disclaimer = "Results are automated and may be incorrect or contain inappropriate information. Do not include any personal data or confidential information."
  data-modal-title = "Ray Docs AI - Ask a Question"
  data-button-position-bottom = "60px"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 2.7.2</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    欢迎来到 Ray ！
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/index.html">
   概述「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/getting-started.html">
   入门「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/installation.html">
   安装「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/use-cases.html">
   用例「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/examples.html">
   示例库「1%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-overview/ray-libraries.html">
   生态「3%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-core/walkthrough.html">
   Ray 核心「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../data/data.html">
   Ray 数据「85%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../train.html">
   Ray 训练「95%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../tune/index.html">
   Ray 调参「0%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../serve/index.html">
   Ray Serve「1%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../rllib/index.html">
   Ray RLlib「0%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-more-libs/index.html">
   更多类库「40%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../cluster/getting-started.html">
   Ray 集群「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-observability/index.html">
   监控调试「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-references/api.html">
   参考「20%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-contribute/index.html">
   开发者指引「30%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ray-security/index.html">
   安全「100%」
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Ftrain/examples/lightning/lightning_mnist_example.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/train/examples/lightning/lightning_mnist_example.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/train/examples/lightning/lightning_mnist_example.ipynb.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   准备数据集和模块
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   定义训练函数
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   检查训练结果和检查点
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   也可以看看
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>训练 Pytorch Lightning 图像分类器</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   准备数据集和模块
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   定义训练函数
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   检查训练结果和检查点
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   也可以看看
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="pytorch-lightning">
<span id="lightning-mnist-example"></span><h1>训练 Pytorch Lightning 图像分类器<a class="headerlink" href="#pytorch-lightning" title="Permalink to this headline">#</a></h1>
<p>此示例介绍如何使用 Ray Train 训练 Pytorch Lightning 模块 <a class="reference internal" href="../../api/doc/ray.train.torch.TorchTrainer.html#ray.train.torch.TorchTrainer" title="ray.train.torch.TorchTrainer"><code class="xref py py-class docutils literal notranslate"><span class="pre">TorchTrainer</span></code></a>。它演示了如何使用分布式数据并行在 MNIST 数据集上训练基本神经网络。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install <span class="s2">&quot;torchmetrics&gt;=0.9&quot;</span> <span class="s2">&quot;pytorch_lightning&gt;=1.6&quot;</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">from</span> <span class="nn">filelock</span> <span class="kn">import</span> <span class="n">FileLock</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">random_split</span><span class="p">,</span> <span class="n">Subset</span>
<span class="kn">from</span> <span class="nn">torchmetrics</span> <span class="kn">import</span> <span class="n">Accuracy</span>
<span class="kn">from</span> <span class="nn">torchvision.datasets</span> <span class="kn">import</span> <span class="n">MNIST</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">transforms</span>

<span class="kn">import</span> <span class="nn">pytorch_lightning</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">from</span> <span class="nn">pytorch_lightning</span> <span class="kn">import</span> <span class="n">trainer</span>
<span class="kn">from</span> <span class="nn">pytorch_lightning.loggers.csv_logs</span> <span class="kn">import</span> <span class="n">CSVLogger</span>
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h2>准备数据集和模块<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h2>
<p>Pytorch Lightning Trainer 接受 <code class="docutils literal notranslate"><span class="pre">torch.utils.data.DataLoader</span></code> 或 <code class="docutils literal notranslate"><span class="pre">pl.LightningDataModule</span></code> 作为数据输入。您可以继续使用它们，而无需对 Ray Train 进行任何更改。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MNISTDataModule</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">LightningDataModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
            <span class="p">[</span><span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">((</span><span class="mf">0.1307</span><span class="p">,),</span> <span class="p">(</span><span class="mf">0.3081</span><span class="p">,))]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">FileLock</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="si">}</span><span class="s2">.lock&quot;</span><span class="p">):</span>
            <span class="n">mnist</span> <span class="o">=</span> <span class="n">MNIST</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
            <span class="p">)</span>

            <span class="c1"># Split data into train and val sets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mnist_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnist_val</span> <span class="o">=</span> <span class="n">random_split</span><span class="p">(</span><span class="n">mnist</span><span class="p">,</span> <span class="p">[</span><span class="mi">55000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">train_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DataLoader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mnist_train</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">val_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DataLoader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mnist_val</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">FileLock</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="si">}</span><span class="s2">.lock&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mnist_test</span> <span class="o">=</span> <span class="n">MNIST</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">DataLoader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mnist_test</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>接下来，定义一个简单的多层感知作为的子类 <code class="docutils literal notranslate"><span class="pre">pl.LightningModule</span></code>。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MNISTClassifier</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">LightningModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">feature_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">421</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MNISTClassifier</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">linear_relu_stack</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span> <span class="o">*</span> <span class="mi">28</span><span class="p">,</span> <span class="n">feature_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">feature_dim</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="n">lr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span> <span class="o">=</span> <span class="n">Accuracy</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;multiclass&quot;</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_loss</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_accuracy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_accuracy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">seed_everything</span><span class="p">(</span><span class="mi">888</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span> <span class="o">*</span> <span class="mi">28</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_relu_stack</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">training_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">batch</span>
        <span class="n">y_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;train_loss&quot;</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loss</span>

    <span class="k">def</span> <span class="nf">validation_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val_batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">):</span>
        <span class="n">loss</span><span class="p">,</span> <span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shared_eval</span><span class="p">(</span><span class="n">val_batch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;val_accuracy&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_loss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_accuracy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;val_loss&quot;</span><span class="p">:</span> <span class="n">loss</span><span class="p">,</span> <span class="s2">&quot;val_accuracy&quot;</span><span class="p">:</span> <span class="n">acc</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">test_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">):</span>
        <span class="n">loss</span><span class="p">,</span> <span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shared_eval</span><span class="p">(</span><span class="n">test_batch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_accuracy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;test_accuracy&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">sync_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_epoch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;test_loss&quot;</span><span class="p">:</span> <span class="n">loss</span><span class="p">,</span> <span class="s2">&quot;test_accuracy&quot;</span><span class="p">:</span> <span class="n">acc</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_shared_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">batch</span>
        <span class="n">logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">nll_loss</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">acc</span>

    <span class="k">def</span> <span class="nf">on_validation_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">avg_loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_loss</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">avg_acc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_accuracy</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;val_loss&quot;</span><span class="p">,</span> <span class="n">avg_loss</span><span class="p">,</span> <span class="n">sync_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;val_accuracy&quot;</span><span class="p">,</span> <span class="n">avg_acc</span><span class="p">,</span> <span class="n">sync_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_loss</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_accuracy</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">configure_optimizers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">optimizer</span>
</pre></div>
</div>
</div>
</div>
<p>您不需要修改 PyTorch Lightning 模型或数据模块的定义。</p>
</section>
<section id="id2">
<h2>定义训练函数<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h2>
<p>此代码为每个 worker 定义了一个 <a class="reference internal" href="../../overview.html#train-overview-training-function"><span class="std std-ref">训练函数</span></a> 。将训练函数与原始 PyTorch Lightning 代码进行比较，请注意三个主要区别：</p>
<ul class="simple">
<li><p>分布式策略: 使用 <a class="reference internal" href="../../api/doc/ray.train.lightning.RayDDPStrategy.html#ray.train.lightning.RayDDPStrategy" title="ray.train.lightning.RayDDPStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">RayDDPStrategy</span></code></a>。</p></li>
<li><p>集群环境: 使用 <a class="reference internal" href="../../api/doc/ray.train.lightning.RayLightningEnvironment.html#ray.train.lightning.RayLightningEnvironment" title="ray.train.lightning.RayLightningEnvironment"><code class="xref py py-class docutils literal notranslate"><span class="pre">RayLightningEnvironment</span></code></a>。</p></li>
<li><p>并发设备: <code class="docutils literal notranslate"><span class="pre">TorchTrainer</span></code> 配置始终设置为 <code class="docutils literal notranslate"><span class="pre">devices=&quot;auto&quot;</span></code> 来使用所有可用设备。</p></li>
</ul>
<p>参考 <a class="reference internal" href="../../getting-started-pytorch-lightning.html#train-pytorch-lightning"><span class="std std-ref">PyTorch Lightning 入门</span></a> 获取更多信息。</p>
<p>对于检查点报告，Ray Train 提供了一个最小 <a class="reference internal" href="../../api/doc/ray.train.lightning.RayTrainReportCallback.html#ray.train.lightning.RayTrainReportCallback" title="ray.train.lightning.RayTrainReportCallback"><code class="xref py py-class docutils literal notranslate"><span class="pre">RayTrainReportCallback</span></code></a> 类，用于在每个训练时期结束时报告指标和检查点。对于更复杂的检查点逻辑，请实现自定义回调。请参阅 <a class="reference internal" href="../../user-guides/checkpoints.html#train-checkpointing"><span class="std std-ref">保存和加载检查点</span></a>。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Set to False if you want to run without GPUs</span>
<span class="n">num_workers</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytorch_lightning</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">from</span> <span class="nn">ray.train</span> <span class="kn">import</span> <span class="n">RunConfig</span><span class="p">,</span> <span class="n">ScalingConfig</span><span class="p">,</span> <span class="n">CheckpointConfig</span>
<span class="kn">from</span> <span class="nn">ray.train.torch</span> <span class="kn">import</span> <span class="n">TorchTrainer</span>
<span class="kn">from</span> <span class="nn">ray.train.lightning</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RayDDPStrategy</span><span class="p">,</span>
    <span class="n">RayLightningEnvironment</span><span class="p">,</span>
    <span class="n">RayTrainReportCallback</span><span class="p">,</span>
    <span class="n">prepare_trainer</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">train_func_per_worker</span><span class="p">():</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MNISTClassifier</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">feature_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">datamodule</span> <span class="o">=</span> <span class="n">MNISTDataModule</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>

    <span class="n">trainer</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span>
        <span class="n">devices</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">strategy</span><span class="o">=</span><span class="n">RayDDPStrategy</span><span class="p">(),</span>
        <span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">RayLightningEnvironment</span><span class="p">()],</span>
        <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">RayTrainReportCallback</span><span class="p">()],</span>
        <span class="n">max_epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">accelerator</span><span class="o">=</span><span class="s2">&quot;gpu&quot;</span> <span class="k">if</span> <span class="n">use_gpu</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
        <span class="n">log_every_n_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">CSVLogger</span><span class="p">(</span><span class="s2">&quot;logs&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    
    <span class="n">trainer</span> <span class="o">=</span> <span class="n">prepare_trainer</span><span class="p">(</span><span class="n">trainer</span><span class="p">)</span>
    
    <span class="c1"># Train model</span>
    <span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">datamodule</span><span class="o">=</span><span class="n">datamodule</span><span class="p">)</span>

    <span class="c1"># Evaluation on the test dataset</span>
    <span class="n">trainer</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">datamodule</span><span class="o">=</span><span class="n">datamodule</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>现在把所有内容放在一起：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaling_config</span> <span class="o">=</span> <span class="n">ScalingConfig</span><span class="p">(</span><span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span> <span class="n">use_gpu</span><span class="o">=</span><span class="n">use_gpu</span><span class="p">)</span>

<span class="n">run_config</span> <span class="o">=</span> <span class="n">RunConfig</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ptl-mnist-example&quot;</span><span class="p">,</span>
    <span class="n">storage_path</span><span class="o">=</span><span class="s2">&quot;/tmp/ray_results&quot;</span><span class="p">,</span>
    <span class="n">checkpoint_config</span><span class="o">=</span><span class="n">CheckpointConfig</span><span class="p">(</span>
        <span class="n">num_to_keep</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">checkpoint_score_attribute</span><span class="o">=</span><span class="s2">&quot;val_accuracy&quot;</span><span class="p">,</span>
        <span class="n">checkpoint_score_order</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">trainer</span> <span class="o">=</span> <span class="n">TorchTrainer</span><span class="p">(</span>
    <span class="n">train_func_per_worker</span><span class="p">,</span>
    <span class="n">scaling_config</span><span class="o">=</span><span class="n">scaling_config</span><span class="p">,</span>
    <span class="n">run_config</span><span class="o">=</span><span class="n">run_config</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>现在开始你的训练：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class="tuneStatus">
  <div style="display: flex;flex-direction: row">
    <div style="display: flex;flex-direction: column;">
      <h3>Tune Status</h3>
      <table>
<tbody>
<tr><td>Current time:</td><td>2023-08-07 23:41:11</td></tr>
<tr><td>Running for: </td><td>00:00:39.80        </td></tr>
<tr><td>Memory:      </td><td>24.2/186.6 GiB     </td></tr>
</tbody>
</table>
    </div>
    <div class="vDivider"></div>
    <div class="systemInfo">
      <h3>System Info</h3>
      Using FIFO scheduling algorithm.<br>Logical resource usage: 1.0/48 CPUs, 4.0/4 GPUs
    </div>

  </div>
  <div class="hDivider"></div>
  <div class="trialStatus">
    <h3>Trial Status</h3>
    <table>
<thead>
<tr><th>Trial name              </th><th>status    </th><th>loc              </th><th style="text-align: right;">  iter</th><th style="text-align: right;">  total time (s)</th><th style="text-align: right;">  train_loss</th><th style="text-align: right;">  val_accuracy</th><th style="text-align: right;">  val_loss</th></tr>
</thead>
<tbody>
<tr><td>TorchTrainer_78346_00000</td><td>TERMINATED</td><td>10.0.6.244:120026</td><td style="text-align: right;">    10</td><td style="text-align: right;">         29.0221</td><td style="text-align: right;">   0.0315938</td><td style="text-align: right;">      0.970002</td><td style="text-align: right;">  -12.3466</td></tr>
</tbody>
</table>
  </div>
</div>
<style>
.tuneStatus {
  color: var(--jp-ui-font-color1);
}
.tuneStatus .systemInfo {
  display: flex;
  flex-direction: column;
}
.tuneStatus td {
  white-space: nowrap;
}
.tuneStatus .trialStatus {
  display: flex;
  flex-direction: column;
}
.tuneStatus h3 {
  font-weight: bold;
}
.tuneStatus .hDivider {
  border-bottom-width: var(--jp-border-width);
  border-bottom-color: var(--jp-border-color0);
  border-bottom-style: solid;
}
.tuneStatus .vDivider {
  border-left-width: var(--jp-border-width);
  border-left-color: var(--jp-border-color0);
  border-left-style: solid;
  margin: 0.5em 1em 0.5em 1em;
}
</style>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(TorchTrainer pid=120026)</span> Starting distributed worker processes: [&#39;120176 (10.0.6.244)&#39;, &#39;120177 (10.0.6.244)&#39;, &#39;120178 (10.0.6.244)&#39;, &#39;120179 (10.0.6.244)&#39;]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> Setting up process group for: env:// [rank=0, world_size=4]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> [rank: 0] Global seed set to 888
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> GPU available: True (cuda), used: True
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> TPU available: False, using: 0 TPU cores
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> IPU available: False, using: 0 IPUs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> HPU available: False, using: 0 HPUs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120178)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120178)</span> Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz to /tmp/ray_results/ptl-mnist-example/TorchTrainer_78346_00000_0_2023-08-07_23-40-31/rank_2/MNIST/raw/train-images-idx3-ubyte.gz
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/9912422 [00:00&lt;?, ?it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 94562894.32it/s]
  9%|▉         | 917504/9912422 [00:00&lt;00:00, 9166590.91it/s]
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 115619443.32it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120179)</span> Extracting /tmp/ray_results/ptl-mnist-example/TorchTrainer_78346_00000_0_2023-08-07_23-40-31/rank_3/MNIST/raw/train-images-idx3-ubyte.gz to /tmp/ray_results/ptl-mnist-example/TorchTrainer_78346_00000_0_2023-08-07_23-40-31/rank_3/MNIST/raw
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120177)</span> Missing logger folder: logs/lightning_logs
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1,2,3]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span>   | Name              | Type               | Params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> ---------------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> 0 | linear_relu_stack | Sequential         | 101 K 
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> 1 | accuracy          | MulticlassAccuracy | 0     
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> ---------------------------------------------------------
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> 101 K     Trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> 0         Non-trainable params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> 101 K     Total params
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> 0.407     Total estimated model params size (MB)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sanity Checking: 0it [00:00, ?it/s]) 
Sanity Checking DataLoader 0:   0%|          | 0/2 [00:00&lt;?, ?it/s]
Sanity Checking DataLoader 0: 100%|██████████| 2/2 [00:00&lt;00:00,  2.69it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> /mnt/cluster_storage/pypi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/logger_connector/result.py:432: PossibleUserWarning: It is recommended to use `self.log(&#39;val_accuracy&#39;, ..., sync_dist=True)` when logging on epoch level in distributed setting to accumulate the metric across devices.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span>   warning_cache.warn(
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120179)</span> [rank: 3] Global seed set to 888<span class=" -Color -Color-Green"> [repeated 7x across cluster] (Ray deduplicates logs by default. Set RAY_DEDUP_LOGS=0 to disable log deduplication, or see https://docs.ray.io/en/master/ray-observability/ray-logging.html#log-deduplication for more options.)</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 0:   0%|          | 0/108 [00:00&lt;?, ?it/s] 
Epoch 0:  12%|█▏        | 13/108 [00:00&lt;00:02, 39.35it/s, v_num=0]
Epoch 0:  25%|██▌       | 27/108 [00:00&lt;00:01, 59.26it/s, v_num=0]
Epoch 0:  26%|██▌       | 28/108 [00:00&lt;00:01, 61.03it/s, v_num=0]
Epoch 0:  27%|██▋       | 29/108 [00:00&lt;00:01, 62.76it/s, v_num=0]
Epoch 0:  42%|████▏     | 45/108 [00:00&lt;00:00, 81.02it/s, v_num=0]
Epoch 0:  53%|█████▎    | 57/108 [00:00&lt;00:00, 86.01it/s, v_num=0]
Epoch 0:  64%|██████▍   | 69/108 [00:00&lt;00:00, 88.63it/s, v_num=0]
Epoch 0:  81%|████████  | 87/108 [00:00&lt;00:00, 98.04it/s, v_num=0]
Epoch 0:  81%|████████▏ | 88/108 [00:00&lt;00:00, 98.69it/s, v_num=0]
Epoch 0:  82%|████████▏ | 89/108 [00:00&lt;00:00, 99.34it/s, v_num=0]
Epoch 0:  96%|█████████▋| 104/108 [00:00&lt;00:00, 104.14it/s, v_num=0]
Epoch 0:  97%|█████████▋| 105/108 [00:01&lt;00:00, 104.71it/s, v_num=0]
Epoch 0:  98%|█████████▊| 106/108 [00:01&lt;00:00, 105.22it/s, v_num=0]
Epoch 0: 100%|██████████| 108/108 [00:01&lt;00:00, 105.79it/s, v_num=0]
Validation: 0it [00:00, ?it/s]76) 
Validation:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:  10%|█         | 1/10 [00:00&lt;00:00, 171.69it/s]
Validation DataLoader 0:  20%|██        | 2/10 [00:00&lt;00:00, 200.99it/s]
Validation DataLoader 0:  30%|███       | 3/10 [00:00&lt;00:00, 221.66it/s]
Validation DataLoader 0:  40%|████      | 4/10 [00:00&lt;00:00, 215.50it/s]
Validation DataLoader 0:  50%|█████     | 5/10 [00:00&lt;00:00, 194.14it/s]
Validation DataLoader 0:  60%|██████    | 6/10 [00:00&lt;00:00, 205.63it/s]
Validation DataLoader 0:  70%|███████   | 7/10 [00:00&lt;00:00, 215.27it/s]
Validation DataLoader 0:  80%|████████  | 8/10 [00:00&lt;00:00, 216.26it/s]
Validation DataLoader 0:  90%|█████████ | 9/10 [00:00&lt;00:00, 198.67it/s]
Validation DataLoader 0: 100%|██████████| 10/10 [00:00&lt;00:00, 205.79it/s]
Epoch 0: 100%|██████████| 108/108 [00:01&lt;00:00, 79.84it/s, v_num=0] 
                                                                         
Epoch 1:   0%|          | 0/108 [00:00&lt;?, ?it/s, v_num=0]          
Epoch 1:  11%|█         | 12/108 [00:00&lt;00:02, 32.36it/s, v_num=0]
Epoch 1:  23%|██▎       | 25/108 [00:00&lt;00:01, 50.16it/s, v_num=0]
Epoch 1:  37%|███▋      | 40/108 [00:00&lt;00:01, 65.95it/s, v_num=0]
Epoch 1:  38%|███▊      | 41/108 [00:00&lt;00:00, 67.05it/s, v_num=0]
Epoch 1:  50%|█████     | 54/108 [00:00&lt;00:00, 75.52it/s, v_num=0]
Epoch 1:  51%|█████     | 55/108 [00:00&lt;00:00, 76.40it/s, v_num=0]
Epoch 1:  62%|██████▏   | 67/108 [00:00&lt;00:00, 81.72it/s, v_num=0]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120178)</span> Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz<span class=" -Color -Color-Green"> [repeated 15x across cluster]</span>
Epoch 1:  77%|███████▋  | 83/108 [00:00&lt;00:00, 89.48it/s, v_num=0]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120178)</span> Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz to /tmp/ray_results/ptl-mnist-example/TorchTrainer_78346_00000_0_2023-08-07_23-40-31/rank_2/MNIST/raw/t10k-labels-idx1-ubyte.gz<span class=" -Color -Color-Green"> [repeated 15x across cluster]</span>
Epoch 1:  78%|███████▊  | 84/108 [00:00&lt;00:00, 89.21it/s, v_num=0]
Epoch 1:  91%|█████████ | 98/108 [00:01&lt;00:00, 93.27it/s, v_num=0]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120178)</span> Extracting /tmp/ray_results/ptl-mnist-example/TorchTrainer_78346_00000_0_2023-08-07_23-40-31/rank_2/MNIST/raw/t10k-labels-idx1-ubyte.gz to /tmp/ray_results/ptl-mnist-example/TorchTrainer_78346_00000_0_2023-08-07_23-40-31/rank_2/MNIST/raw<span class=" -Color -Color-Green"> [repeated 15x across cluster]</span>
Epoch 1:  92%|█████████▏| 99/108 [00:01&lt;00:00, 93.94it/s, v_num=0]
Epoch 1:  93%|█████████▎| 100/108 [00:01&lt;00:00, 94.57it/s, v_num=0]
Epoch 1: 100%|██████████| 108/108 [00:01&lt;00:00, 98.06it/s, v_num=0]
Validation: 0it [00:00, ?it/s]76) 
Validation:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:  10%|█         | 1/10 [00:00&lt;00:00, 320.27it/s]
Validation DataLoader 0:  20%|██        | 2/10 [00:00&lt;00:00, 291.99it/s]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> <span class=" -Color -Color-Green"> [repeated 19x across cluster]</span>
Validation DataLoader 0:  30%|███       | 3/10 [00:00&lt;00:00, 291.61it/s]
Validation DataLoader 0:  40%|████      | 4/10 [00:00&lt;00:00, 268.90it/s]
Validation DataLoader 0:  50%|█████     | 5/10 [00:00&lt;00:00, 290.07it/s]
Validation DataLoader 0:  60%|██████    | 6/10 [00:00&lt;00:00, 293.52it/s]
Validation DataLoader 0:  70%|███████   | 7/10 [00:00&lt;00:00, 299.70it/s]
Validation DataLoader 0:  80%|████████  | 8/10 [00:00&lt;00:00, 304.80it/s]
Validation DataLoader 0:  90%|█████████ | 9/10 [00:00&lt;00:00, 310.16it/s]
Validation DataLoader 0: 100%|██████████| 10/10 [00:00&lt;00:00, 303.63it/s]
Epoch 1: 100%|██████████| 108/108 [00:01&lt;00:00, 76.12it/s, v_num=0]
                                                                         
Epoch 2:   0%|          | 0/108 [00:00&lt;?, ?it/s, v_num=0]          
Epoch 2:   7%|▋         | 8/108 [00:00&lt;00:03, 25.23it/s, v_num=0]
Epoch 2:  16%|█▌        | 17/108 [00:00&lt;00:02, 39.73it/s, v_num=0]
Epoch 2:  17%|█▋        | 18/108 [00:00&lt;00:02, 41.60it/s, v_num=0]
Epoch 2:  18%|█▊        | 19/108 [00:00&lt;00:02, 43.49it/s, v_num=0]
Epoch 2:  18%|█▊        | 19/108 [00:00&lt;00:02, 43.46it/s, v_num=0]
Epoch 2:  19%|█▊        | 20/108 [00:00&lt;00:01, 45.27it/s, v_num=0]
Epoch 2:  27%|██▋       | 29/108 [00:00&lt;00:01, 53.08it/s, v_num=0]
Epoch 2:  42%|████▏     | 45/108 [00:00&lt;00:00, 69.12it/s, v_num=0]
Epoch 2:  43%|████▎     | 46/108 [00:00&lt;00:00, 70.31it/s, v_num=0]
Epoch 2:  44%|████▎     | 47/108 [00:00&lt;00:00, 71.51it/s, v_num=0]
Epoch 2:  44%|████▍     | 48/108 [00:00&lt;00:00, 72.71it/s, v_num=0]
Epoch 2:  59%|█████▉    | 64/108 [00:00&lt;00:00, 83.97it/s, v_num=0]
Epoch 2:  75%|███████▌  | 81/108 [00:00&lt;00:00, 93.77it/s, v_num=0]
Epoch 2:  90%|████████▉ | 97/108 [00:00&lt;00:00, 99.35it/s, v_num=0]
Epoch 2: 100%|██████████| 108/108 [00:01&lt;00:00, 101.71it/s, v_num=0]
Validation: 0it [00:00, ?it/s]76) 
Validation:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:  10%|█         | 1/10 [00:00&lt;00:00, 212.13it/s]
Validation DataLoader 0:  20%|██        | 2/10 [00:00&lt;00:00, 184.45it/s]
Validation DataLoader 0:  30%|███       | 3/10 [00:00&lt;00:00, 228.42it/s]
Validation DataLoader 0:  40%|████      | 4/10 [00:00&lt;00:00, 225.00it/s]
Validation DataLoader 0:  50%|█████     | 5/10 [00:00&lt;00:00, 250.65it/s]
Validation DataLoader 0:  60%|██████    | 6/10 [00:00&lt;00:00, 251.36it/s]
Validation DataLoader 0:  70%|███████   | 7/10 [00:00&lt;00:00, 268.85it/s]
Validation DataLoader 0:  80%|████████  | 8/10 [00:00&lt;00:00, 256.15it/s]
Validation DataLoader 0:  90%|█████████ | 9/10 [00:00&lt;00:00, 269.87it/s]
Epoch 2: 100%|██████████| 108/108 [00:01&lt;00:00, 77.52it/s, v_num=0] it/s]
                                                                         
Epoch 3:   0%|          | 0/108 [00:00&lt;?, ?it/s, v_num=0]          
Epoch 3:   8%|▊         | 9/108 [00:00&lt;00:03, 25.68it/s, v_num=0]
Epoch 3:   9%|▉         | 10/108 [00:00&lt;00:03, 28.26it/s, v_num=0]
Epoch 3:  20%|██        | 22/108 [00:00&lt;00:01, 48.10it/s, v_num=0]
Epoch 3:  21%|██▏       | 23/108 [00:00&lt;00:01, 49.73it/s, v_num=0]
Epoch 3:  22%|██▏       | 24/108 [00:00&lt;00:01, 51.34it/s, v_num=0]
Epoch 3:  23%|██▎       | 25/108 [00:00&lt;00:01, 52.98it/s, v_num=0]
Epoch 3:  37%|███▋      | 40/108 [00:00&lt;00:00, 69.67it/s, v_num=0]
Epoch 3:  51%|█████     | 55/108 [00:00&lt;00:00, 80.93it/s, v_num=0]
Epoch 3:  64%|██████▍   | 69/108 [00:00&lt;00:00, 87.15it/s, v_num=0]
Epoch 3:  65%|██████▍   | 70/108 [00:00&lt;00:00, 88.04it/s, v_num=0]
Epoch 3:  66%|██████▌   | 71/108 [00:00&lt;00:00, 88.92it/s, v_num=0]
Epoch 3:  77%|███████▋  | 83/108 [00:00&lt;00:00, 92.62it/s, v_num=0]
Epoch 3:  86%|████████▌ | 93/108 [00:01&lt;00:00, 92.33it/s, v_num=0]
Epoch 3:  87%|████████▋ | 94/108 [00:01&lt;00:00, 92.93it/s, v_num=0]
Epoch 3:  88%|████████▊ | 95/108 [00:01&lt;00:00, 93.61it/s, v_num=0]
Epoch 3: 100%|██████████| 108/108 [00:01&lt;00:00, 97.43it/s, v_num=0]
Validation: 0it [00:00, ?it/s]76) 
Validation:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:  10%|█         | 1/10 [00:00&lt;00:00, 308.50it/s]
Validation DataLoader 0:  20%|██        | 2/10 [00:00&lt;00:00, 344.87it/s]
Validation DataLoader 0:  30%|███       | 3/10 [00:00&lt;00:00, 375.98it/s]
Validation DataLoader 0:  40%|████      | 4/10 [00:00&lt;00:00, 335.26it/s]
Validation DataLoader 0:  50%|█████     | 5/10 [00:00&lt;00:00, 327.34it/s]
Validation DataLoader 0:  60%|██████    | 6/10 [00:00&lt;00:00, 317.66it/s]
Validation DataLoader 0:  70%|███████   | 7/10 [00:00&lt;00:00, 332.79it/s]
Validation DataLoader 0:  80%|████████  | 8/10 [00:00&lt;00:00, 188.14it/s]
Validation DataLoader 0:  90%|█████████ | 9/10 [00:00&lt;00:00, 201.21it/s]
Epoch 3: 100%|██████████| 108/108 [00:01&lt;00:00, 75.94it/s, v_num=0]6it/s]
                                                                         
Epoch 4:   0%|          | 0/108 [00:00&lt;?, ?it/s, v_num=0]          
Epoch 4:  10%|█         | 11/108 [00:00&lt;00:03, 30.09it/s, v_num=0]
Epoch 4:  20%|██        | 22/108 [00:00&lt;00:01, 46.96it/s, v_num=0]
Epoch 4:  21%|██▏       | 23/108 [00:00&lt;00:01, 47.88it/s, v_num=0]
Epoch 4:  35%|███▌      | 38/108 [00:00&lt;00:01, 65.26it/s, v_num=0]
Epoch 4:  36%|███▌      | 39/108 [00:00&lt;00:01, 65.73it/s, v_num=0]
Epoch 4:  53%|█████▎    | 57/108 [00:00&lt;00:00, 81.51it/s, v_num=0]
Epoch 4:  54%|█████▎    | 58/108 [00:00&lt;00:00, 82.56it/s, v_num=0]
Epoch 4:  68%|██████▊   | 73/108 [00:00&lt;00:00, 89.69it/s, v_num=0]
Epoch 4:  69%|██████▊   | 74/108 [00:00&lt;00:00, 90.53it/s, v_num=0]
Epoch 4:  83%|████████▎ | 90/108 [00:00&lt;00:00, 98.32it/s, v_num=0]
Epoch 4:  98%|█████████▊| 106/108 [00:01&lt;00:00, 103.12it/s, v_num=0]
Epoch 4: 100%|██████████| 108/108 [00:01&lt;00:00, 103.78it/s, v_num=0]
Validation: 0it [00:00, ?it/s]76) 
Validation:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:  10%|█         | 1/10 [00:00&lt;00:00, 268.49it/s]
Validation DataLoader 0:  20%|██        | 2/10 [00:00&lt;00:00, 298.62it/s]
Validation DataLoader 0:  30%|███       | 3/10 [00:00&lt;00:00, 282.88it/s]
Validation DataLoader 0:  40%|████      | 4/10 [00:00&lt;00:00, 256.50it/s]
Validation DataLoader 0:  50%|█████     | 5/10 [00:00&lt;00:00, 276.28it/s]
Validation DataLoader 0:  60%|██████    | 6/10 [00:00&lt;00:00, 268.05it/s]
Validation DataLoader 0:  70%|███████   | 7/10 [00:00&lt;00:00, 276.18it/s]
Validation DataLoader 0:  80%|████████  | 8/10 [00:00&lt;00:00, 290.08it/s]
Validation DataLoader 0:  90%|█████████ | 9/10 [00:00&lt;00:00, 261.92it/s]
Validation DataLoader 0: 100%|██████████| 10/10 [00:00&lt;00:00, 274.00it/s]
Epoch 4: 100%|██████████| 108/108 [00:01&lt;00:00, 78.54it/s, v_num=0] 
                                                                         
Epoch 5:   0%|          | 0/108 [00:00&lt;?, ?it/s, v_num=0]          
Epoch 5:   5%|▍         | 5/108 [00:00&lt;00:06, 15.52it/s, v_num=0]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> <span class=" -Color -Color-Green"> [repeated 9x across cluster]</span>
Epoch 5:  17%|█▋        | 18/108 [00:00&lt;00:02, 42.53it/s, v_num=0]
Epoch 5:  26%|██▌       | 28/108 [00:00&lt;00:01, 52.36it/s, v_num=0]
Epoch 5:  27%|██▋       | 29/108 [00:00&lt;00:01, 53.91it/s, v_num=0]
Epoch 5:  28%|██▊       | 30/108 [00:00&lt;00:01, 55.45it/s, v_num=0]
Epoch 5:  29%|██▊       | 31/108 [00:00&lt;00:01, 56.96it/s, v_num=0]
Epoch 5:  37%|███▋      | 40/108 [00:00&lt;00:01, 61.48it/s, v_num=0]
Epoch 5:  38%|███▊      | 41/108 [00:00&lt;00:01, 62.61it/s, v_num=0]
Epoch 5:  39%|███▉      | 42/108 [00:00&lt;00:01, 63.79it/s, v_num=0]
Epoch 5:  40%|███▉      | 43/108 [00:00&lt;00:01, 64.96it/s, v_num=0]
Epoch 5:  48%|████▊     | 52/108 [00:00&lt;00:00, 67.96it/s, v_num=0]
Epoch 5:  49%|████▉     | 53/108 [00:00&lt;00:00, 68.88it/s, v_num=0]
Epoch 5:  50%|█████     | 54/108 [00:00&lt;00:00, 69.77it/s, v_num=0]
Epoch 5:  62%|██████▏   | 67/108 [00:00&lt;00:00, 76.43it/s, v_num=0]
Epoch 5:  78%|███████▊  | 84/108 [00:00&lt;00:00, 85.56it/s, v_num=0]
Epoch 5:  79%|███████▊  | 85/108 [00:00&lt;00:00, 86.17it/s, v_num=0]
Epoch 5:  93%|█████████▎| 100/108 [00:01&lt;00:00, 92.27it/s, v_num=0]
Epoch 5: 100%|██████████| 108/108 [00:01&lt;00:00, 94.81it/s, v_num=0]
Validation: 0it [00:00, ?it/s]76) 
Validation:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:  10%|█         | 1/10 [00:00&lt;00:00, 255.91it/s]
Validation DataLoader 0:  20%|██        | 2/10 [00:00&lt;00:00, 206.50it/s]
Validation DataLoader 0:  30%|███       | 3/10 [00:00&lt;00:00, 214.91it/s]
Validation DataLoader 0:  40%|████      | 4/10 [00:00&lt;00:00, 236.35it/s]
Validation DataLoader 0:  50%|█████     | 5/10 [00:00&lt;00:00, 240.05it/s]
Validation DataLoader 0:  60%|██████    | 6/10 [00:00&lt;00:00, 234.90it/s]
Validation DataLoader 0:  70%|███████   | 7/10 [00:00&lt;00:00, 240.78it/s]
Validation DataLoader 0:  80%|████████  | 8/10 [00:00&lt;00:00, 252.00it/s]
Validation DataLoader 0:  90%|█████████ | 9/10 [00:00&lt;00:00, 255.18it/s]
Epoch 5: 100%|██████████| 108/108 [00:01&lt;00:00, 72.36it/s, v_num=0]1it/s]
                                                                         
Epoch 6:   0%|          | 0/108 [00:00&lt;?, ?it/s, v_num=0]          
Epoch 6:  15%|█▍        | 16/108 [00:00&lt;00:02, 44.27it/s, v_num=0]
Epoch 6:  25%|██▌       | 27/108 [00:00&lt;00:01, 57.21it/s, v_num=0]
Epoch 6:  38%|███▊      | 41/108 [00:00&lt;00:00, 70.86it/s, v_num=0]
Epoch 6:  39%|███▉      | 42/108 [00:00&lt;00:00, 71.82it/s, v_num=0]
Epoch 6:  55%|█████▍    | 59/108 [00:00&lt;00:00, 85.97it/s, v_num=0]
Epoch 6:  68%|██████▊   | 73/108 [00:00&lt;00:00, 91.53it/s, v_num=0]
Epoch 6:  81%|████████  | 87/108 [00:00&lt;00:00, 96.88it/s, v_num=0]
Epoch 6:  92%|█████████▏| 99/108 [00:00&lt;00:00, 99.33it/s, v_num=0]
Epoch 6:  93%|█████████▎| 100/108 [00:01&lt;00:00, 98.66it/s, v_num=0]
Epoch 6:  94%|█████████▎| 101/108 [00:01&lt;00:00, 99.34it/s, v_num=0]
Epoch 6: 100%|██████████| 108/108 [00:01&lt;00:00, 102.79it/s, v_num=0]
Validation: 0it [00:00, ?it/s]76) 
Validation:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:  10%|█         | 1/10 [00:00&lt;00:00, 197.51it/s]
Validation DataLoader 0:  20%|██        | 2/10 [00:00&lt;00:00, 143.68it/s]
Validation DataLoader 0:  30%|███       | 3/10 [00:00&lt;00:00, 156.17it/s]
Validation DataLoader 0:  40%|████      | 4/10 [00:00&lt;00:00, 180.52it/s]
Validation DataLoader 0:  50%|█████     | 5/10 [00:00&lt;00:00, 205.25it/s]
Validation DataLoader 0:  60%|██████    | 6/10 [00:00&lt;00:00, 212.20it/s]
Validation DataLoader 0:  70%|███████   | 7/10 [00:00&lt;00:00, 195.64it/s]
Validation DataLoader 0:  80%|████████  | 8/10 [00:00&lt;00:00, 211.21it/s]
Validation DataLoader 0:  90%|█████████ | 9/10 [00:00&lt;00:00, 225.13it/s]
Epoch 6: 100%|██████████| 108/108 [00:01&lt;00:00, 76.04it/s, v_num=0] it/s]
                                                                         
Epoch 7:   0%|          | 0/108 [00:00&lt;?, ?it/s, v_num=0]          
Epoch 7:  11%|█         | 12/108 [00:00&lt;00:02, 33.31it/s, v_num=0]
Epoch 7:  20%|██        | 22/108 [00:00&lt;00:01, 46.90it/s, v_num=0]
Epoch 7:  22%|██▏       | 24/108 [00:00&lt;00:01, 50.49it/s, v_num=0]
Epoch 7:  31%|███▏      | 34/108 [00:00&lt;00:01, 58.20it/s, v_num=0]
Epoch 7:  32%|███▏      | 35/108 [00:00&lt;00:01, 59.59it/s, v_num=0]
Epoch 7:  33%|███▎      | 36/108 [00:00&lt;00:01, 60.97it/s, v_num=0]
Epoch 7:  48%|████▊     | 52/108 [00:00&lt;00:00, 74.69it/s, v_num=0]
Epoch 7:  64%|██████▍   | 69/108 [00:00&lt;00:00, 85.96it/s, v_num=0]
Epoch 7:  80%|███████▉  | 86/108 [00:00&lt;00:00, 94.41it/s, v_num=0]
Epoch 7:  81%|████████▏ | 88/108 [00:00&lt;00:00, 95.91it/s, v_num=0]
Epoch 7:  97%|█████████▋| 105/108 [00:01&lt;00:00, 102.61it/s, v_num=0]
Epoch 7: 100%|██████████| 108/108 [00:01&lt;00:00, 103.00it/s, v_num=0]
Validation: 0it [00:00, ?it/s]76) 
Validation:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:  10%|█         | 1/10 [00:00&lt;00:00, 215.46it/s]
Validation DataLoader 0:  20%|██        | 2/10 [00:00&lt;00:00, 246.46it/s]
Validation DataLoader 0:  30%|███       | 3/10 [00:00&lt;00:00, 264.39it/s]
Validation DataLoader 0:  40%|████      | 4/10 [00:00&lt;00:00, 256.84it/s]
Validation DataLoader 0:  50%|█████     | 5/10 [00:00&lt;00:00, 218.46it/s]
Validation DataLoader 0:  60%|██████    | 6/10 [00:00&lt;00:00, 230.90it/s]
Validation DataLoader 0:  70%|███████   | 7/10 [00:00&lt;00:00, 243.53it/s]
Validation DataLoader 0:  80%|████████  | 8/10 [00:00&lt;00:00, 253.83it/s]
Validation DataLoader 0:  90%|█████████ | 9/10 [00:00&lt;00:00, 249.22it/s]
Epoch 7: 100%|██████████| 108/108 [00:01&lt;00:00, 78.36it/s, v_num=0] it/s]
                                                                         
Epoch 8:   0%|          | 0/108 [00:00&lt;?, ?it/s, v_num=0]          
Epoch 8:   7%|▋         | 8/108 [00:00&lt;00:03, 25.72it/s, v_num=0]
Epoch 8:  19%|█▊        | 20/108 [00:00&lt;00:01, 47.54it/s, v_num=0]
Epoch 8:  31%|███       | 33/108 [00:00&lt;00:01, 62.61it/s, v_num=0]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> <span class=" -Color -Color-Green"> [repeated 7x across cluster]</span>
Epoch 8:  44%|████▎     | 47/108 [00:00&lt;00:00, 74.45it/s, v_num=0]
Epoch 8:  55%|█████▍    | 59/108 [00:00&lt;00:00, 81.84it/s, v_num=0]
Epoch 8:  56%|█████▌    | 60/108 [00:00&lt;00:00, 80.82it/s, v_num=0]
Epoch 8:  57%|█████▋    | 62/108 [00:00&lt;00:00, 82.74it/s, v_num=0]
Epoch 8:  58%|█████▊    | 63/108 [00:00&lt;00:00, 83.69it/s, v_num=0]
Epoch 8:  70%|███████   | 76/108 [00:00&lt;00:00, 88.60it/s, v_num=0]
Epoch 8:  85%|████████▌ | 92/108 [00:00&lt;00:00, 96.53it/s, v_num=0]
Epoch 8:  86%|████████▌ | 93/108 [00:00&lt;00:00, 96.21it/s, v_num=0]
Epoch 8:  87%|████████▋ | 94/108 [00:00&lt;00:00, 96.72it/s, v_num=0]
Epoch 8:  88%|████████▊ | 95/108 [00:00&lt;00:00, 97.32it/s, v_num=0]
Epoch 8:  89%|████████▉ | 96/108 [00:00&lt;00:00, 98.03it/s, v_num=0]
Epoch 8: 100%|██████████| 108/108 [00:01&lt;00:00, 102.15it/s, v_num=0]
Validation: 0it [00:00, ?it/s]76) 
Validation:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:  10%|█         | 1/10 [00:00&lt;00:00, 228.96it/s]
Validation DataLoader 0:  20%|██        | 2/10 [00:00&lt;00:00, 220.63it/s]
Validation DataLoader 0:  30%|███       | 3/10 [00:00&lt;00:00, 220.41it/s]
Validation DataLoader 0:  40%|████      | 4/10 [00:00&lt;00:00, 208.74it/s]
Validation DataLoader 0:  50%|█████     | 5/10 [00:00&lt;00:00, 221.74it/s]
Validation DataLoader 0:  60%|██████    | 6/10 [00:00&lt;00:00, 243.64it/s]
Validation DataLoader 0:  70%|███████   | 7/10 [00:00&lt;00:00, 253.60it/s]
Validation DataLoader 0:  80%|████████  | 8/10 [00:00&lt;00:00, 254.93it/s]
Validation DataLoader 0:  90%|█████████ | 9/10 [00:00&lt;00:00, 207.23it/s]
Epoch 8: 100%|██████████| 108/108 [00:01&lt;00:00, 78.28it/s, v_num=0] it/s]
                                                                         
Epoch 9:   0%|          | 0/108 [00:00&lt;?, ?it/s, v_num=0]          
Epoch 9:  11%|█         | 12/108 [00:00&lt;00:02, 33.03it/s, v_num=0]
Epoch 9:  21%|██▏       | 23/108 [00:00&lt;00:01, 48.82it/s, v_num=0]
Epoch 9:  31%|███       | 33/108 [00:00&lt;00:01, 58.62it/s, v_num=0]
Epoch 9:  31%|███▏      | 34/108 [00:00&lt;00:01, 58.61it/s, v_num=0]
Epoch 9:  32%|███▏      | 35/108 [00:00&lt;00:01, 59.89it/s, v_num=0]
Epoch 9:  33%|███▎      | 36/108 [00:00&lt;00:01, 61.11it/s, v_num=0]
Epoch 9:  46%|████▋     | 50/108 [00:00&lt;00:00, 71.95it/s, v_num=0]
Epoch 9:  61%|██████    | 66/108 [00:00&lt;00:00, 82.62it/s, v_num=0]
Epoch 9:  70%|███████   | 76/108 [00:00&lt;00:00, 83.77it/s, v_num=0]
Epoch 9:  71%|███████▏  | 77/108 [00:00&lt;00:00, 84.54it/s, v_num=0]
Epoch 9:  72%|███████▏  | 78/108 [00:00&lt;00:00, 85.33it/s, v_num=0]
Epoch 9:  88%|████████▊ | 95/108 [00:01&lt;00:00, 93.18it/s, v_num=0]
Epoch 9: 100%|██████████| 108/108 [00:01&lt;00:00, 98.27it/s, v_num=0]
Validation: 0it [00:00, ?it/s]76) 
Validation:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:   0%|          | 0/10 [00:00&lt;?, ?it/s]
Validation DataLoader 0:  10%|█         | 1/10 [00:00&lt;00:00, 305.42it/s]
Validation DataLoader 0:  20%|██        | 2/10 [00:00&lt;00:00, 337.39it/s]
Validation DataLoader 0:  30%|███       | 3/10 [00:00&lt;00:00, 368.65it/s]
Validation DataLoader 0:  40%|████      | 4/10 [00:00&lt;00:00, 361.22it/s]
Validation DataLoader 0:  50%|█████     | 5/10 [00:00&lt;00:00, 250.96it/s]
Validation DataLoader 0:  60%|██████    | 6/10 [00:00&lt;00:00, 271.98it/s]
Validation DataLoader 0:  70%|███████   | 7/10 [00:00&lt;00:00, 289.64it/s]
Validation DataLoader 0:  80%|████████  | 8/10 [00:00&lt;00:00, 304.16it/s]
Validation DataLoader 0:  90%|█████████ | 9/10 [00:00&lt;00:00, 184.87it/s]
Validation DataLoader 0: 100%|██████████| 10/10 [00:00&lt;00:00, 196.99it/s]
Epoch 9: 100%|██████████| 108/108 [00:01&lt;00:00, 74.63it/s, v_num=0]
                                                                         
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> `Trainer.fit` stopped: `max_epochs=10` reached.
100%|██████████| 4542/4542 [00:00&lt;00:00, 48474627.91it/s]<span class=" -Color -Color-Green"> [repeated 14x across cluster]</span>
100%|██████████| 9912422/9912422 [00:00&lt;00:00, 90032420.31it/s]<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> <span class=" -Color -Color-Green"> [repeated 5x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120178)</span> Missing logger folder: logs/lightning_logs<span class=" -Color -Color-Green"> [repeated 2x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120179)</span> LOCAL_RANK: 3 - CUDA_VISIBLE_DEVICES: [0,1,2,3]<span class=" -Color -Color-Green"> [repeated 3x across cluster]</span>
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> [rank: 0] Global seed set to 888
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 9: 100%|██████████| 108/108 [00:01&lt;00:00, 66.61it/s, v_num=0]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> /mnt/cluster_storage/pypi/lib/python3.9/site-packages/pytorch_lightning/trainer/connectors/data_connector.py:225: PossibleUserWarning: Using `DistributedSampler` with the dataloaders. During `trainer.test()`, it is recommended to use `Trainer(devices=1, num_nodes=1)` to ensure each sample/batch gets evaluated exactly once. Otherwise, multi-device settings use `DistributedSampler` that replicates some samples to make sure all devices have same batch size in case of uneven inputs.
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span>   rank_zero_warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Testing DataLoader 0:  25%|██▌       | 5/20 [00:00&lt;00:00, 146.57it/s]
Testing DataLoader 0: 100%|██████████| 20/20 [00:00&lt;00:00, 163.98it/s]
Testing DataLoader 0: 100%|██████████| 20/20 [00:00&lt;00:00, 125.34it/s]
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> ┃        Test metric        ┃       DataLoader 0        ┃
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> ┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> │       test_accuracy       │    0.9740999937057495     │
<span class=" -Color -Color-Faint -Color-Faint-Cyan">(RayTrainWorker pid=120176)</span> └───────────────────────────┴───────────────────────────┘
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-08-07 23:41:11,072	INFO tune.py:1145 -- Total run time: 39.92 seconds (39.80 seconds for the tuning loop).
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h2>检查训练结果和检查点<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Result(
  metrics={&#39;train_loss&#39;: 0.03159375861287117, &#39;val_accuracy&#39;: 0.9700015783309937, &#39;val_loss&#39;: -12.346583366394043, &#39;epoch&#39;: 9, &#39;step&#39;: 1080},
  path=&#39;/tmp/ray_results/ptl-mnist-example/TorchTrainer_78346_00000_0_2023-08-07_23-40-31&#39;,
  checkpoint=LegacyTorchCheckpoint(local_path=/tmp/ray_results/ptl-mnist-example/TorchTrainer_78346_00000_0_2023-08-07_23-40-31/checkpoint_000009)
)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Validation Accuracy: &quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;val_accuracy&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trial Directory: &quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">path</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Validation Accuracy:  0.9700015783309937
Trial Directory:  /tmp/ray_results/ptl-mnist-example/TorchTrainer_78346_00000_0_2023-08-07_23-40-31
[&#39;checkpoint_000007&#39;, &#39;checkpoint_000008&#39;, &#39;checkpoint_000009&#39;, &#39;events.out.tfevents.1691476838.ip-10-0-6-244&#39;, &#39;params.json&#39;, &#39;params.pkl&#39;, &#39;progress.csv&#39;, &#39;rank_0&#39;, &#39;rank_0.lock&#39;, &#39;rank_1&#39;, &#39;rank_1.lock&#39;, &#39;rank_2&#39;, &#39;rank_2.lock&#39;, &#39;rank_3&#39;, &#39;rank_3.lock&#39;, &#39;result.json&#39;]
</pre></div>
</div>
</div>
</div>
<p>Ray Train 在试验目录中保存了三个检查点（<code class="docutils literal notranslate"><span class="pre">checkpoint_000007</span></code>, <code class="docutils literal notranslate"><span class="pre">checkpoint_000008</span></code>, <code class="docutils literal notranslate"><span class="pre">checkpoint_000009</span></code>）。以下代码从拟合结果中检索最新的检查点并将其重新加载到模型中。</p>
<p>如果丢失了内存中的结果对象，您可以从检查点文件恢复模型。检查点路径为： <code class="docutils literal notranslate"><span class="pre">/tmp/ray_results/ptl-mnist-example/TorchTrainer_eb925_00000_0_2023-08-07_23-15-06/checkpoint_000009/checkpoint.ckpt</span></code>。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">checkpoint</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">checkpoint</span>

<span class="k">with</span> <span class="n">checkpoint</span><span class="o">.</span><span class="n">as_directory</span><span class="p">()</span> <span class="k">as</span> <span class="n">ckpt_dir</span><span class="p">:</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">MNISTClassifier</span><span class="o">.</span><span class="n">load_from_checkpoint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ckpt_dir</span><span class="si">}</span><span class="s2">/checkpoint.ckpt&quot;</span><span class="p">)</span>

<span class="n">best_model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Global seed set to 888
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MNISTClassifier(
  (linear_relu_stack): Sequential(
    (0): Linear(in_features=784, out_features=128, bias=True)
    (1): ReLU()
    (2): Linear(in_features=128, out_features=10, bias=True)
    (3): ReLU()
  )
  (accuracy): MulticlassAccuracy()
)
</pre></div>
</div>
</div>
</div>
</section>
<section id="id4">
<h2>也可以看看<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../../getting-started-pytorch-lightning.html#train-pytorch-lightning"><span class="std std-ref">PyTorch Lightning 入门</span></a> ，有关使用 Ray Train 和 PyTorch Lightning 的教程</p></li>
<li><p>更多用例的 <a class="reference internal" href="../../examples.html#train-examples"><span class="std std-ref">Ray Train 示例</span></a></p></li>
</ul>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><!-- Override the footer area for the sphinx-book-theme to include the CSAT widget -->
<div id="csat">
  <div id="csat-feedback-received" class="csat-hidden">
    <span>谢谢你的反馈！</span>
  </div>
  <div id="csat-inputs">
    <span>是否能帮助到你？</span>
    <div id="csat-yes" class="csat-button">
      <svg id="csat-yes-icon" class="csat-hidden csat-icon" width="18" height="13" viewBox="0 0 18 13" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.00023 10.172L16.1922 0.979004L17.6072 2.393L7.00023 13L0.63623 6.636L2.05023 5.222L7.00023 10.172Z" fill="black"/>
      </svg>
      <span>是<span>
    </div>
    <div id="csat-no" class="csat-button">
      <svg id="csat-no-icon" class="csat-hidden csat-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.00023 5.58599L11.9502 0.635986L13.3642 2.04999L8.41423 6.99999L13.3642 11.95L11.9502 13.364L7.00023 8.41399L2.05023 13.364L0.63623 11.95L5.58623 6.99999L0.63623 2.04999L2.05023 0.635986L7.00023 5.58599Z" fill="black"/>
      </svg>
      <span>否<span>
    </div>
  </div>
  <div id="csat-textarea-group" class="csat-hidden">
    <span id="csat-feedback-label">反馈</span>
    <textarea id="csat-textarea"></textarea>
    <div id="csat-submit">提交</div>
  </div>
</div><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2024, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>