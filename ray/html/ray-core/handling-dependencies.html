
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>环境依赖 &#8212; Ray 2.7.2</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/versionwarning.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../_static/js/docsearch.js"></script>
    <script defer="defer" src="../_static/js/csat.js"></script>
    <script defer="defer" src="../_static/js/termynal.js"></script>
    <script defer="defer" src="../_static/js/custom.js"></script>
    <script defer="defer" src="../_static/js/top-navigation.js"></script>
    <script src="../_static/js/tags.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/ray-core/handling-dependencies.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="调度" href="scheduling/index.html" />
    <link rel="prev" title="对象溢出" href="objects/object-spilling.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>

<script
  src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="18a8c339-4ec5-43c8-8182-db3f2bc8c6b6"
  data-project-name="Ray"
  data-project-color="#2C2C2C"
  data-project-logo="https://global.discourse-cdn.com/business7/uploads/ray/original/1X/8f4dcb72f7cd34e2a332d548bd65860994bc8ff1.png"
  data-modal-disclaimer = "Results are automated and may be incorrect or contain inappropriate information. Do not include any personal data or confidential information."
  data-modal-title = "Ray Docs AI - Ask a Question"
  data-button-position-bottom = "60px"
></script>

<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

        pendo.initialize({
            visitor: {
                id: 'VISITOR-UNIQUE-ID'
            },
            account: {
                id: 'ACCOUNT-UNIQUE-ID'
            }
        });
})('f89fa48a-6dd7-4d7c-67cf-a8051ed891f2');
</script>



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 2.7.2</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    欢迎来到 Ray ！
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/index.html">
   概述「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/getting-started.html">
   入门「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/installation.html">
   安装「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/use-cases.html">
   用例「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/examples.html">
   示例库「1%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/ray-libraries.html">
   生态「3%」
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="walkthrough.html">
   Ray 核心「100%」
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="key-concepts.html">
     关键概念
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="user-guide.html">
     用户指南
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="tasks.html">
       任务
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="actors.html">
       Actors
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="objects.html">
       对象
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       环境依赖
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="scheduling/index.html">
       调度
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="fault-tolerance.html">
       容错
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="patterns/index.html">
       设计模型 及 反模式
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="advanced-topics.html">
       高级主题
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="examples/overview.html">
     示例
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="api/index.html">
     Ray Core API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/data.html">
   Ray 数据「85%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../train/train.html">
   Ray 训练「95%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tune/index.html">
   Ray 调参「0%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../serve/index.html">
   Ray Serve「1%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../rllib/index.html">
   Ray RLlib「0%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-more-libs/index.html">
   更多类库「40%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../cluster/getting-started.html">
   Ray 集群「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-observability/index.html">
   监控调试「100%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-references/api.html">
   参考「20%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-contribute/index.html">
   开发者指引「30%」
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-security/index.html">
   安全「100%」
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fray-core/handling-dependencies.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/ray-core/handling-dependencies.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/ray-core/handling-dependencies.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   概念
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ray-cluster-launcher">
   使用 Ray Cluster launcher 准备环境
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#runtime-environments">
   运行环境
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rte-per-job">
     每个作业指定运行时环境
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#actor">
     为每个任务或每个 Actor 指定运行时
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     常见工作流程
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#workflow-local-files">
       使用本地文件
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#conda-pip">
       使用
       <code class="docutils literal notranslate">
        <span class="pre">
         conda
        </span>
       </code>
       或
       <code class="docutils literal notranslate">
        <span class="pre">
         pip
        </span>
       </code>
       包
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id7">
       类库开发
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#api">
     API 参考
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#runtime-environments-caching">
       缓存和垃圾回收
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id9">
       继承
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#runtime-env-faq">
     常见问题
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id11">
       环境会被安装到每个节点吗？
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id12">
       环境什么时候安装？
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id13">
       环境缓存在哪里？
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id14">
       安装或从缓存加载需要多长时间？
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#docker">
       运行环境和 Docker 有什么关系？
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#runtime-env">
       我的
       <code class="docutils literal notranslate">
        <span class="pre">
         runtime_env
        </span>
       </code>
       已经安装了，但是当我登录到节点时，我无法导入这些包。
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#uri">
   远程 URI
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#git">
   在远程 Git 提供商上托管依赖项：手把手指南
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#zip">
     方法 1: 下载 Zip (快速实现，单不推荐用于生产环境)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#url">
     方法 2: 手动创建 URL (较慢实现，但推荐用于生产)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id17">
   调试
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>环境依赖</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   概念
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ray-cluster-launcher">
   使用 Ray Cluster launcher 准备环境
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#runtime-environments">
   运行环境
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rte-per-job">
     每个作业指定运行时环境
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#actor">
     为每个任务或每个 Actor 指定运行时
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     常见工作流程
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#workflow-local-files">
       使用本地文件
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#conda-pip">
       使用
       <code class="docutils literal notranslate">
        <span class="pre">
         conda
        </span>
       </code>
       或
       <code class="docutils literal notranslate">
        <span class="pre">
         pip
        </span>
       </code>
       包
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id7">
       类库开发
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#api">
     API 参考
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#runtime-environments-caching">
       缓存和垃圾回收
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id9">
       继承
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#runtime-env-faq">
     常见问题
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id11">
       环境会被安装到每个节点吗？
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id12">
       环境什么时候安装？
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id13">
       环境缓存在哪里？
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id14">
       安装或从缓存加载需要多长时间？
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#docker">
       运行环境和 Docker 有什么关系？
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#runtime-env">
       我的
       <code class="docutils literal notranslate">
        <span class="pre">
         runtime_env
        </span>
       </code>
       已经安装了，但是当我登录到节点时，我无法导入这些包。
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#uri">
   远程 URI
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#git">
   在远程 Git 提供商上托管依赖项：手把手指南
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#zip">
     方法 1: 下载 Zip (快速实现，单不推荐用于生产环境)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#url">
     方法 2: 手动创建 URL (较慢实现，但推荐用于生产)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id17">
   调试
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="handling-dependencies">
<span id="id1"></span><h1>环境依赖<a class="headerlink" href="#handling-dependencies" title="Permalink to this headline">#</a></h1>
<p>你的 Ray 应用程序可能具有 Ray 脚本之外的依赖项。例如：</p>
<ul class="simple">
<li><p>您的 Ray 脚本可能会导入/依赖一些 Python 包。</p></li>
<li><p>您的 Ray 脚本可能正在寻找一些可用的特定环境变量。</p></li>
<li><p>你的 Ray 脚本可能会导入一些脚本之外的文件。</p></li>
</ul>
<p>在集群上运行时，一个常见问题是 Ray 期望这些“依赖项”存在于每个 Ray 节点上。如果不存在这些，您可能会遇到诸如 <code class="docutils literal notranslate"><span class="pre">ModuleNotFoundError</span></code> 或 <code class="docutils literal notranslate"><span class="pre">FileNotFoundError</span></code> 等问题。</p>
<p>为了解决这个问题，您可以 (1) 使用 Ray <a class="reference internal" href="../cluster/vms/getting-started.html#vm-cluster-quick-start"><span class="std std-ref">Cluster Launcher</span></a> 提前准备集群上的依赖项（例如使用容器映像），或者 (2) 使用 Ray 的 <a class="reference internal" href="#runtime-environments"><span class="std std-ref">运行时环境</span></a> 动态安装它们。</p>
<p>对于生产用途或非变更环境，我们建议将依赖项安装到容器映像中，并使用 Cluster Launcher 指定映像。
对于动态环境（例如用于开发和实验），我们建议使用运行时环境。</p>
<section id="id2">
<h2>概念<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><strong>Ray 应用程序</strong>。  包含 Ray 脚本的程序，用于调用 <code class="docutils literal notranslate"><span class="pre">ray.init()</span></code> 和使用 Ray task 或 actor。</p></li>
<li><p><strong>依赖项</strong> 或 <strong>环境</strong>。  应用程序需要运行的 Ray 脚本之外的任何内容，包括文件、包和环境变量。</p></li>
<li><p><strong>文件</strong>。 你的 Ray 应用程序运行所需的代码文件、数据文件或其他文件。</p></li>
<li><p><strong>包</strong>。 Ray 应用程序所需的外部库或可执行文件，通常通过 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 或 <code class="docutils literal notranslate"><span class="pre">conda</span></code> 安装。</p></li>
<li><p><strong>本地机器</strong> 和 <strong>集群</strong>。  通常，您可能希望将 Ray 集群计算机器/pod 与处理和提交应用程序的机器/pod 分开。您可以通过 <a class="reference internal" href="../cluster/running-applications/job-submission/index.html#jobs-overview"><span class="std std-ref">Ray 作业提交机制</span></a> 提交 Ray 作业，或使用 <code class="xref py py-obj docutils literal notranslate"><span class="pre">ray</span> <span class="pre">attach</span></code> 以交互方式连接到集群。 我们将提交作业的机器称为 <em>本地机器</em>.</p></li>
<li><p><strong>作业</strong>.  <a class="reference internal" href="../cluster/key-concepts.html#cluster-clients-and-jobs"><span class="std std-ref">Ray 作业</span></a> 是单个应用程序：它是来自同一脚本的 Ray 任务、对象和 actor 的集合。</p></li>
</ul>
</section>
<section id="ray-cluster-launcher">
<span id="using-the-cluster-launcher"></span><h2>使用 Ray Cluster launcher 准备环境<a class="headerlink" href="#ray-cluster-launcher" title="Permalink to this headline">#</a></h2>
<p>设置依赖项的第一种方法是在启动 Ray 运行时之前准备跨集群的单一环境。</p>
<ul class="simple">
<li><p>您可以将所有文件和依赖项构建到容器映像中，并在 <a class="reference internal" href="../cluster/vms/references/ray-cluster-configuration.html#cluster-config"><span class="std std-ref">Cluster YAML 配置项</span></a> 指定。</p></li>
<li><p>您还可以在Ray Cluster 配置文件（<a class="reference internal" href="../cluster/vms/references/ray-cluster-configuration.html#cluster-configuration-setup-commands"><span class="std std-ref">参考</span></a>）使用 <code class="docutils literal notranslate"><span class="pre">setup_commands</span></code> 安装依赖项；这些命令将在每个节点加入集群时运行。
请注意，对于生产设置，建议将任何必要的软件包构建到容器映像中。</p></li>
<li><p>您可以使用使用 <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">rsync_up</span></code> (<a class="reference internal" href="../cluster/vms/references/ray-cluster-cli.html#ray-rsync"><span class="std std-ref">参考</span></a>) 将本地文件推送到集群。</p></li>
</ul>
</section>
<section id="runtime-environments">
<span id="id3"></span><h2>运行环境<a class="headerlink" href="#runtime-environments" title="Permalink to this headline">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>此特性需要使用 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">&quot;ray[default]&quot;</span></code> 完整安装 Ray 。此功能从 Ray 1.4.0 开始可用，目前支持 macOS 和 Linux，在 Windows 上提供测试版支持。</p>
</div>
<p>设置依赖项的第二种方法是在 Ray 运行时动态安装它们。</p>
<p><strong>运行时环境</strong> 描述了 Ray 应用程序运行时所需的依赖项，包括 <a class="reference internal" href="#runtime-environments-api-ref"><span class="std std-ref">文件、包、环境变量等</span></a>。
它在运行时动态安装在集群上并缓存以供将来使用 （有关生命周期的详细信息，请参阅 <a class="reference internal" href="#runtime-environments-caching"><span class="std std-ref">缓存和垃圾收集</span></a>）。</p>
<p>如果使用了 <a class="reference internal" href="#using-the-cluster-launcher"><span class="std std-ref">Ray 集群启动器</span></a> ，则可以在准备好的环境上使用运行时环境。
例如，您可以使用 Cluster 启动器安装一组基本软件包，然后使用运行时环境安装其他软件包。
与基本集群环境相比，运行时环境仅对 Ray 进程有效。（例如，如果使用运行时环境 指定的 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 包 <code class="docutils literal notranslate"><span class="pre">my_pkg</span></code>，则在 Ray 任务、 actor 或作业之外调用 <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">my_pkg</span></code> 语句将失败。）</p>
<p>运行时环境还允许您在长期运行的 Ray 集群上设置每个任务、actor 和每个作业的依赖项。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>

<span class="n">runtime_env</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pip&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;emoji&quot;</span><span class="p">]}</span>

<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">runtime_env</span><span class="o">=</span><span class="n">runtime_env</span><span class="p">)</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
  <span class="kn">import</span> <span class="nn">emoji</span>
  <span class="k">return</span> <span class="n">emoji</span><span class="o">.</span><span class="n">emojize</span><span class="p">(</span><span class="s1">&#39;Python is :thumbs_up:&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">remote</span><span class="p">()))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Python is 👍
</pre></div>
</div>
<p>运行时环境可以用 Python  <code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code> 来描述：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">runtime_env</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;pip&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;emoji&quot;</span><span class="p">],</span>
    <span class="s2">&quot;env_vars&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;TF_WARNINGS&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>或者，你可以使用 <a class="reference internal" href="api/doc/ray.runtime_env.RuntimeEnv.html#ray.runtime_env.RuntimeEnv" title="ray.runtime_env.RuntimeEnv"><code class="xref py py-class docutils literal notranslate"><span class="pre">ray.runtime_env.RuntimeEnv</span></code></a>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ray.runtime_env</span> <span class="kn">import</span> <span class="n">RuntimeEnv</span>
<span class="n">runtime_env</span> <span class="o">=</span> <span class="n">RuntimeEnv</span><span class="p">(</span>
    <span class="n">pip</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;emoji&quot;</span><span class="p">],</span>
    <span class="n">env_vars</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;TF_WARNINGS&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>欲了解更多示例，请跳转至 <a class="reference internal" href="#runtime-environments-api-ref"><span class="std std-ref">API 参考</span></a>。</p>
<p>您可以为两个主要范围指定运行时环境：</p>
<ul class="simple">
<li><p><a class="reference internal" href="#rte-per-job"><span class="std std-ref">每个 Job</span></a>，以及</p></li>
<li><p><a class="reference internal" href="#rte-per-task-actor"><span class="std std-ref">在一个 job 内的每个 Task/Actor</span></a>。</p></li>
</ul>
<section id="rte-per-job">
<span id="id4"></span><h3>每个作业指定运行时环境<a class="headerlink" href="#rte-per-job" title="Permalink to this headline">#</a></h3>
<p>您可以为整个作业指定运行环境，无论是直接在集群上运行脚本，还是使用 <a class="reference internal" href="../cluster/running-applications/job-submission/index.html#jobs-overview"><span class="std std-ref">Ray 作业 API</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Option 1: Starting a single-node local Ray cluster or connecting to existing local cluster</span>
<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">runtime_env</span><span class="o">=</span><span class="n">runtime_env</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Option 2: Using Ray Jobs API (Python SDK)</span>
<span class="kn">from</span> <span class="nn">ray.job_submission</span> <span class="kn">import</span> <span class="n">JobSubmissionClient</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">JobSubmissionClient</span><span class="p">(</span><span class="s2">&quot;http://&lt;head-node-ip&gt;:8265&quot;</span><span class="p">)</span>
<span class="n">job_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">submit_job</span><span class="p">(</span>
    <span class="n">entrypoint</span><span class="o">=</span><span class="s2">&quot;python my_ray_script.py&quot;</span><span class="p">,</span>
    <span class="n">runtime_env</span><span class="o">=</span><span class="n">runtime_env</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Option 3: Using Ray Jobs API (CLI). (Note: can use --runtime-env to pass a YAML file instead of an inline JSON string.)</span>
$ ray job submit --address<span class="o">=</span><span class="s2">&quot;http://&lt;head-node-ip&gt;:8265&quot;</span> --runtime-env-json<span class="o">=</span><span class="s1">&#39;{&quot;working_dir&quot;: &quot;/data/my_files&quot;, &quot;pip&quot;: [&quot;emoji&quot;]}&#39;</span> -- python my_ray_script.py
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>如果使用 Ray Jobs API（Python SDK 或 CLI），请在调用 <code class="docutils literal notranslate"><span class="pre">submit_job</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">job</span> <span class="pre">submit</span></code> 指定 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 参数，而不是在入口点脚本中的 <code class="docutils literal notranslate"><span class="pre">ray.init()</span></code> 调用中指定（在这个示例中为 <code class="docutils literal notranslate"><span class="pre">my_ray_script.py</span></code>）。</p>
<p>这可确保在运行入口点脚本之前在集群上安装运行时环境。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>何时安装运行环境有两种选择：</p>
<ol class="arabic simple">
<li><p>一旦作业开始（例如， <code class="docutils literal notranslate"><span class="pre">ray.init()</span></code> 被调用），依赖项将被急切地下载和安装。</p></li>
<li><p>仅当调用任务或创建 actor 时才会安装依赖项。</p></li>
</ol>
<p>默认是选项 1。要将行为更改为选项 2，请添加 <code class="docutils literal notranslate"><span class="pre">&quot;eager_install&quot;:</span> <span class="pre">False``到</span> <span class="pre">``config</span></code> 的 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code>。</p>
</div>
</section>
<section id="actor">
<span id="rte-per-task-actor"></span><h3>为每个任务或每个 Actor 指定运行时<a class="headerlink" href="#actor" title="Permalink to this headline">#</a></h3>
<p>您可以使用 <code class="docutils literal notranslate"><span class="pre">&#64;ray.remote</span></code> 装饰器或者 <code class="docutils literal notranslate"><span class="pre">.options()</span></code> 为每个 actor 或每个任务指定不同的运行时环境：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Invoke a remote task that will run in a specified runtime environment.</span>
<span class="n">f</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">runtime_env</span><span class="o">=</span><span class="n">runtime_env</span><span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>

<span class="c1"># Instantiate an actor that will run in a specified runtime environment.</span>
<span class="n">actor</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">runtime_env</span><span class="o">=</span><span class="n">runtime_env</span><span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>

<span class="c1"># Specify a runtime environment in the task definition.  Future invocations via</span>
<span class="c1"># `g.remote()` will use this runtime environment unless overridden by using</span>
<span class="c1"># `.options()` as above.</span>
<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">runtime_env</span><span class="o">=</span><span class="n">runtime_env</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">g</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c1"># Specify a runtime environment in the actor definition.  Future instantiations</span>
<span class="c1"># via `MyClass.remote()` will use this runtime environment unless overridden by</span>
<span class="c1"># using `.options()` as above.</span>
<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">runtime_env</span><span class="o">=</span><span class="n">runtime_env</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>这样，actor 和任务就可以在自己的环境中运行，不受周围环境的影响。（周围环境可能是作业的运行时环境，也可能是集群的系统环境。）</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Ray 不保证运行时环境冲突的任务和 Actor 之间的兼容性。
例如，如果运行时环境包含某个 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 包的 Actor 尝试与使用该包的不同版本的 Actor 进行通信，则可能会导致意外行为，例如解包错误。</p>
</div>
</section>
<section id="id5">
<h3>常见工作流程<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h3>
<p>本节介绍运行时环境的一些常见用例。这些用例并不相互排斥；下面描述的所有选项都可以组合在一个运行时环境中。</p>
<section id="workflow-local-files">
<span id="id6"></span><h4>使用本地文件<a class="headerlink" href="#workflow-local-files" title="Permalink to this headline">#</a></h4>
<p>您的 Ray 应用程序可能依赖源文件或数据文件。
对于开发工作流程，这些文件可能位于您的本地机器上，但当需要大规模运行时，您需要将它们转移到远程集群。</p>
<p>以下简单示例说明如何在集群上获取本地文件。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">ray</span>

<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;/tmp/runtime_env_working_dir&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/tmp/runtime_env_working_dir/hello.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hello_file</span><span class="p">:</span>
  <span class="n">hello_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Hello World!&quot;</span><span class="p">)</span>

<span class="c1"># Specify a runtime environment for the entire Ray job</span>
<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">runtime_env</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;working_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;/tmp/runtime_env_working_dir&quot;</span><span class="p">})</span>

<span class="c1"># Create a Ray task, which inherits the above runtime env.</span>
<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
    <span class="c1"># The function will have its working directory changed to its node&#39;s</span>
    <span class="c1"># local copy of /tmp/runtime_env_working_dir.</span>
    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;hello.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">remote</span><span class="p">()))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Hello World!
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>上面的例子是为了在本地机器上运行而编写的，但是对于所有这些例子，在指定要连接的 Ray 集群时它也同样有效
（比如：使用 <code class="docutils literal notranslate"><span class="pre">ray.init(&quot;ray://123.456.7.89:10001&quot;,</span> <span class="pre">runtime_env=...)</span></code> 或 <code class="docutils literal notranslate"><span class="pre">ray.init(address=&quot;auto&quot;,</span> <span class="pre">runtime_env=...)</span></code>）。</p>
</div>
<p>指定的本地目录将在 <code class="docutils literal notranslate"><span class="pre">ray.init()</span></code> 调用时自动推送到集群节点。</p>
<p>您还可以通过远程云存储 URI 指定文件；有关详细信息，请参阅 <a class="reference internal" href="#remote-uris"><span class="std std-ref">远程 URI</span></a>。</p>
</section>
<section id="conda-pip">
<h4>使用 <code class="docutils literal notranslate"><span class="pre">conda</span></code> 或 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 包<a class="headerlink" href="#conda-pip" title="Permalink to this headline">#</a></h4>
<p>您的 Ray 应用程序可能通过 <code class="docutils literal notranslate"><span class="pre">import</span></code> 语句依赖了 Python 包（比如，<code class="docutils literal notranslate"><span class="pre">pendulum</span></code> 或 <code class="docutils literal notranslate"><span class="pre">requests</span></code>）。</p>
<p>Ray 通常希望所有导入的包都预先安装在集群的每个节点上；特别是，这些包不会自动从本地机器运送到集群或从任何存储库下载。</p>
<p>但是，使用运行时环境，您可以动态指定要在虚拟环境中自动下载并安装的包，以供您的 Ray 作业或特定的 Ray 任务或 actor 使用。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="c1"># This example runs on a local machine, but you can also do</span>
<span class="c1"># ray.init(address=..., runtime_env=...) to connect to a cluster.</span>
<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">runtime_env</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pip&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;requests&quot;</span><span class="p">]})</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">reqs</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.ray.io/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">status_code</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reqs</span><span class="o">.</span><span class="n">remote</span><span class="p">()))</span><span class="mi">0</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>200
</pre></div>
</div>
<p>你也可以通过 Python 列表或本地 <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> 文件指定 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 依赖项。
或者，你可以指定 <code class="docutils literal notranslate"><span class="pre">conda</span></code> 环境，可是通过 Python 词典或者一个本地的 <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> 文件。
这个 conda 环境可以包含 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 包。
有关详细信息，请查看 <a class="reference internal" href="#runtime-environments-api-ref"><span class="std std-ref">API 参考</span></a>。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>由于 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 中的包是在运行时安装，因此在指定需要从源代码构建的 <code class="docutils literal notranslate"><span class="pre">conda</span></code> 或 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 包时要小心，因为这可能会很慢。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>当使用 <code class="docutils literal notranslate"><span class="pre">&quot;pip&quot;</span></code> 字段时，指定的包将使用 <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code> 安装在基础环境之上，因此集群上的现有包仍然可以导入。 相比之下，当使用 <code class="docutils literal notranslate"><span class="pre">conda</span></code> 字段时，您的 Ray 任务和 actor 将在隔离的环境中运行。 <code class="docutils literal notranslate"><span class="pre">conda</span></code> 和 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 字段不能同时在单个 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 中使用。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">ray[default]</span></code> 软件包，本身会自动安装到环境中。仅对于 <code class="docutils literal notranslate"><span class="pre">conda</span></code> 字段，如果使用了任何其他 Ray 类库（如：Ray Serve），则需要在运行时环境指定类库（如： <code class="docutils literal notranslate"><span class="pre">runtime_env</span> <span class="pre">=</span> <span class="pre">{&quot;conda&quot;:</span> <span class="pre">{&quot;dependencies&quot;:</span> <span class="pre">[&quot;pytorch&quot;,</span> <span class="pre">&quot;pip&quot;,</span> <span class="pre">{&quot;pip&quot;:</span> <span class="pre">[&quot;requests&quot;,</span> <span class="pre">&quot;ray[serve]&quot;]}]}}</span></code>。）</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span></code> 环境必须与 Ray 集群是统一 Python 版本。不要在 <code class="docutils literal notranslate"><span class="pre">conda</span></code> 依赖列出 <code class="docutils literal notranslate"><span class="pre">ray</span></code>，因为它会自动安装。</p>
</div>
</section>
<section id="id7">
<h4>类库开发<a class="headerlink" href="#id7" title="Permalink to this headline">#</a></h4>
<p>假设您正在开发一个 Ray 上的库 <code class="docutils literal notranslate"><span class="pre">my_module</span></code>。</p>
<p>典型的迭代周期包括：</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">my_module</span></code> 对 <code class="docutils literal notranslate"><span class="pre">my_module</span></code> 源代码进行一些更改。</p></li>
<li><p>运行一个 Ray 脚本来测试更改，可能在分布式集群上。</p></li>
</ol>
<p>要确保你的本地更改在所有 Ray workers 上显示并且可以正确导入，请使用 <code class="docutils literal notranslate"><span class="pre">py_modules</span></code> 字段。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">import</span> <span class="nn">my_module</span>

<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="s2">&quot;ray://123.456.7.89:10001&quot;</span><span class="p">,</span> <span class="n">runtime_env</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;py_modules&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">my_module</span><span class="p">]})</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">test_my_module</span><span class="p">():</span>
    <span class="c1"># No need to import my_module inside this function.</span>
    <span class="n">my_module</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>

<span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">remote</span><span class="p">())</span>
</pre></div>
</div>
<p>注意：此功能目前仅限于包含 <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> 文件的单个目录的包。对于单文件模块，您可以使用 <code class="docutils literal notranslate"><span class="pre">working_dir</span></code>。</p>
</section>
</section>
<section id="api">
<span id="runtime-environments-api-ref"></span><h3>API 参考<a class="headerlink" href="#api" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 是个 Python 字典或者一个 Python 类 <a class="reference internal" href="api/doc/ray.runtime_env.RuntimeEnv.html#ray.runtime_env.RuntimeEnv" title="ray.runtime_env.RuntimeEnv"><code class="xref py py-class docutils literal notranslate"><span class="pre">ray.runtime_env.RuntimeEnv</span></code></a> 包含以下一个或多个字段：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">working_dir</span></code> (str): 指定 Ray worker 的工作目录。必须是 (1) 一个大小最多在 100 MiB 的本地存在的目录，(2) 一个解压后大小最多 100 MiB 的压缩文件（注意：<code class="docutils literal notranslate"><span class="pre">excludes</span></code> 会不生效），或者 (3) 包含作业工作目录的远程存储压缩文件的 URI。有关详细信息，请参阅 <a class="reference internal" href="#remote-uris"><span class="std std-ref">远程 URI</span></a> 。
指定的目录将下载到集群上的每个节点，并且 Ray 工作程序将在其节点的此目录副本中启动。</p>
<ul class="simple">
<li><p>示例</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;.&quot;</span>&#160; <span class="pre">#</span> <span class="pre">cwd</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;/src/my_project&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;/src/my_project.zip&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;s3://path/to/my_dir.zip&quot;</span></code></p></li>
</ul>
</li>
</ul>
<p>注意：目前不支持按任务或按 actor 设置本地目录；只能按作业进行设置（即，在 <code class="docutils literal notranslate"><span class="pre">ray.init()</span></code> ）。</p>
<p>注意：如果本地目录包含 <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> 文件，则其中指定的文件和路径不会上传到集群。您可以通过在执行上传的机器上设置环境变量 <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_RUNTIME_ENV_IGNORE_GITIGNORE=1</span></code> 来禁用此功能。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">py_modules</span></code> (List[str|module]): 指定可在 Ray worker 中导入的 Python 模块。  （有关指定包的更多方法，另请参阅下面的 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 和 <code class="docutils literal notranslate"><span class="pre">conda</span></code> 字段。）
每个条目必须是 (1) 本地目录的路径、(2) 远程 zip 文件的 URI、(3) Python 模块对象、或者 (4) 本地 <code class="xref py py-obj docutils literal notranslate"><span class="pre">whl</span></code> 文件的路径。</p>
<ul class="simple">
<li><p>列表中条目的示例：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;.&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;/local_dependency/my_module&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;s3://bucket/my_module.zip&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">my_module</span> <span class="pre">#</span> <span class="pre">Assumes</span> <span class="pre">my_module</span> <span class="pre">has</span> <span class="pre">already</span> <span class="pre">been</span> <span class="pre">imported,</span> <span class="pre">e.g.</span> <span class="pre">via</span> <span class="pre">'import</span> <span class="pre">my_module'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">my_module.whl</span></code></p></li>
</ul>
</li>
</ul>
<p>这些模块将被下载到集群上的每个节点。</p>
<p>注意：目前不支持按任务或按 actor 设置选项 (1)、(3) 和 (4)，只能按作业设置（即，在 <code class="docutils literal notranslate"><span class="pre">ray.init()</span></code> 中）。</p>
<p>注意：对于选项 (1)，如果本地目录包含 <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> 文件，则不会将其中指定的文件和路径上传到集群。您可以通过在 <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_RUNTIME_ENV_IGNORE_GITIGNORE=1</span></code> 执行上传的机器上设置环境变量来禁用此功能。</p>
<p>注意：此功能目前仅限于包含 <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> 文件的单个目录的包。对于单文件模块，您可以使用 <code class="docutils literal notranslate"><span class="pre">working_dir</span></code>。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">excludes</span></code> (List[str]): 当使用了 <code class="docutils literal notranslate"><span class="pre">working_dir</span></code> 或 <code class="docutils literal notranslate"><span class="pre">py_modules</span></code>，指定要排除在上传到集群之外的文件或路径列表。
此字段使用 <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> 文件使用的模式匹配语法：有关详细信息，请参阅 <a class="reference external" href="https://git-scm.com/docs/gitignore">https://git-scm.com/docs/gitignore</a>。
注意：根据 <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> 语法，如果模式的开头或中间（或两者）有分隔符（<code class="docutils literal notranslate"><span class="pre">/</span></code>），则该模式相对于 <code class="docutils literal notranslate"><span class="pre">working_dir</span></code> 的级别进行解释。
特别是，你不应该在 <code class="xref py py-obj docutils literal notranslate"><span class="pre">excludes</span></code> 使用绝对路径（例如 <code class="xref py py-obj docutils literal notranslate"><span class="pre">/Users/my_working_dir/subdir/</span></code>）；相反，你应该使用相对路径 <code class="xref py py-obj docutils literal notranslate"><span class="pre">/subdir/`（这里写成</span> <span class="pre">`/</span></code> 开头，以匹配只有顶级 <code class="xref py py-obj docutils literal notranslate"><span class="pre">subdir</span></code> 目录，而不是所有级别的所有名为 <code class="xref py py-obj docutils literal notranslate"><span class="pre">subdir</span></code> 的目录。）</p>
<ul class="simple">
<li><p>示例: <code class="docutils literal notranslate"><span class="pre">{&quot;working_dir&quot;:</span> <span class="pre">&quot;/Users/my_working_dir/&quot;,</span> <span class="pre">&quot;excludes&quot;:</span> <span class="pre">[&quot;my_file.txt&quot;,</span> <span class="pre">&quot;/subdir/,</span> <span class="pre">&quot;path/to/dir&quot;,</span> <span class="pre">&quot;*.log&quot;]}</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">pip</span></code> (dict | List[str] | str): (1) pip <a class="reference external" href="https://pip.pypa.io/en/stable/cli/pip_install/#requirement-specifiers">requirements specifiers</a> 列表， (2) 包含本地 pip
<a class="reference external" href="https://pip.pypa.io/en/stable/user_guide/#requirements-files">“requirements.txt”</a> 文件路径的字符串，或者 (3) 具有三个字段的 python 字典： (a) <code class="docutils literal notranslate"><span class="pre">packages</span></code> (必须， List[str]): pip 包列表，
(b) <code class="docutils literal notranslate"><span class="pre">pip_check</span></code> (可选, bool): 是否在 pip install 结束时启用 <a class="reference external" href="https://pip.pypa.io/en/stable/cli/pip_check/">pip check</a> ，默认为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。
(c) <code class="docutils literal notranslate"><span class="pre">pip_version</span></code> (可选, str): pip 的版本； Ray 将在  <code class="docutils literal notranslate"><span class="pre">pip_version</span></code> 前面拼写 “pip” 包名称以形成最终的需求字符串。
requirement 定义语法在 <a class="reference external" href="https://www.python.org/dev/peps/pep-0508/">PEP 508</a> 中有详细说明。
这将在运行时安装在 Ray worker 上。 集群预安装环境中的包仍然可用。
要使用像 Ray Serve 或 Ray Tune 这样的库，你需要在这里包含 <code class="docutils literal notranslate"><span class="pre">&quot;ray[serve]&quot;</span></code> 或 <code class="docutils literal notranslate"><span class="pre">&quot;ray[tune]&quot;</span></code>。
Ray 版本必须与集群的版本匹配，因此您可能不应该手动指定它们。</p>
<ul class="simple">
<li><p>示例: <code class="docutils literal notranslate"><span class="pre">[&quot;requests==1.0.0&quot;,</span> <span class="pre">&quot;aiohttp&quot;,</span> <span class="pre">&quot;ray[serve]&quot;]</span></code></p></li>
<li><p>示例: <code class="docutils literal notranslate"><span class="pre">&quot;./requirements.txt&quot;</span></code></p></li>
<li><p>示例: <code class="docutils literal notranslate"><span class="pre">{&quot;packages&quot;:[&quot;tensorflow&quot;,</span> <span class="pre">&quot;requests&quot;],</span> <span class="pre">&quot;pip_check&quot;:</span> <span class="pre">False,</span> <span class="pre">&quot;pip_version&quot;:</span> <span class="pre">&quot;==22.0.2;python_version=='3.8.11'&quot;}</span></code></p></li>
</ul>
<p>指定 <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> 文件路径时，文件必须存在于本地计算机上，并且必须是相对于本地当前工作目录的有效绝对路径或相对文件路径，而 <em>不是</em> 相对于 <code class="xref py py-obj docutils literal notranslate"><span class="pre">runtime_env</span></code> 指定的 <code class="xref py py-obj docutils literal notranslate"><span class="pre">working_dir</span></code>。
此外，不支持在 <code class="xref py py-obj docutils literal notranslate"><span class="pre">requirements.txt</span></code> 文件中引用本地文件。（如：<code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">./my-laptop/more-requirements.txt</span></code>，<code class="docutils literal notranslate"><span class="pre">./my-pkg.whl</span></code>）。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">conda</span></code> (dict | str): (1) 示 conda 环境 YAML 的字典， (2) 包含本地
<a class="reference external" href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#create-env-file-manually">conda “environment.yml”</a> 文件的路径字符串，
或 (3) 已安装在集群中每个节点上的本地 conda 环境的名称（例如， <code class="docutils literal notranslate"><span class="pre">&quot;pytorch_p36&quot;</span></code>）。
前两种情况下，Ray 和 Python 依赖项将自动注入到环境中以确保兼容性，因此无需手动包含它们。
Python 和 Ray 版本必须与集群的版本匹配，因此您可能不应该手动指定它们。
请注意，<code class="docutils literal notranslate"><span class="pre">conda</span></code> 和 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 的 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 键不能同时指定—要一起使用它们，请使用 <code class="docutils literal notranslate"><span class="pre">conda</span></code> 并在 conda 的 <code class="docutils literal notranslate"><span class="pre">environment.yaml</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">&quot;pip&quot;</span></code> 字段中添加您的 pip 依赖项。</p>
<ul class="simple">
<li><p>示例: <code class="docutils literal notranslate"><span class="pre">{&quot;dependencies&quot;:</span> <span class="pre">[&quot;pytorch&quot;,</span> <span class="pre">&quot;torchvision&quot;,</span> <span class="pre">&quot;pip&quot;,</span> <span class="pre">{&quot;pip&quot;:</span> <span class="pre">[&quot;pendulum&quot;]}]}</span></code></p></li>
<li><p>示例: <code class="docutils literal notranslate"><span class="pre">&quot;./environment.yml&quot;</span></code></p></li>
<li><p>示例: <code class="docutils literal notranslate"><span class="pre">&quot;pytorch_p36&quot;</span></code></p></li>
</ul>
<p>指定 <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> 文件路径时，文件必须存在于本地计算机上，并且必须是相对于本地当前工作目录的有效绝对路径或相对文件路径，而 <em>不是</em> 相对于 <code class="xref py py-obj docutils literal notranslate"><span class="pre">runtime_env</span></code> 指定的 <code class="xref py py-obj docutils literal notranslate"><span class="pre">working_dir</span></code>。
此外，不支持在 <code class="xref py py-obj docutils literal notranslate"><span class="pre">environment.yml</span></code> 文件中引用本地文件。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">env_vars</span></code> (Dict[str, str]): 要设置的环境变量。  集群上已经设置的环境变量仍旧对于 Ray worker 可见；所以不需要在 <code class="docutils literal notranslate"><span class="pre">env_vars</span></code> 字段中包含 <code class="docutils literal notranslate"><span class="pre">os.environ</span></code> 或类似的内容。
默认，这些环境变量会覆盖集群上相同名称的环境变量。
你可以使用 ${ENV_VAR} 引用现有的环境变量来实现追加行为。
如果环境变量不存在，它会变成一个空字符串 <code class="xref py py-obj docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>。</p>
<ul class="simple">
<li><p>示例: <code class="docutils literal notranslate"><span class="pre">{&quot;OMP_NUM_THREADS&quot;:</span> <span class="pre">&quot;32&quot;,</span> <span class="pre">&quot;TF_WARNINGS&quot;:</span> <span class="pre">&quot;none&quot;}</span></code></p></li>
<li><p>示例: <code class="docutils literal notranslate"><span class="pre">{&quot;LD_LIBRARY_PATH&quot;:</span> <span class="pre">&quot;${LD_LIBRARY_PATH}:/home/admin/my_lib&quot;}</span></code></p></li>
<li><p>不存在的变量示例: <code class="docutils literal notranslate"><span class="pre">{&quot;ENV_VAR_NOT_EXIST&quot;:</span> <span class="pre">&quot;${ENV_VAR_NOT_EXIST}:/home/admin/my_lib&quot;}</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">ENV_VAR_NOT_EXIST=&quot;:/home/admin/my_lib&quot;</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">container</span></code> (dict): 需要给定的 (Docker) 映像，, 工作进程将在具有此映像的容器中运行。
<code class="xref py py-obj docutils literal notranslate"><span class="pre">worker_paht</span></code> 是默认的 <code class="xref py py-obj docutils literal notranslate"><span class="pre">default_worker.py</span></code> 路径。只有当容器中的 ray 安装目录与 raylet 主机不同时才需要。
<code class="xref py py-obj docutils literal notranslate"><span class="pre">run_options</span></code> 列表规范在 <a class="reference external" href="https://docs.docker.com/engine/reference/run/">这里</a>。</p>
<ul class="simple">
<li><p>示例: <code class="docutils literal notranslate"><span class="pre">{&quot;image&quot;:</span> <span class="pre">&quot;anyscale/ray-ml:nightly-py38-cpu&quot;,</span> <span class="pre">&quot;worker_path&quot;:</span> <span class="pre">&quot;/root/python/ray/workers/default_worker.py&quot;,</span> <span class="pre">&quot;run_options&quot;:</span> <span class="pre">[&quot;--cap-drop</span> <span class="pre">SYS_ADMIN&quot;,&quot;--log-level=debug&quot;]}</span></code></p></li>
</ul>
<p>注意：<code class="docutils literal notranslate"><span class="pre">container</span></code> 目前是实验性的。如果您有一些要求或遇到任何问题，请在 <a class="reference external" href="https://github.com/ray-project/ray/issues">github</a> 提交讨论。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">config</span></code> (dict | <a class="reference internal" href="api/doc/ray.runtime_env.RuntimeEnvConfig.html#ray.runtime_env.RuntimeEnvConfig" title="ray.runtime_env.RuntimeEnvConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">ray.runtime_env.RuntimeEnvConfig</span></code></a>): 运行时配置。可以是 dict 或 RuntimeEnvConfig。
字段：
(1) setup_timeout_seconds ，运行时环境创建的超时时间，单位为秒。</p>
<ul class="simple">
<li><p>示例: <code class="docutils literal notranslate"><span class="pre">{&quot;setup_timeout_seconds&quot;:</span> <span class="pre">10}</span></code></p></li>
<li><p>示例: <code class="docutils literal notranslate"><span class="pre">RuntimeEnvConfig(setup_timeout_seconds=10)</span></code></p></li>
</ul>
<p>(2) <code class="docutils literal notranslate"><span class="pre">eager_install</span></code> (bool): 表示是否在 <code class="docutils literal notranslate"><span class="pre">ray.init()</span></code> 时在集群上安装运行时环境，而不是在工作程序被租用之前。默认情况下，此标志设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。
如果设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，则只有在调用第一个任务或创建第一个 actor 时才会安装运行时环境。
当前，不支持为每个 actor 或每个任务指定此选项。</p>
<ul class="simple">
<li><p>示例: <code class="docutils literal notranslate"><span class="pre">{&quot;eager_install&quot;:</span> <span class="pre">False}</span></code></p></li>
<li><p>示例: <code class="docutils literal notranslate"><span class="pre">RuntimeEnvConfig(eager_install=False)</span></code></p></li>
</ul>
</li>
</ul>
<section id="runtime-environments-caching">
<span id="id8"></span><h4>缓存和垃圾回收<a class="headerlink" href="#runtime-environments-caching" title="Permalink to this headline">#</a></h4>
<p>在每个节点上的运行时资源（如 conda 环境、pip 包或下载的 <code class="docutils literal notranslate"><span class="pre">working_dir</span></code> 或 <code class="docutils literal notranslate"><span class="pre">py_modules</span></code> 目录）将被缓存在集群上，以便在作业内的不同运行时环境之间快速重用。
每个字段（<code class="docutils literal notranslate"><span class="pre">working_dir</span></code>、<code class="docutils literal notranslate"><span class="pre">py_modules</span></code> 等）都有自己的缓存，默认大小为 10 GB。要更改此默认值，您可以在启动 Ray 之前在集群中的每个节点上设置环境变量 <code class="docutils literal notranslate"><span class="pre">RAY_RUNTIME_ENV_&lt;field&gt;_CACHE_SIZE_GB</span></code>，例如 <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">RAY_RUNTIME_ENV_WORKING_DIR_CACHE_SIZE_GB=1.5</span></code>。</p>
<p>当超过缓存大小限制时，不被任何 actor、任务或作业当前使用的资源将被删除。</p>
</section>
<section id="id9">
<h4>继承<a class="headerlink" href="#id9" title="Permalink to this headline">#</a></h4>
<p>运行时环境是可继承的，因此它将应用于作业中的所有任务 / actor 以及task 或 actor的所有子任务 / actor，除非它被覆盖。</p>
<p>如果一个 actor 或任务指定了一个新的 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code>，它将覆盖父级的 <code class="docutils literal notranslate"><span class="pre">runtime_env``（即，父级</span> <span class="pre">actor/任务的</span> <span class="pre">``runtime_env</span></code>，或者如果没有父级 actor 或任务，则是作业的 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code>）如下：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">runtime_env[&quot;env_vars&quot;]</span></code> 字段会与父级的 <code class="docutils literal notranslate"><span class="pre">runtime_env[&quot;env_vars&quot;]</span></code> 字段合并。
这允许在父级的运行时环境中设置的环境变量自动传播到子级，即使在子级的运行时环境中设置了新的环境变量。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 字段中的其他每个字段都将被子级 <em>覆盖</em>，而不是合并。 例如，如果指定了 <code class="docutils literal notranslate"><span class="pre">runtime_env[&quot;py_modules&quot;]</span></code>，它将替换父级的 <code class="docutils literal notranslate"><span class="pre">runtime_env[&quot;py_modules&quot;]</span></code> 字段。</p></li>
</ul>
<p>示例:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parent&#39;s `runtime_env`</span>
<span class="p">{</span><span class="s2">&quot;pip&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;requests&quot;</span><span class="p">,</span> <span class="s2">&quot;chess&quot;</span><span class="p">],</span>
<span class="s2">&quot;env_vars&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">}}</span>

<span class="c1"># Child&#39;s specified `runtime_env`</span>
<span class="p">{</span><span class="s2">&quot;pip&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;torch&quot;</span><span class="p">,</span> <span class="s2">&quot;ray[serve]&quot;</span><span class="p">],</span>
<span class="s2">&quot;env_vars&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="s2">&quot;new&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="s2">&quot;c&quot;</span><span class="p">}}</span>

<span class="c1"># Child&#39;s actual `runtime_env` (merged with parent&#39;s)</span>
<span class="p">{</span><span class="s2">&quot;pip&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;torch&quot;</span><span class="p">,</span> <span class="s2">&quot;ray[serve]&quot;</span><span class="p">],</span>
<span class="s2">&quot;env_vars&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="s2">&quot;new&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="s2">&quot;c&quot;</span><span class="p">}}</span>
</pre></div>
</div>
</section>
</section>
<section id="runtime-env-faq">
<span id="id10"></span><h3>常见问题<a class="headerlink" href="#runtime-env-faq" title="Permalink to this headline">#</a></h3>
<section id="id11">
<h4>环境会被安装到每个节点吗？<a class="headerlink" href="#id11" title="Permalink to this headline">#</a></h4>
<p>如果在 <code class="docutils literal notranslate"><span class="pre">ray.init(runtime_env=...)</span></code> 中指定了运行时环境，则该环境将安装在每个节点上。有关更多详细信息，请参阅 <a class="reference internal" href="#rte-per-job"><span class="std std-ref">Per-Job</span></a>。
（注意，默认情况下，运行时环境将急切地安装在集群中的每个节点上。如果您想按需懒惰地安装运行时环境，请将 <code class="docutils literal notranslate"><span class="pre">eager_install</span></code> 选项设置为 false：<code class="docutils literal notranslate"><span class="pre">ray.init(runtime_env={...,</span> <span class="pre">&quot;config&quot;:</span> <span class="pre">{&quot;eager_install&quot;:</span> <span class="pre">False}}</span></code>。）</p>
</section>
<section id="id12">
<h4>环境什么时候安装？<a class="headerlink" href="#id12" title="Permalink to this headline">#</a></h4>
<p>当指定为每个作业时，环境在调用 <code class="docutils literal notranslate"><span class="pre">ray.init()</span></code> 安装（除非设置了 <code class="docutils literal notranslate"><span class="pre">&quot;eager_install&quot;:</span> <span class="pre">False</span></code>）。
当指定为每个任务或每个 actor 时，环境在调用任务或创建 actor 时安装（即，当你调用 <code class="docutils literal notranslate"><span class="pre">my_task.remote()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">my_actor.remote()</span></code> 时）。
参考 <a class="reference internal" href="#rte-per-job"><span class="std std-ref">Per-Job</span></a> 和 <a class="reference internal" href="#rte-per-task-actor"><span class="std std-ref">Per-Task/Actor, within a job</span></a> 以获取更多详细信息。</p>
</section>
<section id="id13">
<h4>环境缓存在哪里？<a class="headerlink" href="#id13" title="Permalink to this headline">#</a></h4>
<p>环境下载的任何本地文件都缓存在 <code class="docutils literal notranslate"><span class="pre">/tmp/ray/session_latest/runtime_resources</span></code>。</p>
</section>
<section id="id14">
<h4>安装或从缓存加载需要多长时间？<a class="headerlink" href="#id14" title="Permalink to this headline">#</a></h4>
<p>安装时间通常取决于您使用的 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 选项，主要是运行 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> 或 <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">create</span></code> / <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span></code>，或者上传/下载 <code class="docutils literal notranslate"><span class="pre">working_dir</span></code>，
这可能需要几秒钟或几分钟。</p>
<p>另一方面，从缓存加载运行时环境应该几乎与普通 Ray worker 启动时间一样快，大约几秒钟。对于每个需要新运行时环境的 Ray actor 或任务，都会启动一个新的 Ray worker。</p>
<p>（请注意，加载缓存的 <code class="docutils literal notranslate"><span class="pre">conda</span></code> 环境可能仍然很慢，因为 <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span></code> 命令有时需要几秒钟。）</p>
<p>你可以设置 <code class="docutils literal notranslate"><span class="pre">setup_timeout_seconds</span></code> 配置来避免安装时间过长。如果安装在此时间内没有完成，您的task 或 actor将无法启动。</p>
</section>
<section id="docker">
<h4>运行环境和 Docker 有什么关系？<a class="headerlink" href="#docker" title="Permalink to this headline">#</a></h4>
<p>它们可以单独使用，也可以一起使用。
可以在 <a class="reference internal" href="../cluster/vms/getting-started.html#vm-cluster-quick-start"><span class="std std-ref">Cluster Launcher</span></a> 中指定容器映像，用于大型或静态依赖项，并且可以为每个作业或每个任务/ actor 指定运行时环境，以用于更动态的用例。
运行时环境将从容器映像继承包、文件和环境变量。</p>
</section>
<section id="runtime-env">
<h4>我的 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 已经安装了，但是当我登录到节点时，我无法导入这些包。<a class="headerlink" href="#runtime-env" title="Permalink to this headline">#</a></h4>
<p>运行时环境仅对 Ray 工作进程有效；它不会在节点上“全局”安装任何包。</p>
</section>
</section>
</section>
<section id="uri">
<span id="remote-uris"></span><h2>远程 URI<a class="headerlink" href="#uri" title="Permalink to this headline">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">worker_dir</span></code> 和 <code class="docutils literal notranslate"><span class="pre">py_modules</span></code> 参数在 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 字典中可以指定本地路径或远程 URI。</p>
<p>本地路径必须是一个目录路径。目录的内容将直接作为 <code class="docutils literal notranslate"><span class="pre">working_dir</span></code> 或 <code class="docutils literal notranslate"><span class="pre">py_module</span></code> 访问。
远程 URI 必须是一个直接指向 zip 文件的链接。 <strong>zip 文件必须只包含一个顶级目录。</strong>
这些目录的内容将直接作为 <code class="docutils literal notranslate"><span class="pre">working_dir</span></code> 或 <code class="docutils literal notranslate"><span class="pre">py_module</span></code> 访问。</p>
<p>比如，你想把 <code class="docutils literal notranslate"><span class="pre">/some_path/example_dir</span></code> 目录的内容作为你的 <code class="docutils literal notranslate"><span class="pre">working_dir</span></code>。
如果你想指定这个目录作为一个本地路径，你的 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 字典应该包含：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">runtime_env</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">,</span> <span class="s2">&quot;working_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;/some_path/example_dir&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>
</pre></div>
</div>
<p>假设你想把你的文件放在 <code class="docutils literal notranslate"><span class="pre">/some_path/example_dir</span></code> 目录中，并提供一个远程 URI。
你首先需要将 <code class="docutils literal notranslate"><span class="pre">example_dir</span></code> 目录压缩成一个 zip 文件。</p>
<p>这里应该没有其他文件或目录在 zip 文件的顶层，除了 <code class="docutils literal notranslate"><span class="pre">example_dir</span></code>。
你可以使用以下命令在终端中执行：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /some_path
zip -r zip_file_name.zip example_dir
</pre></div>
</div>
<p>注意，这个命令必须从所需 <code class="docutils literal notranslate"><span class="pre">working_dir</span></code> 的 <em>父目录</em> 运行，以确保生成的 zip 文件包含一个顶级目录。
通常，zip 文件的名称和顶级目录的名称可以是任何东西。
顶级目录的内容将被用作 <code class="docutils literal notranslate"><span class="pre">working_dir``（或</span> <span class="pre">``py_module</span></code>）。</p>
<p>你可以通过在终端中运行以下命令来检查 zip 文件是否包含一个顶级目录：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>zipinfo -1 zip_file_name.zip
<span class="c1"># example_dir/</span>
<span class="c1"># example_dir/my_file_1.txt</span>
<span class="c1"># example_dir/subdir/my_file_2.txt</span>
</pre></div>
</div>
<p>假设你将压缩的 <code class="docutils literal notranslate"><span class="pre">example_dir</span></code> 目录上传到 AWS S3 的 S3 URI <code class="docutils literal notranslate"><span class="pre">s3://example_bucket/example.zip</span></code>。
你的 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 字典应该包含：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">runtime_env</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">,</span> <span class="s2">&quot;working_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://example_bucket/example.zip&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>检查在压缩文件中是否有隐藏文件或元数据目录。
你可以通过在终端中运行 <code class="docutils literal notranslate"><span class="pre">zipinfo</span> <span class="pre">-1</span> <span class="pre">zip_file_name.zip</span></code> 命令来检查 zip 文件的内容。
一些压缩方法可能会导致隐藏文件或元数据目录出现在 zip 文件的顶层。
要避免这种情况，请直接在要压缩的目录的父目录上使用 <code class="docutils literal notranslate"><span class="pre">zip</span> <span class="pre">-r</span></code> 命令。例如，如果你有一个目录结构，如：<code class="docutils literal notranslate"><span class="pre">a/b</span></code>，你想压缩 <code class="docutils literal notranslate"><span class="pre">b</span></code>，请在目录 <code class="docutils literal notranslate"><span class="pre">a</span></code> 上发出 <code class="docutils literal notranslate"><span class="pre">zip</span> <span class="pre">-r</span> <span class="pre">b</span></code> 命令。
如果 Ray 检测到顶层有多个目录，它将使用整个 zip 文件而不是顶层目录，这可能会导致意外行为。</p>
</div>
<p>当前支持三种远程 URI 类型来托管 <code class="docutils literal notranslate"><span class="pre">working_dir</span></code> 和 <code class="docutils literal notranslate"><span class="pre">py_modules</span></code> 包：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">HTTPS</span></code>: <code class="docutils literal notranslate"><span class="pre">HTTPS</span></code> 引用时以 <code class="docutils literal notranslate"><span class="pre">https</span></code> 打头的 URL。
这些 URL 特别有用，因为远程 Git 提供商（如：GitHub、Bitbucket、GitLab 等）使用 <code class="docutils literal notranslate"><span class="pre">https</span></code> URL 作为存储库存档的下载链接。
这允许你将依赖项托管在远程 Git 提供商上，推送更新，并指定作业应使用哪些依赖项版本（即提交版本）。
要通过 <code class="docutils literal notranslate"><span class="pre">HTTPS</span></code> URI 使用包，你必须安装 <code class="docutils literal notranslate"><span class="pre">smart_open</span></code> 库（你可以使用 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">smart_open</span></code> 安装它）。</p>
<ul>
<li><p>示例:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">runtime_env</span> <span class="pre">=</span> <span class="pre">{&quot;working_dir&quot;:</span> <span class="pre">&quot;https://github.com/example_username/example_respository/archive/HEAD.zip&quot;}</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">S3</span></code>: <code class="docutils literal notranslate"><span class="pre">S3</span></code> 引用是以 <code class="docutils literal notranslate"><span class="pre">s3://</span></code> 打头的 URI，它指向了存储在 <a class="reference external" href="https://aws.amazon.com/s3/">AWS S3</a> 压缩包。
要使用 <code class="docutils literal notranslate"><span class="pre">S3</span></code> URI，你必须安装 <code class="docutils literal notranslate"><span class="pre">smart_open</span></code> 和 <code class="docutils literal notranslate"><span class="pre">boto3</span></code> 库（你可以使用 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">smart_open</span></code> 和 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">boto3</span></code> 安装它们）。
Ray 不会为认证传递任何凭据给 <code class="docutils literal notranslate"><span class="pre">boto3</span></code>。
<code class="docutils literal notranslate"><span class="pre">boto3</span></code> 将使用你的环境变量、共享凭据文件和/或 AWS 配置文件来验证访问。
参考 <a class="reference external" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html">AWS S3 文档</a> 来设置你的远程包。</p>
<ul>
<li><p>示例:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">runtime_env</span> <span class="pre">=</span> <span class="pre">{&quot;working_dir&quot;:</span> <span class="pre">&quot;s3://example_bucket/example_file.zip&quot;}</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GS</span></code>: <code class="docutils literal notranslate"><span class="pre">GS</span></code> 引用是以 <code class="docutils literal notranslate"><span class="pre">gs://</span></code> 打头的 URI，它指向了存储在 <a class="reference external" href="https://cloud.google.com/storage">Google Cloud Storage</a> 压缩包。
要通过 <code class="docutils literal notranslate"><span class="pre">GS</span></code> URI 使用包，你必须安装 <code class="docutils literal notranslate"><span class="pre">smart_open</span></code> 和 <code class="docutils literal notranslate"><span class="pre">google-cloud-storage</span></code> 库（你可以使用 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">smart_open</span></code> 和 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">google-cloud-storage</span></code> 安装它们）。
Ray 不会为 <code class="docutils literal notranslate"><span class="pre">google-cloud-storage</span></code> 的 <code class="docutils literal notranslate"><span class="pre">Client</span></code> 对象传递任何凭据。
<code class="docutils literal notranslate"><span class="pre">google-cloud-storage</span></code> 默认情况下将使用你的本地服务帐户密钥和环境变量。
参考 <a class="reference external" href="https://cloud.google.com/storage/docs">Google Cloud Storage 文档</a> 来设置认证，它允许你接入远程包。</p>
<ul>
<li><p>示例:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">runtime_env</span> <span class="pre">=</span> <span class="pre">{&quot;working_dir&quot;:</span> <span class="pre">&quot;gs://example_bucket/example_file.zip&quot;}</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>注意，<code class="docutils literal notranslate"><span class="pre">smart_open</span></code>、<code class="docutils literal notranslate"><span class="pre">boto3</span></code> 和 <code class="docutils literal notranslate"><span class="pre">google-cloud-storage</span></code> 包默认情况下不会被安装，仅在 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 的 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 部分中指定它们是不够的。
在 Ray 启动时，集群的所有节点上必须已经安装了相关包。</p>
</section>
<section id="git">
<h2>在远程 Git 提供商上托管依赖项：手把手指南<a class="headerlink" href="#git" title="Permalink to this headline">#</a></h2>
<p>您可以将依赖项存储在远程 Git 提供商（例如 GitHub、Bitbucket、GitLab 等）的存储库中，并且可以定期推送更改以使其保持更新。
在本节中，您将学习如何将依赖项存储在 GitHub 上并在运行时环境中使用它。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>如果您使用其他大型远程 Git 提供商（例如 BitBucket、GitLab 等），这些步骤也将很有用。
为简单起见，本节仅指 GitHub，但您可以在提供商上继续操作。</p>
</div>
<p>首先，在 GitHub 上创建一个存储 <code class="docutils literal notranslate"><span class="pre">working_dir</span></code> 内容或 <code class="docutils literal notranslate"><span class="pre">py_module</span></code> 依赖项的存储库。
默认的，当你下载存储库的 zip 文件时，zip 文件将已经包含一个顶级目录，其中包含存储库的内容，
所以你可以直接上传你的 <code class="docutils literal notranslate"><span class="pre">working_dir</span></code> 内容或 <code class="docutils literal notranslate"><span class="pre">py_module</span></code> 依赖项到 GitHub 存储库。</p>
<p>一旦你上传了 <code class="docutils literal notranslate"><span class="pre">working_dir</span></code> 内容或 <code class="docutils literal notranslate"><span class="pre">py_module</span></code> 依赖项，你需要存储库 zip 文件的 HTTPS URL，这样你就可以在 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 字典中指定它。</p>
<p>你有两种方法获取 HTTPS URL。</p>
<section id="zip">
<h3>方法 1: 下载 Zip (快速实现，单不推荐用于生产环境)<a class="headerlink" href="#zip" title="Permalink to this headline">#</a></h3>
<p>第一个选项是使用远程 Git 提供商的 “Download Zip” 功能，它提供了一个 HTTPS 链接，用于压缩并下载存储库。
这样很快，但是 <strong>不推荐</strong>，因为它只允许你下载存储库分支的最新提交的 zip 文件。
要找到 GitHub URL，请在 <a class="reference external" href="https://github.com/">GitHub</a>，选择一个分支，然后点击绿色的 “Code” 下拉按钮：</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/ray_repo.png"><img alt="../_images/ray_repo.png" src="../_images/ray_repo.png" style="width: 500px;" /></a>
</figure>
<p>这会弹出一个菜单，提供三个选项：”Clone” 提供了克隆存储库的 HTTPS/SSH 链接，”Open with GitHub Desktop” 以及 “Download ZIP.”
点击 “Download Zip.”
这会在你鼠标弹出一个 pop，选择“Copy Link Address”：</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/download_zip_url.png"><img alt="../_images/download_zip_url.png" src="../_images/download_zip_url.png" style="width: 300px;" /></a>
</figure>
<p>现在你的 HTTPS 链接已经复制到剪贴板中。你可以将它粘贴到你的 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 字典中。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>使用远程 Git 提供商的 “Download as Zip” 功能的 HTTPS URL 不推荐，如果 URL 总是指向最新提交的话。
例如，在 GitHub 上使用此方法会生成一个始终指向所选分支上的最新提交的链接。</p>
<p>通过在 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 字典中指定此链接，你的 Ray 集群总是使用所选分支的最新提交。
这会产生一致性风险：如果你在集群的节点拉取存储库内容时推送了更新，
一些节点可能会拉取你推送之前的包版本，而另一些节点可能会拉取你推送之后的版本。
为了保持一致性，最好指定一个特定的提交，这样所有节点都使用相同的包。
参考 “方法 2: 手动创建 URL” 来创建一个指向特定提交的 URL。</p>
</div>
</section>
<section id="url">
<h3>方法 2: 手动创建 URL (较慢实现，但推荐用于生产)<a class="headerlink" href="#url" title="Permalink to this headline">#</a></h3>
<p>第二个选项是通过将你的特定用例与以下示例之一进行模式匹配，手动创建此 URL。
<strong>建议这样做</strong> 因为它可以更细粒度地控制在生成依赖项 zip 文件时要使用哪个存储库分支和提交。
这些选项可防止 Ray Clusters 上的一致性问题（有关更多信息，请参阅上面的警告）。
要创建 URL，请选择下面适合您用例的 URL 模板，并使用存储库中的特定值填写括号中的所有参数（例如 [用户名]、[存储库] 等）。
例如，假设你的 GitHub 用户名是 <code class="docutils literal notranslate"><span class="pre">example_user</span></code>，存储库的名称是 <code class="docutils literal notranslate"><span class="pre">example_repository</span></code>，并且所需的提交哈希是 <code class="docutils literal notranslate"><span class="pre">abcdefg</span></code>。
如果 <code class="docutils literal notranslate"><span class="pre">example_repository</span></code> 是公共的，并且你想要检索 <code class="docutils literal notranslate"><span class="pre">abcdefg</span></code> 提交（与第一个示例用例匹配），URL 将是：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">runtime_env</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;working_dir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;https://github.com&quot;</span>
                               <span class="s2">&quot;/example_user/example_repository/archive/abcdefg.zip&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<p>以下是不同用例和对应 URL 的列表：</p>
<ul class="simple">
<li><p>示例：从公共 GitHub 存储库上的特定提交哈希中检索包</p></li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">runtime_env</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;working_dir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;https://github.com&quot;</span>
                               <span class="s2">&quot;/[username]/[repository]/archive/[commit hash].zip&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>示例： <strong>开发阶段</strong> 使用个人接入认证从私有 GitHub 存储库中检索包。 <strong>生产阶段</strong> 请参考 <a class="reference internal" href="runtime_env_auth.html#runtime-env-auth"><span class="std std-ref">此文档</span></a> 以了解如何安全地对私有依赖项进行身份验证。</p></li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">runtime_env</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;working_dir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;https://[username]:[personal access token]@github.com&quot;</span>
                               <span class="s2">&quot;/[username]/[private repository]/archive/[commit hash].zip&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>示例：从公共 GitHub 存储库的最新提交中检索包</p></li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">runtime_env</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;working_dir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;https://github.com&quot;</span>
                               <span class="s2">&quot;/[username]/[repository]/archive/HEAD.zip&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>示例：从公共 Bitbucket 存储库上的特定提交哈希中检索包</p></li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">runtime_env</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;working_dir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;https://bitbucket.org&quot;</span>
                               <span class="s2">&quot;/[owner]/[repository]/get/[commit hash].tar.gz&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>建议指定特定提交，而不是始终使用最新提交。
这可以防止多节点 Ray 集群出现一致性问题。
有关更多信息，请参阅“选项 1：下载 Zip”下方的警告。</p>
</div>
<p>一旦你在 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 字典中指定了 URL，你就可以将字典传递给 <code class="docutils literal notranslate"><span class="pre">ray.init()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">.options()</span></code> 调用。
恭喜！你现在已经在 GitHub 上远程托管了一个 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 依赖项！</p>
</section>
</section>
<section id="id17">
<h2>调试<a class="headerlink" href="#id17" title="Permalink to this headline">#</a></h2>
<p>如果 runtime_env 无法设置（例如，网络问题、下载失败等），Ray 将无法调度需要 runtime_env 的任务/ actor 。
如果你调用 <code class="docutils literal notranslate"><span class="pre">ray.get</span></code>，它将引发 <code class="docutils literal notranslate"><span class="pre">RuntimeEnvSetupError</span></code> 并提供详细的错误消息。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">bad_env</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;conda&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;this_doesnt_exist&quot;</span><span class="p">]}}</span>

<span class="c1"># [Tasks] will raise `RuntimeEnvSetupError`.</span>
<span class="k">try</span><span class="p">:</span>
  <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">runtime_env</span><span class="o">=</span><span class="n">bad_env</span><span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">())</span>
<span class="k">except</span> <span class="n">ray</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RuntimeEnvSetupError</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Task fails with RuntimeEnvSetupError&quot;</span><span class="p">)</span>

<span class="c1"># [Actors] will raise `RuntimeEnvSetupError`.</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">runtime_env</span><span class="o">=</span><span class="n">bad_env</span><span class="p">)</span><span class="o">.</span><span class="n">remote</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
  <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">remote</span><span class="p">())</span>
<span class="k">except</span> <span class="n">ray</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RuntimeEnvSetupError</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Actor fails with RuntimeEnvSetupError&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Task fails with RuntimeEnvSetupError
Actor fails with RuntimeEnvSetupError
</pre></div>
</div>
<p>完整的日志可以在 <code class="docutils literal notranslate"><span class="pre">runtime_env_setup-[job_id].log</span></code> 文件中找到，用于每个 actor 、每个任务和每个作业的环境，或者
在使用 Ray Client 时用于每个作业的环境中的 <code class="docutils literal notranslate"><span class="pre">runtime_env_setup-ray_client_server_[port].log</span></code> 文件中找到。</p>
<blockquote>
<div><p>你也可以在每个节点上在启动 Ray 之前设置环境变量 <code class="docutils literal notranslate"><span class="pre">RAY_RUNTIME_ENV_LOG_TO_DRIVER_ENABLED=1</span></code>，例如使用 Ray 集群配置文件中的 <code class="docutils literal notranslate"><span class="pre">setup_commands</span></code> (<a class="reference internal" href="../cluster/vms/references/ray-cluster-configuration.html#cluster-configuration-setup-commands"><span class="std std-ref">reference</span></a>)。</p>
</div></blockquote>
<p>这会打印完整的 <code class="docutils literal notranslate"><span class="pre">runtime_env</span></code> 设置日志消息到驱动程序（调用 <code class="docutils literal notranslate"><span class="pre">ray.init()</span></code> 的脚本）。</p>
<p>示例日志输出：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">runtime_env</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pip&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;requests&quot;</span><span class="p">]})</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(pid=runtime_env) 2022-02-28 14:12:33,653       INFO pip.py:188 -- Creating virtualenv at /tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/virtualenv, current python dir /Users/user/anaconda3/envs/ray-py38
(pid=runtime_env) 2022-02-28 14:12:33,653       INFO utils.py:76 -- Run cmd[1] [&#39;/Users/user/anaconda3/envs/ray-py38/bin/python&#39;, &#39;-m&#39;, &#39;virtualenv&#39;, &#39;--app-data&#39;, &#39;/tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/virtualenv_app_data&#39;, &#39;--reset-app-data&#39;, &#39;--no-periodic-update&#39;, &#39;--system-site-packages&#39;, &#39;--no-download&#39;, &#39;/tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/virtualenv&#39;]
(pid=runtime_env) 2022-02-28 14:12:34,267       INFO utils.py:97 -- Output of cmd[1]: created virtual environment CPython3.8.11.final.0-64 in 473ms
(pid=runtime_env)   creator CPython3Posix(dest=/private/tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/virtualenv, clear=False, no_vcs_ignore=False, global=True)
(pid=runtime_env)   seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app_data_dir=/private/tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/virtualenv_app_data)
(pid=runtime_env)     added seed packages: pip==22.0.3, setuptools==60.6.0, wheel==0.37.1
(pid=runtime_env)   activators BashActivator,CShellActivator,FishActivator,NushellActivator,PowerShellActivator,PythonActivator
(pid=runtime_env)
(pid=runtime_env) 2022-02-28 14:12:34,268       INFO utils.py:76 -- Run cmd[2] [&#39;/tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/virtualenv/bin/python&#39;, &#39;-c&#39;, &#39;import ray; print(ray.__version__, ray.__path__[0])&#39;]
(pid=runtime_env) 2022-02-28 14:12:35,118       INFO utils.py:97 -- Output of cmd[2]: 3.0.0.dev0 /Users/user/ray/python/ray
(pid=runtime_env)
(pid=runtime_env) 2022-02-28 14:12:35,120       INFO pip.py:236 -- Installing python requirements to /tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/virtualenv
(pid=runtime_env) 2022-02-28 14:12:35,122       INFO utils.py:76 -- Run cmd[3] [&#39;/tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/virtualenv/bin/python&#39;, &#39;-m&#39;, &#39;pip&#39;, &#39;install&#39;, &#39;--disable-pip-version-check&#39;, &#39;--no-cache-dir&#39;, &#39;-r&#39;, &#39;/tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/requirements.txt&#39;]
(pid=runtime_env) 2022-02-28 14:12:38,000       INFO utils.py:97 -- Output of cmd[3]: Requirement already satisfied: requests in /Users/user/anaconda3/envs/ray-py38/lib/python3.8/site-packages (from -r /tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/requirements.txt (line 1)) (2.26.0)
(pid=runtime_env) Requirement already satisfied: idna&lt;4,&gt;=2.5 in /Users/user/anaconda3/envs/ray-py38/lib/python3.8/site-packages (from requests-&gt;-r /tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/requirements.txt (line 1)) (3.2)
(pid=runtime_env) Requirement already satisfied: certifi&gt;=2017.4.17 in /Users/user/anaconda3/envs/ray-py38/lib/python3.8/site-packages (from requests-&gt;-r /tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/requirements.txt (line 1)) (2021.10.8)
(pid=runtime_env) Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in /Users/user/anaconda3/envs/ray-py38/lib/python3.8/site-packages (from requests-&gt;-r /tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/requirements.txt (line 1)) (1.26.7)
(pid=runtime_env) Requirement already satisfied: charset-normalizer~=2.0.0 in /Users/user/anaconda3/envs/ray-py38/lib/python3.8/site-packages (from requests-&gt;-r /tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/requirements.txt (line 1)) (2.0.6)
(pid=runtime_env)
(pid=runtime_env) 2022-02-28 14:12:38,001       INFO utils.py:76 -- Run cmd[4] [&#39;/tmp/ray/session_2022-02-28_14-12-29_909064_87908/runtime_resources/pip/0cc818a054853c3841171109300436cad4dcf594/virtualenv/bin/python&#39;, &#39;-c&#39;, &#39;import ray; print(ray.__version__, ray.__path__[0])&#39;]
(pid=runtime_env) 2022-02-28 14:12:38,804       INFO utils.py:97 -- Output of cmd[4]: 3.0.0.dev0 /Users/user/ray/python/ray
</pre></div>
</div>
<p>参考 <a class="reference internal" href="../ray-observability/user-guides/configure-logging.html#logging-directory-structure"><span class="std std-ref">Logging 目录结构</span></a> 获取更多信息。</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="objects/object-spilling.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">对象溢出</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="scheduling/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">调度</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><!-- Override the footer area for the sphinx-book-theme to include the CSAT widget -->
<div id="csat">
  <div id="csat-feedback-received" class="csat-hidden">
    <span>谢谢你的反馈！</span>
  </div>
  <div id="csat-inputs">
    <span>是否能帮助到你？</span>
    <div id="csat-yes" class="csat-button">
      <svg id="csat-yes-icon" class="csat-hidden csat-icon" width="18" height="13" viewBox="0 0 18 13" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.00023 10.172L16.1922 0.979004L17.6072 2.393L7.00023 13L0.63623 6.636L2.05023 5.222L7.00023 10.172Z" fill="black"/>
      </svg>
      <span>是<span>
    </div>
    <div id="csat-no" class="csat-button">
      <svg id="csat-no-icon" class="csat-hidden csat-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.00023 5.58599L11.9502 0.635986L13.3642 2.04999L8.41423 6.99999L13.3642 11.95L11.9502 13.364L7.00023 8.41399L2.05023 13.364L0.63623 11.95L5.58623 6.99999L0.63623 2.04999L2.05023 0.635986L7.00023 5.58599Z" fill="black"/>
      </svg>
      <span>否<span>
    </div>
  </div>
  <div id="csat-textarea-group" class="csat-hidden">
    <span id="csat-feedback-label">反馈</span>
    <textarea id="csat-textarea"></textarea>
    <div id="csat-submit">提交</div>
  </div>
</div><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2024, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>