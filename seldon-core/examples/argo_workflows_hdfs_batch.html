<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-54780881-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'UA-54780881-2');
</script>
  
  
    <title>Batch processing with Argo Worfklows and HDFS &#8212; seldon-core  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=83e35b93" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/rtd_sphinx_search.min.css?v=e72958e9" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=15a8f09d" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/rtd_search_config.js?v=b0596c34"></script>
    <script src="../_static/js/rtd_sphinx_search.min.js?v=43f26ba4"></script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Batch processing with Kubeflow Pipelines" href="kubeflow_pipelines_batch.html" />
    <link rel="prev" title="Batch processing with Argo Worfklows" href="argo_workflows_batch.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=teal>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#examples/argo_workflows_hdfs_batch" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="seldon-core  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Seldon Core Documentation</span>
          <span class="md-header-nav__topic"> Batch processing with Argo Worfklows and HDFS </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/SeldonIO/seldon-core/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Seldon Core
  </div>
</a>
          </div>
        </div>
      
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="/" class="md-tabs__link">🚀 Our Other Projects & Products:</a></li>
            
            <li class="md-tabs__item"><a href="https://docs.seldon.io/projects/alibi/en/stable/" class="md-tabs__link">Alibi Explain</a></li>
            
            <li class="md-tabs__item"><a href="https://docs.seldon.io/projects/alibi-detect/en/stable/" class="md-tabs__link">Alibi Detect</a></li>
            
            <li class="md-tabs__item"><a href="https://mlserver.readthedocs.io/en/latest/" class="md-tabs__link">MLServer</a></li>
            
            <li class="md-tabs__item"><a href="https://tempo.readthedocs.io/en/latest/" class="md-tabs__link">Tempo SDK</a></li>
            
            <li class="md-tabs__item"><a href="https://deploy.seldon.io" class="md-tabs__link">Seldon Enterprise Platform</a></li>
            
            <li class="md-tabs__item"><a href="https://github.com/SeldonIO/seldon-deploy-sdk#seldon-deploy-sdk" class="md-tabs__link">Seldon Enterprise Platform SDK</a></li>
          <li class="md-tabs__item"><a href="../nav/tutorials.html" class="md-tabs__link">教程</a></li>
          <li class="md-tabs__item"><a href="notebooks.html" class="md-tabs__link">笔记本</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="seldon-core documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="seldon-core documentation">Seldon Core Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/SeldonIO/seldon-core/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Seldon Core
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../nav/getting-started.html" class="md-nav__link">开始</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/concepts.html" class="md-nav__link">概念</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/configuration.html" class="md-nav__link">配置</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/tutorials.html" class="md-nav__link">教程</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="notebooks.html" class="md-nav__link">笔记本</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#seldon-core" class="md-nav__link">Seldon Core 设置</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id2" class="md-nav__link">预包装推理服务示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#python" class="md-nav__link">Python 语言封装示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id3" class="md-nav__link">专门的框架示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id4" class="md-nav__link">孵化项目示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id5" class="md-nav__link">基于云的基础示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id6" class="md-nav__link">高级机器学习监控</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id7" class="md-nav__link">Seldon Core 批处理</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#mlops" class="md-nav__link">MLOps: 扩展、监控和可观察性</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id8" class="md-nav__link">生产配置及实现</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#ab" class="md-nav__link">AB 测试及渐进式部署</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id9" class="md-nav__link">复杂图示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id10" class="md-nav__link">入口</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id11" class="md-nav__link">基础设施</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id12" class="md-nav__link">基准测试和负载测试</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id13" class="md-nav__link">升级示例</a>
      
    
    </li></ul>
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/reference.html" class="md-nav__link">参考</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/contributing.html" class="md-nav__link">贡献</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#examples-argo-workflows-hdfs-batch--page-root" class="md-nav__link">Batch processing with Argo Worfklows and HDFS</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Setup" class="md-nav__link">Setup</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Install-Seldon-Core" class="md-nav__link">Install Seldon Core</a>
        </li>
        <li class="md-nav__item"><a href="#Install-HDFS" class="md-nav__link">Install HDFS</a>
        </li>
        <li class="md-nav__item"><a href="#Install-and-configure-hdfscli" class="md-nav__link">Install and configure hdfscli</a>
        </li>
        <li class="md-nav__item"><a href="#Install-Argo-Workflows" class="md-nav__link">Install Argo Workflows</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Create-Seldon-Deployment" class="md-nav__link">Create Seldon Deployment</a>
        </li>
        <li class="md-nav__item"><a href="#Create-Input-Data" class="md-nav__link">Create Input Data</a>
        </li>
        <li class="md-nav__item"><a href="#Prepare-HDFS-config-/-client-image" class="md-nav__link">Prepare HDFS config / client image</a>
        </li>
        <li class="md-nav__item"><a href="#Create-Workflow" class="md-nav__link">Create Workflow</a>
        </li>
        <li class="md-nav__item"><a href="#Pull-output-data-from-hdfs" class="md-nav__link">Pull output-data from hdfs</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/examples/argo_workflows_hdfs_batch.nblink.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <div class="admonition note">
<p>This page was generated from <a class="reference external" href="https://github.com/SeldonIO/seldon-core/blob/e665e4994eabf83fb43c68a5f85e96d5c45e91b5/examples/batch/hdfs-argo-workflows/hdfs-batch.ipynb">examples/batch/hdfs-argo-workflows/hdfs-batch.ipynb</a>.</p>
</div>
<section id="Batch-processing-with-Argo-Worfklows-and-HDFS">
<h1 id="examples-argo-workflows-hdfs-batch--page-root">Batch processing with Argo Worfklows and HDFS<a class="headerlink" href="#examples-argo-workflows-hdfs-batch--page-root" title="Permalink to this heading">¶</a></h1>
<p>In this notebook we will dive into how you can run batch processing with Argo Workflows and Seldon Core.</p>
<p>Dependencies:</p>
<ul class="simple">
<li><p>Seldon core installed as per the docs with an ingress</p></li>
<li><p>HDFS namenode/datanode accessible from your cluster (here in-cluster installation for demo)</p></li>
<li><p>Argo Workfklows installed in cluster (and argo CLI for commands)</p></li>
<li><p>Python <code class="docutils literal notranslate"><span class="pre">hdfscli</span></code> for interacting with the installed <code class="docutils literal notranslate"><span class="pre">hdfs</span></code> instance</p></li>
</ul>
<section id="Setup">
<h2 id="Setup">Setup<a class="headerlink" href="#Setup" title="Permalink to this heading">¶</a></h2>
<section id="Install-Seldon-Core">
<h3 id="Install-Seldon-Core">Install Seldon Core<a class="headerlink" href="#Install-Seldon-Core" title="Permalink to this heading">¶</a></h3>
<p>Use the notebook to <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/seldon_core_setup.html">set-up Seldon Core with Ambassador or Istio Ingress</a>.</p>
<p>Note: If running with KIND you need to make sure do follow <a class="reference external" href="https://github.com/argoproj/argo-workflows/issues/2376#issuecomment-595593237">these steps</a> as workaround to the <code class="docutils literal notranslate"><span class="pre">/.../docker.sock</span></code> known issue:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>patch<span class="w"> </span>-n<span class="w"> </span>argo<span class="w"> </span>configmap<span class="w"> </span>workflow-controller-configmap<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--type<span class="w"> </span>merge<span class="w"> </span>-p<span class="w"> </span><span class="s1">'{"data": {"config": "containerRuntimeExecutor: k8sapi"}}'</span>
</pre></div>
</div>
</section>
<section id="Install-HDFS">
<h3 id="Install-HDFS">Install HDFS<a class="headerlink" href="#Install-HDFS" title="Permalink to this heading">¶</a></h3>
<p>For this example we will need a running <code class="docutils literal notranslate"><span class="pre">hdfs</span></code> storage. We can use these <a class="reference external" href="https://artifacthub.io/packages/helm/gradiant/hdfs">helm charts</a> from Gradiant.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>gradiant<span class="w"> </span>https://gradiant.github.io/charts/
kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>hdfs-system<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"namespace hdfs-system already exists"</span>
helm<span class="w"> </span>install<span class="w"> </span>hdfs<span class="w"> </span>gradiant/hdfs<span class="w"> </span>--namespace<span class="w"> </span>hdfs-system
</pre></div>
</div>
<p>Once installation is complete, run in separate terminal a <code class="docutils literal notranslate"><span class="pre">port-forward</span></code> command for us to be able to push/pull batch data.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>port-forward<span class="w"> </span>-n<span class="w"> </span>hdfs-system<span class="w"> </span>svc/hdfs-httpfs<span class="w"> </span><span class="m">14000</span>:14000
</pre></div>
</div>
</section>
<section id="Install-and-configure-hdfscli">
<h3 id="Install-and-configure-hdfscli">Install and configure hdfscli<a class="headerlink" href="#Install-and-configure-hdfscli" title="Permalink to this heading">¶</a></h3>
<p>In this example we will be using <a class="reference external" href="https://pypi.org/project/hdfs/">hdfscli</a> Python library for interacting with HDFS. It supports both the WebHDFS (and HttpFS) API as well as Kerberos authentication (not covered by the example).</p>
<p>You can install it with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">hdfs</span><span class="o">==</span><span class="m">2</span>.5.8
</pre></div>
</div>
<p>To be able to put <code class="docutils literal notranslate"><span class="pre">input-data.txt</span></code> for our batch job into hdfs we need to configure the client</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> hdfscli.cfg
<span class="p">[</span><span class="k">global</span><span class="p">]</span>
<span class="n">default</span><span class="o">.</span><span class="n">alias</span> <span class="o">=</span> <span class="n">batch</span>

<span class="p">[</span><span class="n">batch</span><span class="o">.</span><span class="n">alias</span><span class="p">]</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">14000</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">hdfs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overwriting hdfscli.cfg
</pre></div></div>
</div>
</section>
<section id="Install-Argo-Workflows">
<h3 id="Install-Argo-Workflows">Install Argo Workflows<a class="headerlink" href="#Install-Argo-Workflows" title="Permalink to this heading">¶</a></h3>
<p>You can follow the instructions from the official <a class="reference external" href="https://github.com/argoproj/argo#quickstart">Argo Workflows Documentation</a>.</p>
<p>You also need to make sure that argo has permissions to create seldon deployments - for this you can create a role:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> role.yaml
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Role</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">workflow</span>
<span class="n">rules</span><span class="p">:</span>
<span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
  <span class="o">-</span> <span class="s2">""</span>
  <span class="n">resources</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">pods</span>
  <span class="n">verbs</span><span class="p">:</span>
  <span class="o">-</span> <span class="s2">"*"</span>
<span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
  <span class="o">-</span> <span class="s2">"apps"</span>
  <span class="n">resources</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">deployments</span>
  <span class="n">verbs</span><span class="p">:</span>
  <span class="o">-</span> <span class="s2">"*"</span>
<span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
  <span class="o">-</span> <span class="s2">""</span>
  <span class="n">resources</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">pods</span><span class="o">/</span><span class="n">log</span>
  <span class="n">verbs</span><span class="p">:</span>
  <span class="o">-</span> <span class="s2">"*"</span>
<span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">machinelearning</span><span class="o">.</span><span class="n">seldon</span><span class="o">.</span><span class="n">io</span>
  <span class="n">resources</span><span class="p">:</span>
  <span class="o">-</span> <span class="s2">"*"</span>
  <span class="n">verbs</span><span class="p">:</span>
  <span class="o">-</span> <span class="s2">"*"</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overwriting role.yaml
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>role.yaml
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
role.rbac.authorization.k8s.io/workflow unchanged
</pre></div></div>
</div>
<p>A service account:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>create<span class="w"> </span>serviceaccount<span class="w"> </span>workflow
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
serviceaccount/workflow created
</pre></div></div>
</div>
<p>And a binding</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>create<span class="w"> </span>rolebinding<span class="w"> </span>workflow<span class="w"> </span>--role<span class="o">=</span>workflow<span class="w"> </span>--serviceaccount<span class="o">=</span>seldon:workflow
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
rolebinding.rbac.authorization.k8s.io/workflow created
</pre></div></div>
</div>
</section>
</section>
<section id="Create-Seldon-Deployment">
<h2 id="Create-Seldon-Deployment">Create Seldon Deployment<a class="headerlink" href="#Create-Seldon-Deployment" title="Permalink to this heading">¶</a></h2>
<p>For purpose of this batch example we will assume that Seldon Deployment is created independently from the workflow logic</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> deployment.yaml
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">machinelearning</span><span class="o">.</span><span class="n">seldon</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1alpha2</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">SeldonDeployment</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">sklearn</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">seldon</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">iris</span>
  <span class="n">predictors</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">graph</span><span class="p">:</span>
      <span class="n">children</span><span class="p">:</span> <span class="p">[]</span>
      <span class="n">implementation</span><span class="p">:</span> <span class="n">SKLEARN_SERVER</span>
      <span class="n">modelUri</span><span class="p">:</span> <span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">seldon</span><span class="o">-</span><span class="n">models</span><span class="o">/</span><span class="n">v1</span><span class="mf">.14.0</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">iris</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">classifier</span>
      <span class="n">logger</span><span class="p">:</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">all</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">default</span>
    <span class="n">replicas</span><span class="p">:</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overwriting deployment.yaml
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>deployment.yaml
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
seldondeployment.machinelearning.seldon.io/sklearn configured
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>-n<span class="w"> </span>seldon<span class="w"> </span>rollout<span class="w"> </span>status<span class="w"> </span>deploy/<span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>deploy<span class="w"> </span>-l<span class="w"> </span>seldon-deployment-id<span class="o">=</span>sklearn<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[0].metadata.name}'</span><span class="k">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
deployment "sklearn-default-0-classifier" successfully rolled out
</pre></div></div>
</div>
</section>
<section id="Create-Input-Data">
<h2 id="Create-Input-Data">Create Input Data<a class="headerlink" href="#Create-Input-Data" title="Permalink to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"input-data.txt"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">"[["</span> <span class="o">+</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"]]</span><span class="se">\n</span><span class="s2">"</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
<span class="nv">HDFSCLI_CONFIG</span><span class="o">=</span>./hdfscli.cfg<span class="w"> </span>hdfscli<span class="w"> </span>upload<span class="w"> </span>input-data.txt<span class="w"> </span>/batch-data/input-data.txt
</pre></div>
</div>
</div>
</section>
<section id="Prepare-HDFS-config-/-client-image">
<h2 id="Prepare-HDFS-config-/-client-image">Prepare HDFS config / client image<a class="headerlink" href="#Prepare-HDFS-config-/-client-image" title="Permalink to this heading">¶</a></h2>
<p>For connecting to the <code class="docutils literal notranslate"><span class="pre">hdfs</span></code> from inside the cluster we will use the same <code class="docutils literal notranslate"><span class="pre">hdfscli</span></code> tool as we used above to put data in there.</p>
<p>We will configure <code class="docutils literal notranslate"><span class="pre">hdfscli</span></code> using <code class="docutils literal notranslate"><span class="pre">hdfscli.cfg</span></code> file stored inside kubernetes secret:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> hdfs-config.yaml
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">seldon</span><span class="o">-</span><span class="n">hdfscli</span><span class="o">-</span><span class="n">secret</span><span class="o">-</span><span class="n">file</span>
<span class="nb">type</span><span class="p">:</span> <span class="n">Opaque</span>
<span class="n">stringData</span><span class="p">:</span>
  <span class="n">hdfscli</span><span class="o">.</span><span class="n">cfg</span><span class="p">:</span> <span class="o">|</span>
    <span class="p">[</span><span class="k">global</span><span class="p">]</span>
    <span class="n">default</span><span class="o">.</span><span class="n">alias</span> <span class="o">=</span> <span class="n">batch</span>

    <span class="p">[</span><span class="n">batch</span><span class="o">.</span><span class="n">alias</span><span class="p">]</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">hdfs</span><span class="o">-</span><span class="n">httpfs</span><span class="o">.</span><span class="n">hdfs</span><span class="o">-</span><span class="n">system</span><span class="o">.</span><span class="n">svc</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">local</span><span class="p">:</span><span class="mi">14000</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">hdfs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overwriting hdfs-config.yaml
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>hdfs-config.yaml
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
secret/seldon-hdfscli-secret-file configured
</pre></div></div>
</div>
<p>For the client image we will use a following minimal Dockerfile</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> Dockerfile
<span class="n">FROM</span> <span class="n">python</span><span class="p">:</span><span class="mf">3.8</span>
<span class="n">RUN</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">hdfs</span><span class="o">==</span><span class="mf">2.5.8</span>
<span class="n">ENV</span> <span class="n">HDFSCLI_CONFIG</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hdfs</span><span class="o">/</span><span class="n">hdfscli</span><span class="o">.</span><span class="n">cfg</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overwriting Dockerfile
</pre></div></div>
</div>
<p>That is build and published as <code class="docutils literal notranslate"><span class="pre">seldonio/hdfscli:1.6.0-dev</span></code></p>
</section>
<section id="Create-Workflow">
<h2 id="Create-Workflow">Create Workflow<a class="headerlink" href="#Create-Workflow" title="Permalink to this heading">¶</a></h2>
<p>This simple workflow will consist of three stages: - download-input-data - process-batch-inputs - upload-output-data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> workflow.yaml
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">argoproj</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Workflow</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">sklearn</span><span class="o">-</span><span class="n">batch</span><span class="o">-</span><span class="n">job</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">seldon</span>

  <span class="n">labels</span><span class="p">:</span>
    <span class="n">deployment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="n">sklearn</span>
    <span class="n">deployment</span><span class="o">-</span><span class="n">kind</span><span class="p">:</span> <span class="n">SeldonDeployment</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">volumeClaimTemplates</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">metadata</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">seldon</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">pvc</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="n">seldon</span>
      <span class="n">ownerReferences</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">apiVersion</span><span class="p">:</span> <span class="n">argoproj</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1alpha1</span>
        <span class="n">blockOwnerDeletion</span><span class="p">:</span> <span class="n">true</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Workflow</span>
        <span class="n">name</span><span class="p">:</span> <span class="s1">'{{workflow.name}}'</span>
        <span class="n">uid</span><span class="p">:</span> <span class="s1">'{{workflow.uid}}'</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">accessModes</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">ReadWriteOnce</span>
      <span class="n">resources</span><span class="p">:</span>
        <span class="n">requests</span><span class="p">:</span>
          <span class="n">storage</span><span class="p">:</span> <span class="mi">1</span><span class="n">Gi</span>

  <span class="n">volumes</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">config</span>
    <span class="n">secret</span><span class="p">:</span>
      <span class="n">secretName</span><span class="p">:</span> <span class="n">seldon</span><span class="o">-</span><span class="n">hdfscli</span><span class="o">-</span><span class="n">secret</span><span class="o">-</span><span class="n">file</span>

  <span class="n">arguments</span><span class="p">:</span>
    <span class="n">parameters</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">batch_deployment_name</span>
      <span class="n">value</span><span class="p">:</span> <span class="n">sklearn</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">batch_namespace</span>
      <span class="n">value</span><span class="p">:</span> <span class="n">seldon</span>

    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">input_path</span>
      <span class="n">value</span><span class="p">:</span> <span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="nb">input</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">txt</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">output_path</span>
      <span class="n">value</span><span class="p">:</span> <span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">output</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="p">{{</span><span class="n">workflow</span><span class="o">.</span><span class="n">name</span><span class="p">}}</span><span class="o">.</span><span class="n">txt</span>

    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">batch_gateway_type</span>
      <span class="n">value</span><span class="p">:</span> <span class="n">istio</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">batch_gateway_endpoint</span>
      <span class="n">value</span><span class="p">:</span> <span class="n">istio</span><span class="o">-</span><span class="n">ingressgateway</span><span class="o">.</span><span class="n">istio</span><span class="o">-</span><span class="n">system</span><span class="o">.</span><span class="n">svc</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">local</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">batch_transport_protocol</span>
      <span class="n">value</span><span class="p">:</span> <span class="n">rest</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">workers</span>
      <span class="n">value</span><span class="p">:</span> <span class="s2">"10"</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">retries</span>
      <span class="n">value</span><span class="p">:</span> <span class="s2">"3"</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">data_type</span>
      <span class="n">value</span><span class="p">:</span> <span class="n">data</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">payload_type</span>
      <span class="n">value</span><span class="p">:</span> <span class="n">ndarray</span>

  <span class="n">entrypoint</span><span class="p">:</span> <span class="n">seldon</span><span class="o">-</span><span class="n">batch</span><span class="o">-</span><span class="n">process</span>

  <span class="n">templates</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">seldon</span><span class="o">-</span><span class="n">batch</span><span class="o">-</span><span class="n">process</span>
    <span class="n">steps</span><span class="p">:</span>
    <span class="o">-</span> <span class="o">-</span> <span class="n">arguments</span><span class="p">:</span> <span class="p">{}</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">download</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="n">data</span>
        <span class="n">template</span><span class="p">:</span> <span class="n">download</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="n">data</span>
    <span class="o">-</span> <span class="o">-</span> <span class="n">arguments</span><span class="p">:</span> <span class="p">{}</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">process</span><span class="o">-</span><span class="n">batch</span><span class="o">-</span><span class="n">inputs</span>
        <span class="n">template</span><span class="p">:</span> <span class="n">process</span><span class="o">-</span><span class="n">batch</span><span class="o">-</span><span class="n">inputs</span>
    <span class="o">-</span> <span class="o">-</span> <span class="n">arguments</span><span class="p">:</span> <span class="p">{}</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">upload</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">data</span>
        <span class="n">template</span><span class="p">:</span> <span class="n">upload</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">data</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">download</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="n">data</span>
    <span class="n">script</span><span class="p">:</span>
      <span class="n">image</span><span class="p">:</span> <span class="n">seldonio</span><span class="o">/</span><span class="n">hdfscli</span><span class="p">:</span><span class="mf">1.6.0</span><span class="o">-</span><span class="n">dev</span>
      <span class="n">volumeMounts</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">assets</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">seldon</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">pvc</span>

      <span class="o">-</span> <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hdfs</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">config</span>
        <span class="n">readOnly</span><span class="p">:</span> <span class="n">true</span>

      <span class="n">env</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">INPUT_DATA_PATH</span>
        <span class="n">value</span><span class="p">:</span> <span class="s1">'{{workflow.parameters.input_path}}'</span>

      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">HDFSCLI_CONFIG</span>
        <span class="n">value</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hdfs</span><span class="o">/</span><span class="n">hdfscli</span><span class="o">.</span><span class="n">cfg</span>

      <span class="n">command</span><span class="p">:</span> <span class="p">[</span><span class="n">sh</span><span class="p">]</span>
      <span class="n">source</span><span class="p">:</span> <span class="o">|</span>
        <span class="n">hdfscli</span> <span class="n">download</span> <span class="err">$</span><span class="p">{</span><span class="n">INPUT_DATA_PATH</span><span class="p">}</span> <span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="nb">input</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">txt</span>

  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">process</span><span class="o">-</span><span class="n">batch</span><span class="o">-</span><span class="n">inputs</span>
    <span class="n">container</span><span class="p">:</span>
      <span class="n">image</span><span class="p">:</span> <span class="n">seldonio</span><span class="o">/</span><span class="n">seldon</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">s2i</span><span class="o">-</span><span class="n">python37</span><span class="p">:</span><span class="mf">1.14.0</span>

      <span class="n">volumeMounts</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">assets</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">seldon</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">pvc</span>

      <span class="n">env</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">SELDON_BATCH_DEPLOYMENT_NAME</span>
        <span class="n">value</span><span class="p">:</span> <span class="s1">'{{workflow.parameters.batch_deployment_name}}'</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">SELDON_BATCH_NAMESPACE</span>
        <span class="n">value</span><span class="p">:</span> <span class="s1">'{{workflow.parameters.batch_namespace}}'</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">SELDON_BATCH_GATEWAY_TYPE</span>
        <span class="n">value</span><span class="p">:</span> <span class="s1">'{{workflow.parameters.batch_gateway_type}}'</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">SELDON_BATCH_HOST</span>
        <span class="n">value</span><span class="p">:</span> <span class="s1">'{{workflow.parameters.batch_gateway_endpoint}}'</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">SELDON_BATCH_TRANSPORT</span>
        <span class="n">value</span><span class="p">:</span> <span class="s1">'{{workflow.parameters.batch_transport_protocol}}'</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">SELDON_BATCH_DATA_TYPE</span>
        <span class="n">value</span><span class="p">:</span> <span class="s1">'{{workflow.parameters.data_type}}'</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">SELDON_BATCH_PAYLOAD_TYPE</span>
        <span class="n">value</span><span class="p">:</span> <span class="s1">'{{workflow.parameters.payload_type}}'</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">SELDON_BATCH_WORKERS</span>
        <span class="n">value</span><span class="p">:</span> <span class="s1">'{{workflow.parameters.workers}}'</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">SELDON_BATCH_RETRIES</span>
        <span class="n">value</span><span class="p">:</span> <span class="s1">'{{workflow.parameters.retries}}'</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">SELDON_BATCH_INPUT_DATA_PATH</span>
        <span class="n">value</span><span class="p">:</span> <span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="nb">input</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">txt</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">SELDON_BATCH_OUTPUT_DATA_PATH</span>
        <span class="n">value</span><span class="p">:</span> <span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">output</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">txt</span>

      <span class="n">command</span><span class="p">:</span> <span class="p">[</span><span class="n">seldon</span><span class="o">-</span><span class="n">batch</span><span class="o">-</span><span class="n">processor</span><span class="p">]</span>
      <span class="n">args</span><span class="p">:</span> <span class="p">[</span><span class="o">--</span><span class="n">benchmark</span><span class="p">]</span>


  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">upload</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">data</span>
    <span class="n">script</span><span class="p">:</span>
      <span class="n">image</span><span class="p">:</span> <span class="n">seldonio</span><span class="o">/</span><span class="n">hdfscli</span><span class="p">:</span><span class="mf">1.6.0</span><span class="o">-</span><span class="n">dev</span>
      <span class="n">volumeMounts</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">assets</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">seldon</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">pvc</span>

      <span class="o">-</span> <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hdfs</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">config</span>
        <span class="n">readOnly</span><span class="p">:</span> <span class="n">true</span>

      <span class="n">env</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">OUTPUT_DATA_PATH</span>
        <span class="n">value</span><span class="p">:</span> <span class="s1">'{{workflow.parameters.output_path}}'</span>

      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">HDFSCLI_CONFIG</span>
        <span class="n">value</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hdfs</span><span class="o">/</span><span class="n">hdfscli</span><span class="o">.</span><span class="n">cfg</span>

      <span class="n">command</span><span class="p">:</span> <span class="p">[</span><span class="n">sh</span><span class="p">]</span>
      <span class="n">source</span><span class="p">:</span> <span class="o">|</span>
        <span class="n">hdfscli</span> <span class="n">upload</span> <span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">output</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">txt</span> <span class="err">$</span><span class="p">{</span><span class="n">OUTPUT_DATA_PATH</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overwriting workflow.yaml
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>argo<span class="w"> </span>submit<span class="w"> </span>--serviceaccount<span class="w"> </span>workflow<span class="w"> </span>workflow.yaml
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Name:                sklearn-batch-job
Namespace:           seldon
ServiceAccount:      workflow
Status:              Pending
Created:             Thu Jan 14 18:36:52 +0000 (now)
Progress:
Parameters:
  batch_deployment_name: sklearn
  batch_namespace:   seldon
  input_path:        /batch-data/input-data.txt
  output_path:       /batch-data/output-data-{{workflow.name}}.txt
  batch_gateway_type: istio
  batch_gateway_endpoint: istio-ingressgateway.istio-system.svc.cluster.local
  batch_transport_protocol: rest
  workers:           10
  retries:           3
  data_type:         data
  payload_type:      ndarray
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>argo<span class="w"> </span>list
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
NAME                STATUS    AGE   DURATION   PRIORITY
sklearn-batch-job   Running   1s    1s         0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>argo<span class="w"> </span>get<span class="w"> </span>sklearn-batch-job
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Name:                sklearn-batch-job
Namespace:           seldon
ServiceAccount:      workflow
Status:              Running
Created:             Thu Jan 14 18:36:52 +0000 (39 seconds ago)
Started:             Thu Jan 14 18:36:52 +0000 (39 seconds ago)
Duration:            39 seconds
Progress:            1/2
ResourcesDuration:   1s*(100Mi memory),1s*(1 cpu)
Parameters:
  batch_deployment_name: sklearn
  batch_namespace:   seldon
  input_path:        /batch-data/input-data.txt
  output_path:       /batch-data/output-data-{{workflow.name}}.txt
  batch_gateway_type: istio
  batch_gateway_endpoint: istio-ingressgateway.istio-system.svc.cluster.local
  batch_transport_protocol: rest
  workers:           10
  retries:           3
  data_type:         data
  payload_type:      ndarray

STEP                         TEMPLATE              PODNAME                       DURATION  MESSAGE
 <span class="ansi-cyan-fg">●</span> sklearn-batch-job         seldon-batch-process
 ├───<span class="ansi-green-fg">✔</span> download-input-data   download-input-data   sklearn-batch-job-2227322232  6s
 └───<span class="ansi-cyan-fg">●</span> process-batch-inputs  process-batch-inputs  sklearn-batch-job-2877616693  29s
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[75]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>argo<span class="w"> </span>logs<span class="w"> </span>sklearn-batch-job
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:05,000 - batch_processor.py:167 - INFO:  Processed instances: 100</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:05,417 - batch_processor.py:167 - INFO:  Processed instances: 200</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:06,213 - batch_processor.py:167 - INFO:  Processed instances: 300</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:06,642 - batch_processor.py:167 - INFO:  Processed instances: 400</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:06,974 - batch_processor.py:167 - INFO:  Processed instances: 500</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:07,278 - batch_processor.py:167 - INFO:  Processed instances: 600</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:07,628 - batch_processor.py:167 - INFO:  Processed instances: 700</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:08,378 - batch_processor.py:167 - INFO:  Processed instances: 800</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:09,003 - batch_processor.py:167 - INFO:  Processed instances: 900</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:09,337 - batch_processor.py:167 - INFO:  Processed instances: 1000</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:09,697 - batch_processor.py:167 - INFO:  Processed instances: 1100</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:10,014 - batch_processor.py:167 - INFO:  Processed instances: 1200</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:10,349 - batch_processor.py:167 - INFO:  Processed instances: 1300</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:10,843 - batch_processor.py:167 - INFO:  Processed instances: 1400</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:11,207 - batch_processor.py:167 - INFO:  Processed instances: 1500</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:11,562 - batch_processor.py:167 - INFO:  Processed instances: 1600</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:11,975 - batch_processor.py:167 - INFO:  Processed instances: 1700</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:12,350 - batch_processor.py:167 - INFO:  Processed instances: 1800</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:12,783 - batch_processor.py:167 - INFO:  Processed instances: 1900</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:13,139 - batch_processor.py:167 - INFO:  Processed instances: 2000</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:13,563 - batch_processor.py:167 - INFO:  Processed instances: 2100</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:13,928 - batch_processor.py:167 - INFO:  Processed instances: 2200</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:14,352 - batch_processor.py:167 - INFO:  Processed instances: 2300</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:14,699 - batch_processor.py:167 - INFO:  Processed instances: 2400</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:15,042 - batch_processor.py:167 - INFO:  Processed instances: 2500</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:15,701 - batch_processor.py:167 - INFO:  Processed instances: 2600</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:16,124 - batch_processor.py:167 - INFO:  Processed instances: 2700</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:16,748 - batch_processor.py:167 - INFO:  Processed instances: 2800</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:17,300 - batch_processor.py:167 - INFO:  Processed instances: 2900</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:17,904 - batch_processor.py:167 - INFO:  Processed instances: 3000</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:18,454 - batch_processor.py:167 - INFO:  Processed instances: 3100</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:18,823 - batch_processor.py:167 - INFO:  Processed instances: 3200</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:19,236 - batch_processor.py:167 - INFO:  Processed instances: 3300</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:19,586 - batch_processor.py:167 - INFO:  Processed instances: 3400</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:20,317 - batch_processor.py:167 - INFO:  Processed instances: 3500</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:20,948 - batch_processor.py:167 - INFO:  Processed instances: 3600</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:21,356 - batch_processor.py:167 - INFO:  Processed instances: 3700</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:21,851 - batch_processor.py:167 - INFO:  Processed instances: 3800</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:22,205 - batch_processor.py:167 - INFO:  Processed instances: 3900</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:22,553 - batch_processor.py:167 - INFO:  Processed instances: 4000</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:23,051 - batch_processor.py:167 - INFO:  Processed instances: 4100</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:23,557 - batch_processor.py:167 - INFO:  Processed instances: 4200</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:24,016 - batch_processor.py:167 - INFO:  Processed instances: 4300</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:24,350 - batch_processor.py:167 - INFO:  Processed instances: 4400</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:24,883 - batch_processor.py:167 - INFO:  Processed instances: 4500</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:25,295 - batch_processor.py:167 - INFO:  Processed instances: 4600</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:25,669 - batch_processor.py:167 - INFO:  Processed instances: 4700</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:26,055 - batch_processor.py:167 - INFO:  Processed instances: 4800</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:26,795 - batch_processor.py:167 - INFO:  Processed instances: 4900</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:27,462 - batch_processor.py:167 - INFO:  Processed instances: 5000</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:27,887 - batch_processor.py:167 - INFO:  Processed instances: 5100</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:28,332 - batch_processor.py:167 - INFO:  Processed instances: 5200</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:28,742 - batch_processor.py:167 - INFO:  Processed instances: 5300</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:29,069 - batch_processor.py:167 - INFO:  Processed instances: 5400</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:29,443 - batch_processor.py:167 - INFO:  Processed instances: 5500</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:29,840 - batch_processor.py:167 - INFO:  Processed instances: 5600</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:30,235 - batch_processor.py:167 - INFO:  Processed instances: 5700</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:30,578 - batch_processor.py:167 - INFO:  Processed instances: 5800</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:31,024 - batch_processor.py:167 - INFO:  Processed instances: 5900</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:31,381 - batch_processor.py:167 - INFO:  Processed instances: 6000</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:31,847 - batch_processor.py:167 - INFO:  Processed instances: 6100</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:32,239 - batch_processor.py:167 - INFO:  Processed instances: 6200</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:32,603 - batch_processor.py:167 - INFO:  Processed instances: 6300</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:33,080 - batch_processor.py:167 - INFO:  Processed instances: 6400</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:33,567 - batch_processor.py:167 - INFO:  Processed instances: 6500</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:34,043 - batch_processor.py:167 - INFO:  Processed instances: 6600</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:34,444 - batch_processor.py:167 - INFO:  Processed instances: 6700</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:34,812 - batch_processor.py:167 - INFO:  Processed instances: 6800</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:35,148 - batch_processor.py:167 - INFO:  Processed instances: 6900</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:35,519 - batch_processor.py:167 - INFO:  Processed instances: 7000</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:35,873 - batch_processor.py:167 - INFO:  Processed instances: 7100</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:36,278 - batch_processor.py:167 - INFO:  Processed instances: 7200</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:36,694 - batch_processor.py:167 - INFO:  Processed instances: 7300</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:37,061 - batch_processor.py:167 - INFO:  Processed instances: 7400</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:37,509 - batch_processor.py:167 - INFO:  Processed instances: 7500</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:37,865 - batch_processor.py:167 - INFO:  Processed instances: 7600</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:38,211 - batch_processor.py:167 - INFO:  Processed instances: 7700</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:38,590 - batch_processor.py:167 - INFO:  Processed instances: 7800</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:39,028 - batch_processor.py:167 - INFO:  Processed instances: 7900</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:39,419 - batch_processor.py:167 - INFO:  Processed instances: 8000</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:39,910 - batch_processor.py:167 - INFO:  Processed instances: 8100</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:40,532 - batch_processor.py:167 - INFO:  Processed instances: 8200</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:41,022 - batch_processor.py:167 - INFO:  Processed instances: 8300</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:41,436 - batch_processor.py:167 - INFO:  Processed instances: 8400</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:41,800 - batch_processor.py:167 - INFO:  Processed instances: 8500</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:42,238 - batch_processor.py:167 - INFO:  Processed instances: 8600</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:42,704 - batch_processor.py:167 - INFO:  Processed instances: 8700</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:43,079 - batch_processor.py:167 - INFO:  Processed instances: 8800</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:43,712 - batch_processor.py:167 - INFO:  Processed instances: 8900</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:44,075 - batch_processor.py:167 - INFO:  Processed instances: 9000</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:44,459 - batch_processor.py:167 - INFO:  Processed instances: 9100</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:44,806 - batch_processor.py:167 - INFO:  Processed instances: 9200</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:45,344 - batch_processor.py:167 - INFO:  Processed instances: 9300</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:45,764 - batch_processor.py:167 - INFO:  Processed instances: 9400</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:46,110 - batch_processor.py:167 - INFO:  Processed instances: 9500</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:46,547 - batch_processor.py:167 - INFO:  Processed instances: 9600</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:46,987 - batch_processor.py:167 - INFO:  Processed instances: 9700</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:47,371 - batch_processor.py:167 - INFO:  Processed instances: 9800</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:47,905 - batch_processor.py:167 - INFO:  Processed instances: 9900</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:48,289 - batch_processor.py:167 - INFO:  Processed instances: 10000</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:48,290 - batch_processor.py:168 - INFO:  Total processed instances: 10000</span>
<span class="ansi-magenta-fg">sklearn-batch-job-2877616693: 2021-01-14 18:37:48,290 - batch_processor.py:116 - INFO:  Elapsed time: 43.7087140083313</span>
</pre></div></div>
</div>
</section>
<section id="Pull-output-data-from-hdfs">
<h2 id="Pull-output-data-from-hdfs">Pull output-data from hdfs<a class="headerlink" href="#Pull-output-data-from-hdfs" title="Permalink to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
<span class="nv">HDFSCLI_CONFIG</span><span class="o">=</span>./hdfscli.cfg<span class="w"> </span>hdfscli<span class="w"> </span>download<span class="w"> </span>/batch-data/output-data-sklearn-batch-job.txt<span class="w"> </span>output-data.txt
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[78]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>head<span class="w"> </span>output-data.txt
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{"data": {"names": ["t:0", "t:1", "t:2"], "ndarray": [[0.49551509682202705, 0.4192462053867995, 0.08523869779117352]]}, "meta": {"requestPath": {"classifier": "seldonio/sklearnserver:1.6.0-dev"}, "tags": {"tags": {"batch_id": "409a3f56-5697-11eb-be58-06ee7f9820ec", "batch_index": 0.0, "batch_instance_id": "409ad222-5697-11eb-90de-06ee7f9820ec"}}}}
{"data": {"names": ["t:0", "t:1", "t:2"], "ndarray": [[0.14889581912569078, 0.40048258722097885, 0.45062159365333043]]}, "meta": {"requestPath": {"classifier": "seldonio/sklearnserver:1.6.0-dev"}, "tags": {"tags": {"batch_id": "409a3f56-5697-11eb-be58-06ee7f9820ec", "batch_index": 10.0, "batch_instance_id": "409d56e6-5697-11eb-90de-06ee7f9820ec"}}}}
{"data": {"names": ["t:0", "t:1", "t:2"], "ndarray": [[0.1859090109477526, 0.46433848375587844, 0.349752505296369]]}, "meta": {"requestPath": {"classifier": "seldonio/sklearnserver:1.6.0-dev"}, "tags": {"tags": {"batch_id": "409a3f56-5697-11eb-be58-06ee7f9820ec", "batch_index": 1.0, "batch_instance_id": "409ad68c-5697-11eb-90de-06ee7f9820ec"}}}}
{"data": {"names": ["t:0", "t:1", "t:2"], "ndarray": [[0.35453094061556073, 0.3866773326679568, 0.2587917267164825]]}, "meta": {"requestPath": {"classifier": "seldonio/sklearnserver:1.6.0-dev"}, "tags": {"tags": {"batch_id": "409a3f56-5697-11eb-be58-06ee7f9820ec", "batch_index": 3.0, "batch_instance_id": "409bb106-5697-11eb-90de-06ee7f9820ec"}}}}
{"data": {"names": ["t:0", "t:1", "t:2"], "ndarray": [[0.14218706541271167, 0.2726759160836421, 0.5851370185036463]]}, "meta": {"requestPath": {"classifier": "seldonio/sklearnserver:1.6.0-dev"}, "tags": {"tags": {"batch_id": "409a3f56-5697-11eb-be58-06ee7f9820ec", "batch_index": 13.0, "batch_instance_id": "409dabc8-5697-11eb-90de-06ee7f9820ec"}}}}
{"data": {"names": ["t:0", "t:1", "t:2"], "ndarray": [[0.15720251854631545, 0.3840752321558323, 0.45872224929785227]]}, "meta": {"requestPath": {"classifier": "seldonio/sklearnserver:1.6.0-dev"}, "tags": {"tags": {"batch_id": "409a3f56-5697-11eb-be58-06ee7f9820ec", "batch_index": 2.0, "batch_instance_id": "409b7362-5697-11eb-90de-06ee7f9820ec"}}}}
{"data": {"names": ["t:0", "t:1", "t:2"], "ndarray": [[0.1808891729172985, 0.32704139903027096, 0.49206942805243054]]}, "meta": {"requestPath": {"classifier": "seldonio/sklearnserver:1.6.0-dev"}, "tags": {"tags": {"batch_id": "409a3f56-5697-11eb-be58-06ee7f9820ec", "batch_index": 14.0, "batch_instance_id": "409dac86-5697-11eb-90de-06ee7f9820ec"}}}}
{"data": {"names": ["t:0", "t:1", "t:2"], "ndarray": [[0.14218974549047703, 0.41059890080264444, 0.4472113537068785]]}, "meta": {"requestPath": {"classifier": "seldonio/sklearnserver:1.6.0-dev"}, "tags": {"tags": {"batch_id": "409a3f56-5697-11eb-be58-06ee7f9820ec", "batch_index": 15.0, "batch_instance_id": "409de20a-5697-11eb-90de-06ee7f9820ec"}}}}
{"data": {"names": ["t:0", "t:1", "t:2"], "ndarray": [[0.2643002677975754, 0.44720843507174224, 0.28849129713068233]]}, "meta": {"requestPath": {"classifier": "seldonio/sklearnserver:1.6.0-dev"}, "tags": {"tags": {"batch_id": "409a3f56-5697-11eb-be58-06ee7f9820ec", "batch_index": 16.0, "batch_instance_id": "409dfe98-5697-11eb-90de-06ee7f9820ec"}}}}
{"data": {"names": ["t:0", "t:1", "t:2"], "ndarray": [[0.2975075875929912, 0.25439317776178244, 0.44809923464522644]]}, "meta": {"requestPath": {"classifier": "seldonio/sklearnserver:1.6.0-dev"}, "tags": {"tags": {"batch_id": "409a3f56-5697-11eb-be58-06ee7f9820ec", "batch_index": 4.0, "batch_instance_id": "409c3a2c-5697-11eb-90de-06ee7f9820ec"}}}}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>deployment.yaml
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
seldondeployment.machinelearning.seldon.io "sklearn" deleted
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[80]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>argo<span class="w"> </span>delete<span class="w"> </span>sklearn-batch-job
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Workflow 'sklearn-batch-job' deleted
</pre></div></div>
</div>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="argo_workflows_batch.html" title="Batch processing with Argo Worfklows"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> "Previous" </span> Batch processing with Argo Worfklows </span>
              </div>
            </a>
          
          
            <a href="kubeflow_pipelines_batch.html" title="Batch processing with Kubeflow Pipelines"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> "Next" </span> Batch processing with Kubeflow Pipelines </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2024, Seldon Technologies Ltd.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>