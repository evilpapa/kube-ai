<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-54780881-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'UA-54780881-2');
</script>
  
  
    <title>MLFlow Pre-packaged Model Server AB Test Deployment &#8212; seldon-core  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=83e35b93" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/rtd_sphinx_search.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=15a8f09d" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/rtd_search_config.js"></script>
    <script src="../_static/js/rtd_sphinx_search.min.js"></script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MLflow v2 protocol elasticnet wine example" href="mlflow_v2_protocol_end_to_end.html" />
    <link rel="prev" title="Install MinIO in cluster" href="minio_setup.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=teal>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#examples/mlflow_server_ab_test_ambassador" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="seldon-core  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Seldon Core Documentation</span>
          <span class="md-header-nav__topic"> MLFlow Pre-packaged Model Server AB Test Deployment </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/SeldonIO/seldon-core/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Seldon Core
  </div>
</a>
          </div>
        </div>
      
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="/" class="md-tabs__link">🚀 Our Other Projects & Products:</a></li>
            
            <li class="md-tabs__item"><a href="https://docs.seldon.io/projects/alibi/en/stable/" class="md-tabs__link">Alibi Explain</a></li>
            
            <li class="md-tabs__item"><a href="https://docs.seldon.io/projects/alibi-detect/en/stable/" class="md-tabs__link">Alibi Detect</a></li>
            
            <li class="md-tabs__item"><a href="https://mlserver.readthedocs.io/en/latest/" class="md-tabs__link">MLServer</a></li>
            
            <li class="md-tabs__item"><a href="https://tempo.readthedocs.io/en/latest/" class="md-tabs__link">Tempo SDK</a></li>
            
            <li class="md-tabs__item"><a href="https://deploy.seldon.io" class="md-tabs__link">Seldon Enterprise Platform</a></li>
            
            <li class="md-tabs__item"><a href="https://github.com/SeldonIO/seldon-deploy-sdk#seldon-deploy-sdk" class="md-tabs__link">Seldon Enterprise Platform SDK</a></li>
          <li class="md-tabs__item"><a href="../nav/tutorials.html" class="md-tabs__link">教程</a></li>
          <li class="md-tabs__item"><a href="notebooks.html" class="md-tabs__link">笔记本</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="seldon-core documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="seldon-core documentation">Seldon Core Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/SeldonIO/seldon-core/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Seldon Core
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../nav/getting-started.html" class="md-nav__link">开始</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/concepts.html" class="md-nav__link">概念</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/configuration.html" class="md-nav__link">配置</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/tutorials.html" class="md-nav__link">教程</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="notebooks.html" class="md-nav__link">笔记本</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#seldon-core" class="md-nav__link">Seldon Core 设置</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id2" class="md-nav__link">预包装推理服务示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#python" class="md-nav__link">Python 语言封装示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id3" class="md-nav__link">专门的框架示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id4" class="md-nav__link">孵化项目示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id5" class="md-nav__link">基于云的基础示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id6" class="md-nav__link">高级机器学习监控</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id7" class="md-nav__link">Seldon Core 批处理</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#mlops" class="md-nav__link">MLOps: 扩展、监控和可观察性</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id8" class="md-nav__link">生产配置及实现</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#ab" class="md-nav__link">AB 测试及渐进式部署</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id9" class="md-nav__link">复杂图示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id10" class="md-nav__link">入口</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id11" class="md-nav__link">基础设施</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id12" class="md-nav__link">基准测试和负载测试</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id13" class="md-nav__link">升级示例</a>
      
    
    </li></ul>
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/reference.html" class="md-nav__link">参考</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/contributing.html" class="md-nav__link">贡献</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#examples-mlflow-server-ab-test-ambassador--page-root" class="md-nav__link">MLFlow Pre-packaged Model Server AB Test Deployment</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Tutorial-Overview" class="md-nav__link">Tutorial Overview</a>
        </li>
        <li class="md-nav__item"><a href="#Dependencies" class="md-nav__link">Dependencies</a>
        </li>
        <li class="md-nav__item"><a href="#1.-Train-the-first-MLFlow-Elastic-Net-Wine-example" class="md-nav__link">1. Train the first MLFlow Elastic Net Wine example</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#MLproject" class="md-nav__link">MLproject</a>
        </li>
        <li class="md-nav__item"><a href="#Dataset" class="md-nav__link">Dataset</a>
        </li>
        <li class="md-nav__item"><a href="#Training" class="md-nav__link">Training</a>
        </li>
        <li class="md-nav__item"><a href="#MLmodel" class="md-nav__link">MLmodel</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#2.-Deploy-your-model-using-the-Pre-packaged-Moldel-Server-for-MLFlow" class="md-nav__link">2. Deploy your model using the Pre-packaged Moldel Server for MLFlow</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Setup-Seldon-Core" class="md-nav__link">Setup Seldon Core</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#3.-Test-the-deployed-MLFlow-model-by-sending-requests" class="md-nav__link">3. Test the deployed MLFlow model by sending requests</a>
        </li>
        <li class="md-nav__item"><a href="#4.-Deploy-your-second-model-as-an-A/B-test" class="md-nav__link">4. Deploy your second model as an A/B test</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#A/B-test" class="md-nav__link">A/B test</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#5.-Visualise-and-monitor-the-performance-of-your-models-using-Seldon-Analytics" class="md-nav__link">5. Visualise and monitor the performance of your models using Seldon Analytics</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/examples/mlflow_server_ab_test_ambassador.nblink.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <div class="admonition note">
<p>This page was generated from <a class="reference external" href="https://github.com/SeldonIO/seldon-core/blob/e665e4994eabf83fb43c68a5f85e96d5c45e91b5/examples/models/mlflow_server_ab_test_ambassador/mlflow_server_ab_test_ambassador.ipynb">examples/models/mlflow_server_ab_test_ambassador/mlflow_server_ab_test_ambassador.ipynb</a>.</p>
</div>
<section id="MLFlow-Pre-packaged-Model-Server-AB-Test-Deployment">
<h1 id="examples-mlflow-server-ab-test-ambassador--page-root">MLFlow Pre-packaged Model Server AB Test Deployment<a class="headerlink" href="#examples-mlflow-server-ab-test-ambassador--page-root" title="Permalink to this heading">¶</a></h1>
<p>In this example we will build two models with MLFlow and we will deploy them as an A/B test deployment. The reason this is powerful is because it allows you to deploy a new model next to the old one, distributing a percentage of traffic. These deployment strategies are quite simple using Seldon, and can be extended to shadow deployments, multi-armed-bandits, etc.</p>
<section id="Tutorial-Overview">
<h2 id="Tutorial-Overview">Tutorial Overview<a class="headerlink" href="#Tutorial-Overview" title="Permalink to this heading">¶</a></h2>
<p>This tutorial will follow closely break down in the following sections:</p>
<ol class="arabic simple">
<li><p>Train the MLFlow elastic net wine example</p></li>
<li><p>Deploy your trained model leveraging our pre-packaged MLFlow model server</p></li>
<li><p>Test the deployed MLFlow model by sending requests</p></li>
<li><p>Deploy your second model as an A/B test</p></li>
<li><p>Visualise and monitor the performance of your models using Seldon Analytics</p></li>
</ol>
<p>It will follow closely our talk at the <a class="reference external" href="https://www.youtube.com/watch?v=D6eSfd9w9eA">Spark + AI Summit 2019 on Seldon and MLflow</a>.</p>
</section>
<section id="Dependencies">
<h2 id="Dependencies">Dependencies<a class="headerlink" href="#Dependencies" title="Permalink to this heading">¶</a></h2>
<p>For this example to work you must be running Seldon 0.3.2 or above - you can follow our <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/workflow/install.html">getting started guide for this</a>.</p>
<p>In regards to other dependencies, make sure you have installed:</p>
<ul class="simple">
<li><p>Helm v3.0.0+</p></li>
<li><p>kubectl v1.14+</p></li>
<li><p>Python 3.6+</p></li>
<li><p>MLFlow 1.1.0</p></li>
<li><p><a class="reference external" href="https://pygments.org/docs/cmdline/">pygmentize</a></p></li>
</ul>
<p>We will also take this chance to load the Python dependencies we will use through the tutorial:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">seldon_core.seldon_client</span> <span class="kn">import</span> <span class="n">SeldonClient</span>
</pre></div>
</div>
</div>
<p>Let’s get started! 🚀🔥</p>
</section>
<section id="1.-Train-the-first-MLFlow-Elastic-Net-Wine-example">
<h2 id="1.-Train-the-first-MLFlow-Elastic-Net-Wine-example">1. Train the first MLFlow Elastic Net Wine example<a class="headerlink" href="#1.-Train-the-first-MLFlow-Elastic-Net-Wine-example" title="Permalink to this heading">¶</a></h2>
<p>For our example, we will use the elastic net wine example from <a class="reference external" href="https://github.com/mlflow/mlflow/tree/master/examples/sklearn_elasticnet_wine">MLflow’s tutorial</a>.</p>
<section id="MLproject">
<h3 id="MLproject">MLproject<a class="headerlink" href="#MLproject" title="Permalink to this heading">¶</a></h3>
<p>As any other MLflow project, it is defined by its <code class="docutils literal notranslate"><span class="pre">MLproject</span></code> file:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pygmentize<span class="w"> </span>-l<span class="w"> </span>yaml<span class="w"> </span>MLproject
</pre></div>
</div>
</div>
<p>We can see that this project uses Conda for the environment and that it’s defined in the <code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code> file:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pygmentize<span class="w"> </span>conda.yaml
</pre></div>
</div>
</div>
<p>Lastly, we can also see that the training will be performed by the <code class="docutils literal notranslate"><span class="pre">train.py</span></code> file, which receives two parameters <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">l1_ratio</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pygmentize<span class="w"> </span>train.py
</pre></div>
</div>
</div>
</section>
<section id="Dataset">
<h3 id="Dataset">Dataset<a class="headerlink" href="#Dataset" title="Permalink to this heading">¶</a></h3>
<p>We will use the wine quality dataset. Let’s load it to see what’s inside:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"wine-quality.csv"</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Training">
<h3 id="Training">Training<a class="headerlink" href="#Training" title="Permalink to this heading">¶</a></h3>
<p>We’ve set up our MLflow project and our dataset is ready, so we are now good to start training. MLflow allows us to train our model with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mlflow<span class="w"> </span>run<span class="w"> </span>.<span class="w"> </span>-P<span class="w"> </span><span class="nv">alpha</span><span class="o">=</span>...<span class="w"> </span>-P<span class="w"> </span><span class="nv">l1_ratio</span><span class="o">=</span>...
</pre></div>
</div>
<p>On each run, <code class="docutils literal notranslate"><span class="pre">mlflow</span></code> will set up the Conda environment defined by the <code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code> file and will run the training commands defined in the <code class="docutils literal notranslate"><span class="pre">MLproject</span></code> file.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mlflow<span class="w"> </span>run<span class="w"> </span>.<span class="w"> </span>-P<span class="w"> </span><span class="nv">alpha</span><span class="o">=</span><span class="m">0</span>.5<span class="w"> </span>-P<span class="w"> </span><span class="nv">l1_ratio</span><span class="o">=</span><span class="m">0</span>.5
</pre></div>
</div>
</div>
<p>Each of these commands will create a new run which can be visualised through the MLFlow dashboard as per the screenshot below.</p>
<p><img alt="mlflow-dashboard" src="../_images/mlflow-dashboard.png"/></p>
<p>Each of these models can actually be found on the <code class="docutils literal notranslate"><span class="pre">mlruns</span></code> folder:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tree<span class="w"> </span>-L<span class="w"> </span><span class="m">1</span><span class="w"> </span>mlruns/0
</pre></div>
</div>
</div>
</section>
<section id="MLmodel">
<h3 id="MLmodel">MLmodel<a class="headerlink" href="#MLmodel" title="Permalink to this heading">¶</a></h3>
<p>Inside each of these folders, MLflow stores the parameters we used to train our model, any metric we logged during training, and a snapshot of our model. If we look into one of them, we can see the following structure:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tree<span class="w"> </span>mlruns/0/<span class="k">$(</span>ls<span class="w"> </span>mlruns/0<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>
</pre></div>
</div>
</div>
<p>In particular, we are interested in the <code class="docutils literal notranslate"><span class="pre">MLmodel</span></code> file stored under <code class="docutils literal notranslate"><span class="pre">artifacts/model</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pygmentize<span class="w"> </span>-l<span class="w"> </span>yaml<span class="w"> </span>mlruns/0/<span class="k">$(</span>ls<span class="w"> </span>mlruns/0<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>/artifacts/model/MLmodel
</pre></div>
</div>
</div>
<p>This file stores the details of how the model was stored. With this information (plus the other files in the folder), we are able to load the model back. Seldon’s MLflow server will use this information to serve this model.</p>
<p>Now we should upload our newly trained model into a public Google Bucket or S3 bucket. We have already done this to make it simpler, which you will be able to find at <code class="docutils literal notranslate"><span class="pre">gs://seldon-models/mlflow/model-a</span></code>.</p>
</section>
</section>
<section id="2.-Deploy-your-model-using-the-Pre-packaged-Moldel-Server-for-MLFlow">
<h2 id="2.-Deploy-your-model-using-the-Pre-packaged-Moldel-Server-for-MLFlow">2. Deploy your model using the Pre-packaged Moldel Server for MLFlow<a class="headerlink" href="#2.-Deploy-your-model-using-the-Pre-packaged-Moldel-Server-for-MLFlow" title="Permalink to this heading">¶</a></h2>
<p>Now we can deploy our trained MLFlow model.</p>
<p>For this we have to create a Seldon definition of the model server definition, which we will break down further below.</p>
<p>We will be using the model we updated to our google bucket (gs://seldon-models/mlflow/elasticnet_wine_1.8.0), but you can use your model if you uploaded it to a public bucket.</p>
<section id="Setup-Seldon-Core">
<h3 id="Setup-Seldon-Core">Setup Seldon Core<a class="headerlink" href="#Setup-Seldon-Core" title="Permalink to this heading">¶</a></h3>
<p>Use the setup notebook to <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/seldon_core_setup.html#Setup-Cluster">Setup Cluster</a> with <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/seldon_core_setup.html#Ambassador">Ambassador Ingress</a> and <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/seldon_core_setup.html#Install-Seldon-Core">Install Seldon Core</a>. Instructions <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/seldon_core_setup.html">also
online</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pygmentize<span class="w"> </span>mlflow-model-server-seldon-config.yaml
</pre></div>
</div>
</div>
<p>Once we write our configuration file, we are able to deploy it to our cluster by running it with our command</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>mlflow-model-server-seldon-config.yaml
</pre></div>
</div>
</div>
<p>Once it’s created we just wait until it’s deployed.</p>
<p>It will basically download the image for the pre-packaged MLFlow model server, and initialise it with the model we specified above.</p>
<p>You can check the status of the deployment with the following command:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>rollout<span class="w"> </span>status<span class="w"> </span>deployment.apps/mlflow-deployment-mlflow-deployment-dag-0-wines-classifier
</pre></div>
</div>
</div>
<p>Once it’s deployed, we should see a “succcessfully rolled out” message above. We can now test it!</p>
</section>
</section>
<section id="3.-Test-the-deployed-MLFlow-model-by-sending-requests">
<h2 id="3.-Test-the-deployed-MLFlow-model-by-sending-requests">3. Test the deployed MLFlow model by sending requests<a class="headerlink" href="#3.-Test-the-deployed-MLFlow-model-by-sending-requests" title="Permalink to this heading">¶</a></h2>
<p>Now that our model is deployed in Kubernetes, we are able to send any requests.</p>
<p>We will first need the URL that is currently available through Ambassador.</p>
<p>If you are running this locally, you should be able to reach it through localhost, in this case we can use port 80.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ambassador
</pre></div>
</div>
</div>
<p>Now we will select the first datapoint in our dataset to send to the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_0</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">"quality"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">x_0</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<p>We can try sending a request first using curl:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s1">'Content-Type: application/json'</span><span class="w"> </span><span class="err">\</span>
    <span class="o">-</span><span class="n">d</span> <span class="s1">'{"data": {"names": [], "ndarray": [[7.0, 0.27, 0.36, 20.7, 0.045, 45.0, 170.0, 1.001, 3.0, 0.45, 8.8]]}}'</span> \
    <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8003</span><span class="o">/</span><span class="n">seldon</span><span class="o">/</span><span class="n">seldon</span><span class="o">/</span><span class="n">mlflow</span><span class="o">-</span><span class="n">deployment</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v0</span><span class="mf">.1</span><span class="o">/</span><span class="n">predictions</span>
</pre></div>
</div>
</div>
<p>We can also send the request by using our python client</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">seldon_core.seldon_client</span> <span class="kn">import</span> <span class="n">SeldonClient</span>

<span class="n">HOST</span> <span class="o">=</span> <span class="s2">"localhost"</span>  <span class="c1"># Add the URL you found above</span>
<span class="n">port</span> <span class="o">=</span> <span class="s2">"80"</span>  <span class="c1"># Make sure you use the port above</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">x_0</span>
<span class="n">payload_type</span> <span class="o">=</span> <span class="s2">"ndarray"</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">SeldonClient</span><span class="p">(</span>
    <span class="n">gateway</span><span class="o">=</span><span class="s2">"ambassador"</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s2">"seldon"</span><span class="p">,</span> <span class="n">gateway_endpoint</span><span class="o">=</span><span class="n">HOST</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="n">port</span>
<span class="p">)</span>

<span class="n">client_prediction</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">batch</span><span class="p">,</span> <span class="n">deployment_name</span><span class="o">=</span><span class="s2">"mlflow-deployment"</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[],</span> <span class="n">payload_type</span><span class="o">=</span><span class="n">payload_type</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">client_prediction</span><span class="o">.</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="4.-Deploy-your-second-model-as-an-A/B-test">
<h2 id="4.-Deploy-your-second-model-as-an-A/B-test">4. Deploy your second model as an A/B test<a class="headerlink" href="#4.-Deploy-your-second-model-as-an-A/B-test" title="Permalink to this heading">¶</a></h2>
<p>Now that we have a model in production, it’s possible to deploy a second model as an A/B test. Our model will also be an Elastic Net model but using a different set of parameters. We can easily train it by leveraging MLflow:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mlflow<span class="w"> </span>run<span class="w"> </span>.<span class="w"> </span>-P<span class="w"> </span><span class="nv">alpha</span><span class="o">=</span><span class="m">0</span>.75<span class="w"> </span>-P<span class="w"> </span><span class="nv">l1_ratio</span><span class="o">=</span><span class="m">0</span>.2
</pre></div>
</div>
</div>
<p>As we did before, we will now need to upload our model to a cloud bucket. To speed things up, we already have done so and the second model is now accessible in <code class="docutils literal notranslate"><span class="pre">gs://seldon-models/mlflow/model-b</span></code>.</p>
<section id="A/B-test">
<h3 id="A/B-test">A/B test<a class="headerlink" href="#A/B-test" title="Permalink to this heading">¶</a></h3>
<p>We will deploy our second model as an A/B test. In particular, we will redirect 20% of the traffic to the new model.</p>
<p>This can be done by simply adding a <code class="docutils literal notranslate"><span class="pre">traffic</span></code> attribute on our <code class="docutils literal notranslate"><span class="pre">SeldonDeployment</span></code> spec:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pygmentize<span class="w"> </span>ab-test-mlflow-model-server-seldon-config.yaml
</pre></div>
</div>
</div>
<p>And similar to the model above, we only need to run the following to deploy it:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>ab-test-mlflow-model-server-seldon-config.yaml
</pre></div>
</div>
</div>
<p>We can check that the models have been deployed and are running with the following command.</p>
<p>We should now see the “a-” model and the “b-” models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>get<span class="w"> </span>pods
</pre></div>
</div>
</div>
</section>
</section>
<section id="5.-Visualise-and-monitor-the-performance-of-your-models-using-Seldon-Analytics">
<h2 id="5.-Visualise-and-monitor-the-performance-of-your-models-using-Seldon-Analytics">5. Visualise and monitor the performance of your models using Seldon Analytics<a class="headerlink" href="#5.-Visualise-and-monitor-the-performance-of-your-models-using-Seldon-Analytics" title="Permalink to this heading">¶</a></h2>
<p>This section is optional, but by following the instructions you will be able to visualise the performance of both models as per the chart below.</p>
<p>In order for this example to work you need to install and run the <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/analytics/analytics.html#helm-analytics-chart">Grafana Analytics package for Seldon Core</a>.</p>
<p>For this we can access the URL with the command below, it will request an admin and password which by default are set to the following: * Username: admin * Password: password</p>
<p>You can access the grafana dashboard through the port provided below:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>grafana-prom<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.spec.ports[0].nodePort}'</span>
</pre></div>
</div>
</div>
<p>Now that we have both models running in our Kubernetes cluster, we can analyse their performance using Seldon Core’s integration with Prometheus and Grafana. To do so, we will iterate over the training set (which can be found in <code class="docutils literal notranslate"><span class="pre">wine-quality.csv</span></code>), making a request and sending the feedback of the prediction.</p>
<p>Since the <code class="docutils literal notranslate"><span class="pre">/feedback</span></code> endpoint requires a <code class="docutils literal notranslate"><span class="pre">reward</span></code> signal (i.e. the higher the better), we will simulate one as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}R(x_{n})
  = \begin{cases}
      \frac{1}{(y_{n} - f(x_{n}))^{2}} &amp;, y_{n} \neq f(x_{n}) \\
      500 &amp;, y_{n} = f(x_{n})
    \end{cases}\end{split}\]</div>
<p>, where <span class="math notranslate nohighlight">\(R(x_{n})\)</span> is the reward for input point <span class="math notranslate nohighlight">\(x_{n}\)</span>, <span class="math notranslate nohighlight">\(f(x_{n})\)</span> is our trained model and <span class="math notranslate nohighlight">\(y_{n}\)</span> is the actual value.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span> <span class="o">=</span> <span class="n">SeldonClient</span><span class="p">(</span>
    <span class="n">gateway</span><span class="o">=</span><span class="s2">"ambassador"</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s2">"seldon"</span><span class="p">,</span> <span class="n">deployment_name</span><span class="o">=</span><span class="s2">"wines-classifier"</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_reward</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="n">y_pred</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">500</span>

    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_test_row</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">input_features</span> <span class="o">=</span> <span class="n">row</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">feature_names</span> <span class="o">=</span> <span class="n">input_features</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">input_features</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Note that we are re-using the SeldonClient defined previously</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">deployment_name</span><span class="o">=</span><span class="s2">"mlflow-deployment"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span>

    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="s2">"data"</span><span class="p">][</span><span class="s2">"tensor"</span><span class="p">][</span><span class="s2">"values"</span><span class="p">]</span>
    <span class="n">reward</span> <span class="o">=</span> <span class="n">_get_reward</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">feedback</span><span class="p">(</span>
        <span class="n">deployment_name</span><span class="o">=</span><span class="s2">"mlflow-deployment"</span><span class="p">,</span>
        <span class="n">prediction_request</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">request</span><span class="p">,</span>
        <span class="n">prediction_response</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">response</span><span class="p">,</span>
        <span class="n">reward</span><span class="o">=</span><span class="n">reward</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">reward</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">_test_row</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>You should now be able to see Seldon’s pre-built Grafana dashboard.</p>
<p><img alt="grafana-mlflow" src="../_images/grafana-mlflow.jpg"/></p>
<p>In bottom of the dashboard you can see the following charts:</p>
<ul class="simple">
<li><p>On the left: the requests per second, which shows the different traffic breakdown we specified.</p></li>
<li><p>On the center: the reward, where you can see how model <code class="docutils literal notranslate"><span class="pre">a</span></code> outperforms model <code class="docutils literal notranslate"><span class="pre">b</span></code> by a large margin.</p></li>
<li><p>On the right, the latency for each one of them.</p></li>
</ul>
<p>You are able to add your own custom metrics, and try out other more complex deployments by following further guides at <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/mlflow_server_ab_test_ambassador.html">https://docs.seldon.io/projects/seldon-core/en/latest/examples/mlflow_server_ab_test_ambassador.html</a></p>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="minio_setup.html" title="Install MinIO in cluster"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> "Previous" </span> Install MinIO in cluster </span>
              </div>
            </a>
          
          
            <a href="mlflow_v2_protocol_end_to_end.html" title="MLflow v2 protocol elasticnet wine example"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> "Next" </span> MLflow v2 protocol elasticnet wine example </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2024, Seldon Technologies Ltd.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>