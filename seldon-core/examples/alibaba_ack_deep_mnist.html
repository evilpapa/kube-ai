<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-54780881-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'UA-54780881-2');
</script>
  
  
    <title>Alibaba Cloud Container Service for Kubernetes (ACK) Deep MNIST Example &#8212; seldon-core  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=83e35b93" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/rtd_sphinx_search.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=15a8f09d" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/rtd_search_config.js"></script>
    <script src="../_static/js/rtd_sphinx_search.min.js"></script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pretrained GPT2 Model Deployment Example" href="triton_gpt2_example_azure.html" />
    <link rel="prev" title="Tensorflow GPU MNIST Model with GKE" href="gpu_tensorflow_deep_mnist.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=teal>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#examples/alibaba_ack_deep_mnist" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="seldon-core  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Seldon Core Documentation</span>
          <span class="md-header-nav__topic"> Alibaba Cloud Container Service for Kubernetes (ACK) Deep MNIST Example </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/SeldonIO/seldon-core/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Seldon Core
  </div>
</a>
          </div>
        </div>
      
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="/" class="md-tabs__link">🚀 Our Other Projects & Products:</a></li>
            
            <li class="md-tabs__item"><a href="https://docs.seldon.io/projects/alibi/en/stable/" class="md-tabs__link">Alibi Explain</a></li>
            
            <li class="md-tabs__item"><a href="https://docs.seldon.io/projects/alibi-detect/en/stable/" class="md-tabs__link">Alibi Detect</a></li>
            
            <li class="md-tabs__item"><a href="https://mlserver.readthedocs.io/en/latest/" class="md-tabs__link">MLServer</a></li>
            
            <li class="md-tabs__item"><a href="https://tempo.readthedocs.io/en/latest/" class="md-tabs__link">Tempo SDK</a></li>
            
            <li class="md-tabs__item"><a href="https://deploy.seldon.io" class="md-tabs__link">Seldon Enterprise Platform</a></li>
            
            <li class="md-tabs__item"><a href="https://github.com/SeldonIO/seldon-deploy-sdk#seldon-deploy-sdk" class="md-tabs__link">Seldon Enterprise Platform SDK</a></li>
          <li class="md-tabs__item"><a href="../nav/tutorials.html" class="md-tabs__link">教程</a></li>
          <li class="md-tabs__item"><a href="notebooks.html" class="md-tabs__link">笔记本</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="seldon-core documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="seldon-core documentation">Seldon Core Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/SeldonIO/seldon-core/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Seldon Core
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../nav/getting-started.html" class="md-nav__link">开始</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/concepts.html" class="md-nav__link">概念</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/configuration.html" class="md-nav__link">配置</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/tutorials.html" class="md-nav__link">教程</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="notebooks.html" class="md-nav__link">笔记本</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#seldon-core" class="md-nav__link">Seldon Core 设置</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id2" class="md-nav__link">预包装推理服务示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#python" class="md-nav__link">Python 语言封装示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id3" class="md-nav__link">专门的框架示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id4" class="md-nav__link">孵化项目示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id5" class="md-nav__link">基于云的基础示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id6" class="md-nav__link">高级机器学习监控</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id7" class="md-nav__link">Seldon Core 批处理</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#mlops" class="md-nav__link">MLOps: 扩展、监控和可观察性</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id8" class="md-nav__link">生产配置及实现</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#ab" class="md-nav__link">AB 测试及渐进式部署</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id9" class="md-nav__link">复杂图示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id10" class="md-nav__link">入口</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id11" class="md-nav__link">基础设施</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id12" class="md-nav__link">基准测试和负载测试</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id13" class="md-nav__link">升级示例</a>
      
    
    </li></ul>
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/reference.html" class="md-nav__link">参考</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/contributing.html" class="md-nav__link">贡献</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#examples-alibaba-ack-deep-mnist--page-root" class="md-nav__link">Alibaba Cloud Container Service for Kubernetes (ACK) Deep MNIST Example</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Dependencies:" class="md-nav__link">Dependencies:</a>
        </li>
        <li class="md-nav__item"><a href="#1)-Train-a-tensorflow-model-to-predict-mnist-locally" class="md-nav__link">1) Train a tensorflow model to predict mnist locally</a>
        </li>
        <li class="md-nav__item"><a href="#2)-Containerise-the-tensorflow-model-with-our-docker-utility" class="md-nav__link">2) Containerise the tensorflow model with our docker utility</a>
        </li>
        <li class="md-nav__item"><a href="#3)-Test-model-locally-with-docker" class="md-nav__link">3) Test model locally with docker</a>
        </li>
        <li class="md-nav__item"><a href="#4)-Set-up-and-configure-Alibaba-Cloud-environment" class="md-nav__link">4) Set-up and configure Alibaba Cloud environment</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#4.1-create-a-managed-kubernetes-cluster" class="md-nav__link">4.1 create a managed kubernetes cluster</a>
        </li>
        <li class="md-nav__item"><a href="#4.2-Copy-the-kubectl-configuration-to-access-the-cluster" class="md-nav__link">4.2 Copy the kubectl configuration to access the cluster</a>
        </li>
        <li class="md-nav__item"><a href="#4.3-Create-an-Alibaba-Container-Registry-to-push-the-image" class="md-nav__link">4.3 Create an Alibaba Container Registry to push the image</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#Setup-Seldon-Core" class="md-nav__link">Setup Seldon Core</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Finally-we-install-the-Seldon-Analytics-Package" class="md-nav__link">Finally we install the Seldon Analytics Package</a>
        </li>
        <li class="md-nav__item"><a href="#4.5-Push-docker-image" class="md-nav__link">4.5 Push docker image</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#To-push-the-image-we-first-tag-it" class="md-nav__link">To push the image we first tag it</a>
        </li>
        <li class="md-nav__item"><a href="#And-then-we-push-it" class="md-nav__link">And then we push it</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#5---Deploy-your-model-and-visualise-requests" class="md-nav__link">5 - Deploy your model and visualise requests</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Run-the-deployment-in-your-cluster" class="md-nav__link">Run the deployment in your cluster</a>
        </li>
        <li class="md-nav__item"><a href="#And-let&#39;s-check-that-it&#39;s-been-created." class="md-nav__link">And let’s check that it’s been created.</a>
        </li>
        <li class="md-nav__item"><a href="#Test-the-model" class="md-nav__link">Test the model</a>
        </li>
        <li class="md-nav__item"><a href="#First-we-need-to-find-the-URL-that-we&#39;ll-use" class="md-nav__link">First we need to find the URL that we’ll use</a>
        </li>
        <li class="md-nav__item"><a href="#Let&#39;s-see-the-predictions-for-each-label" class="md-nav__link">Let’s see the predictions for each label</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Finally-let&#39;s-visualise-the-metrics-that-seldon-provides-out-of-the-box" class="md-nav__link">Finally let’s visualise the metrics that seldon provides out of the box</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/examples/alibaba_ack_deep_mnist.nblink.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <div class="admonition note">
<p>This page was generated from <a class="reference external" href="https://github.com/SeldonIO/seldon-core/blob/e665e4994eabf83fb43c68a5f85e96d5c45e91b5/examples/models/alibaba_ack_deep_mnist/alibaba_cloud_ack_deep_mnist.ipynb">examples/models/alibaba_ack_deep_mnist/alibaba_cloud_ack_deep_mnist.ipynb</a>.</p>
</div>
<section id="Alibaba-Cloud-Container-Service-for-Kubernetes-(ACK)-Deep-MNIST-Example">
<h1 id="examples-alibaba-ack-deep-mnist--page-root">Alibaba Cloud Container Service for Kubernetes (ACK) Deep MNIST Example<a class="headerlink" href="#examples-alibaba-ack-deep-mnist--page-root" title="Permalink to this heading">¶</a></h1>
<p>In this example we will deploy a tensorflow MNIST model in the Alibaba Cloud Container Service for Kubernetes.</p>
<p>This tutorial will break down in the following sections:</p>
<ol class="arabic simple">
<li><p>Train a tensorflow model to predict mnist locally</p></li>
<li><p>Containerise the tensorflow model with our docker utility</p></li>
<li><p>Test model locally with docker</p></li>
<li><p>Set-up and configure Alibaba Cloud environment</p></li>
<li><p>Deploy your model and visualise requests</p></li>
</ol>
<p>Let’s get started! 🚀🔥</p>
<section id="Dependencies:">
<h2 id="Dependencies:">Dependencies:<a class="headerlink" href="#Dependencies:" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Helm v3.0.0+</p></li>
<li><p>kubectl v1.14+</p></li>
<li><p>Python 3.6+</p></li>
<li><p>Python DEV requirements</p></li>
</ul>
</section>
<section id="1)-Train-a-tensorflow-model-to-predict-mnist-locally">
<h2 id="1)-Train-a-tensorflow-model-to-predict-mnist-locally">1) Train a tensorflow model to predict mnist locally<a class="headerlink" href="#1)-Train-a-tensorflow-model-to-predict-mnist-locally" title="Permalink to this heading">¶</a></h2>
<p>We will load the mnist images, together with their labels, and then train a tensorflow model to predict the right labels</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.examples.tutorials.mnist</span> <span class="kn">import</span> <span class="n">input_data</span>

<span class="n">mnist</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">read_data_sets</span><span class="p">(</span><span class="s2">"MNIST_data/"</span><span class="p">,</span> <span class="n">one_hot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">784</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">"x"</span><span class="p">)</span>

    <span class="n">W</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">784</span><span class="p">,</span> <span class="mi">10</span><span class="p">]))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">10</span><span class="p">]))</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"y"</span><span class="p">)</span>

    <span class="n">y_</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

    <span class="n">cross_entropy</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span>
        <span class="o">-</span><span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">y_</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">reduction_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">)</span>

    <span class="n">train_step</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">GradientDescentOptimizer</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">cross_entropy</span><span class="p">)</span>

    <span class="n">init</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">initialize_all_variables</span><span class="p">()</span>

    <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">batch_xs</span><span class="p">,</span> <span class="n">batch_ys</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">next_batch</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_step</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">batch_xs</span><span class="p">,</span> <span class="n">y_</span><span class="p">:</span> <span class="n">batch_ys</span><span class="p">})</span>

    <span class="n">correct_prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y_</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">correct_prediction</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">mnist</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">images</span><span class="p">,</span> <span class="n">y_</span><span class="p">:</span> <span class="n">mnist</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">labels</span><span class="p">}))</span>

    <span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Saver</span><span class="p">()</span>

    <span class="n">saver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="s2">"model/deep_mnist_model"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING:tensorflow:From &lt;ipython-input-1-559b63ab8b48&gt;:2: read_data_sets (from tensorflow.contrib.learn.python.learn.datasets.mnist) is deprecated and will be removed in a future version.
Instructions for updating:
Please use alternatives such as official/mnist/dataset.py from tensorflow/models.
WARNING:tensorflow:From /home/alejandro/miniconda3/envs/reddit-classification/lib/python3.7/site-packages/tensorflow/contrib/learn/python/learn/datasets/mnist.py:260: maybe_download (from tensorflow.contrib.learn.python.learn.datasets.base) is deprecated and will be removed in a future version.
Instructions for updating:
Please write your own downloading logic.
WARNING:tensorflow:From /home/alejandro/miniconda3/envs/reddit-classification/lib/python3.7/site-packages/tensorflow/contrib/learn/python/learn/datasets/mnist.py:262: extract_images (from tensorflow.contrib.learn.python.learn.datasets.mnist) is deprecated and will be removed in a future version.
Instructions for updating:
Please use tf.data to implement this functionality.
Extracting MNIST_data/train-images-idx3-ubyte.gz
WARNING:tensorflow:From /home/alejandro/miniconda3/envs/reddit-classification/lib/python3.7/site-packages/tensorflow/contrib/learn/python/learn/datasets/mnist.py:267: extract_labels (from tensorflow.contrib.learn.python.learn.datasets.mnist) is deprecated and will be removed in a future version.
Instructions for updating:
Please use tf.data to implement this functionality.
Extracting MNIST_data/train-labels-idx1-ubyte.gz
WARNING:tensorflow:From /home/alejandro/miniconda3/envs/reddit-classification/lib/python3.7/site-packages/tensorflow/contrib/learn/python/learn/datasets/mnist.py:110: dense_to_one_hot (from tensorflow.contrib.learn.python.learn.datasets.mnist) is deprecated and will be removed in a future version.
Instructions for updating:
Please use tf.one_hot on tensors.
Extracting MNIST_data/t10k-images-idx3-ubyte.gz
Extracting MNIST_data/t10k-labels-idx1-ubyte.gz
WARNING:tensorflow:From /home/alejandro/miniconda3/envs/reddit-classification/lib/python3.7/site-packages/tensorflow/contrib/learn/python/learn/datasets/mnist.py:290: DataSet.__init__ (from tensorflow.contrib.learn.python.learn.datasets.mnist) is deprecated and will be removed in a future version.
Instructions for updating:
Please use alternatives such as official/mnist/dataset.py from tensorflow/models.
WARNING:tensorflow:From /home/alejandro/miniconda3/envs/reddit-classification/lib/python3.7/site-packages/tensorflow/python/framework/op_def_library.py:263: colocate_with (from tensorflow.python.framework.ops) is deprecated and will be removed in a future version.
Instructions for updating:
Colocations handled automatically by placer.
WARNING:tensorflow:From /home/alejandro/miniconda3/envs/reddit-classification/lib/python3.7/site-packages/tensorflow/python/ops/math_ops.py:3066: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.cast instead.
WARNING:tensorflow:From /home/alejandro/miniconda3/envs/reddit-classification/lib/python3.7/site-packages/tensorflow/python/util/tf_should_use.py:193: initialize_all_variables (from tensorflow.python.ops.variables) is deprecated and will be removed after 2017-03-02.
Instructions for updating:
Use `tf.global_variables_initializer` instead.
0.9191
</pre></div></div>
</div>
</section>
<section id="2)-Containerise-the-tensorflow-model-with-our-docker-utility">
<h2 id="2)-Containerise-the-tensorflow-model-with-our-docker-utility">2) Containerise the tensorflow model with our docker utility<a class="headerlink" href="#2)-Containerise-the-tensorflow-model-with-our-docker-utility" title="Permalink to this heading">¶</a></h2>
<p>Create a wrapper file that exposes the functionality through a <code class="docutils literal notranslate"><span class="pre">predict</span></code> function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> DeepMnist.py
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">DeepMnist</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"class:</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">import_meta_graph</span><span class="p">(</span><span class="s2">"model/deep_mnist_model.meta"</span><span class="p">)</span>
        <span class="n">saver</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="p">,</span><span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">latest_checkpoint</span><span class="p">(</span><span class="s2">"./model/"</span><span class="p">))</span>

        <span class="n">graph</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_default_graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_tensor_by_name</span><span class="p">(</span><span class="s2">"x:0"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_tensor_by_name</span><span class="p">(</span><span class="s2">"y:0"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">feature_names</span><span class="p">):</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span><span class="n">X</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">predictions</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overwriting DeepMnist.py
</pre></div></div>
</div>
<p>Define the dependencies for the wrapper in the requirements.txt:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> requirements.txt
<span class="n">tensorflow</span><span class="o">&gt;=</span><span class="mf">1.12.0</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overwriting requirements.txt
</pre></div></div>
</div>
<p>You need to make sure that you have added the .s2i/environment configuration file in this folder with the following content:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>mkdir<span class="w"> </span>.s2i
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
mkdir: cannot create directory ‘.s2i’: File exists
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> .s2i/environment
<span class="n">MODEL_NAME</span><span class="o">=</span><span class="n">DeepMnist</span>
<span class="n">API_TYPE</span><span class="o">=</span><span class="n">REST</span>
<span class="n">SERVICE_TYPE</span><span class="o">=</span><span class="n">MODEL</span>
<span class="n">PERSISTENCE</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overwriting .s2i/environment
</pre></div></div>
</div>
<p>Now we can build a docker image named “deep-mnist” with the tag 0.1</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>s2i<span class="w"> </span>build<span class="w"> </span>.<span class="w"> </span>seldonio/seldon-core-s2i-python36:1.14.0<span class="w"> </span>deep-mnist:0.1
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
---&gt; Installing application source...
---&gt; Installing dependencies ...
Looking in links: /whl
Requirement already satisfied: tensorflow&gt;=1.12.0 in /usr/local/lib/python3.6/site-packages (from -r requirements.txt (line 1)) (1.13.1)
Requirement already satisfied: keras-applications&gt;=1.0.6 in /usr/local/lib/python3.6/site-packages (from tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (1.0.7)
Requirement already satisfied: absl-py&gt;=0.1.6 in /usr/local/lib/python3.6/site-packages (from tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (0.7.1)
Requirement already satisfied: gast&gt;=0.2.0 in /usr/local/lib/python3.6/site-packages (from tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (0.2.2)
Requirement already satisfied: keras-preprocessing&gt;=1.0.5 in /usr/local/lib/python3.6/site-packages (from tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (1.0.9)
Requirement already satisfied: tensorboard&lt;1.14.0,&gt;=1.13.0 in /usr/local/lib/python3.6/site-packages (from tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (1.13.1)
Requirement already satisfied: astor&gt;=0.6.0 in /usr/local/lib/python3.6/site-packages (from tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (0.7.1)
Requirement already satisfied: wheel&gt;=0.26 in /usr/local/lib/python3.6/site-packages (from tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (0.32.2)
Requirement already satisfied: protobuf&gt;=3.6.1 in /usr/local/lib/python3.6/site-packages (from tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (3.7.1)
Requirement already satisfied: six&gt;=1.10.0 in /usr/local/lib/python3.6/site-packages (from tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (1.12.0)
Requirement already satisfied: grpcio&gt;=1.8.6 in /usr/local/lib/python3.6/site-packages (from tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (1.20.1)
Requirement already satisfied: termcolor&gt;=1.1.0 in /usr/local/lib/python3.6/site-packages (from tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (1.1.0)
Requirement already satisfied: numpy&gt;=1.13.3 in /usr/local/lib/python3.6/site-packages (from tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (1.16.3)
Requirement already satisfied: tensorflow-estimator&lt;1.14.0rc0,&gt;=1.13.0 in /usr/local/lib/python3.6/site-packages (from tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (1.13.0)
Requirement already satisfied: h5py in /usr/local/lib/python3.6/site-packages (from keras-applications&gt;=1.0.6-&gt;tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (2.9.0)
Requirement already satisfied: markdown&gt;=2.6.8 in /usr/local/lib/python3.6/site-packages (from tensorboard&lt;1.14.0,&gt;=1.13.0-&gt;tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (3.1)
Requirement already satisfied: werkzeug&gt;=0.11.15 in /usr/local/lib/python3.6/site-packages (from tensorboard&lt;1.14.0,&gt;=1.13.0-&gt;tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (0.15.4)
Requirement already satisfied: setuptools in /usr/local/lib/python3.6/site-packages (from protobuf&gt;=3.6.1-&gt;tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (40.6.2)
Requirement already satisfied: mock&gt;=2.0.0 in /usr/local/lib/python3.6/site-packages (from tensorflow-estimator&lt;1.14.0rc0,&gt;=1.13.0-&gt;tensorflow&gt;=1.12.0-&gt;-r requirements.txt (line 1)) (3.0.5)
Url '/whl' is ignored. It is either a non-existing path or lacks a specific scheme.
You are using pip version 18.1, however version 19.1.1 is available.
You should consider upgrading via the 'pip install --upgrade pip' command.
Build completed successfully
</pre></div></div>
</div>
</section>
<section id="3)-Test-model-locally-with-docker">
<h2 id="3)-Test-model-locally-with-docker">3) Test model locally with docker<a class="headerlink" href="#3)-Test-model-locally-with-docker" title="Permalink to this heading">¶</a></h2>
<p>We first run the docker image we just created as a container called “mnist_predictor”</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>docker<span class="w"> </span>run<span class="w"> </span>--name<span class="w"> </span><span class="s2">"mnist_predictor"</span><span class="w"> </span>-d<span class="w"> </span>--rm<span class="w"> </span>-p<span class="w"> </span><span class="m">5000</span>:5000<span class="w"> </span>deep-mnist:0.1
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
9087047e368ac8f285e1f742704b4c0c7bceac7d29ee90b3b0a6ef2d61ebd15c
</pre></div></div>
</div>
<p>Send some random features that conform to the contract</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># This is the variable that was initialised at the beginning of the file</span>
<span class="n">i</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"gray"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Expected label: "</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">),</span> <span class="s2">". One hot encoding: "</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_alibaba_ack_deep_mnist_16_0.png" src="../_images/examples_alibaba_ack_deep_mnist_16_0.png"/>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Expected label:  7.0 . One hot encoding:  [[0. 0. 0. 0. 0. 0. 0. 1. 0. 0.]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">seldon_core.seldon_client</span> <span class="kn">import</span> <span class="n">SeldonClient</span>

<span class="c1"># We now test the REST endpoint expecting the same result</span>
<span class="n">endpoint</span> <span class="o">=</span> <span class="s2">"0.0.0.0:5000"</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">payload_type</span> <span class="o">=</span> <span class="s2">"ndarray"</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">SeldonClient</span><span class="p">(</span><span class="n">microservice_endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">)</span>

<span class="c1"># We use the microservice, instead of the "predict" function</span>
<span class="n">client_prediction</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">microservice</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">batch</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"predict"</span><span class="p">,</span> <span class="n">payload_type</span><span class="o">=</span><span class="n">payload_type</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">"tfidf"</span><span class="p">]</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">proba</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="n">client_prediction</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">list_value</span><span class="o">.</span><span class="n">ListFields</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
    <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
<span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"LABEL </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">:</span><span class="se">\t</span><span class="s2"> </span><span class="si">{</span><span class="n">proba</span><span class="o">.</span><span class="n">number_value</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">6.4f</span><span class="si">}</span><span class="s2"> %"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
LABEL 0:         0.0064 %
LABEL 1:         0.0000 %
LABEL 2:         0.0155 %
LABEL 3:         0.2862 %
LABEL 4:         0.0003 %
LABEL 5:         0.0027 %
LABEL 6:         0.0000 %
LABEL 7:         99.6643 %
LABEL 8:         0.0020 %
LABEL 9:         0.0227 %
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>docker<span class="w"> </span>rm<span class="w"> </span>mnist_predictor<span class="w"> </span>--force
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
mnist_predictor
</pre></div></div>
</div>
</section>
<section id="4)-Set-up-and-configure-Alibaba-Cloud-environment">
<h2 id="4)-Set-up-and-configure-Alibaba-Cloud-environment">4) Set-up and configure Alibaba Cloud environment<a class="headerlink" href="#4)-Set-up-and-configure-Alibaba-Cloud-environment" title="Permalink to this heading">¶</a></h2>
<section id="4.1-create-a-managed-kubernetes-cluster">
<h3 id="4.1-create-a-managed-kubernetes-cluster">4.1 create a managed kubernetes cluster<a class="headerlink" href="#4.1-create-a-managed-kubernetes-cluster" title="Permalink to this heading">¶</a></h3>
<p>We need to first create a cluster in Alibaba Cloud - you should follow the following instructions (make sure you expose the cluster with an elastic IP by checking the tickbox): <a class="reference external" href="https://www.alibabacloud.com/help/doc-detail/95108.htm">https://www.alibabacloud.com/help/doc-detail/95108.htm</a></p>
<p>You should follow up the instructions but the finished cluster should look as follows:</p>
<p><img alt="k8s-dashboard-2" src="../_images/k8s-dashboard-2.jpg"/></p>
</section>
<section id="4.2-Copy-the-kubectl-configuration-to-access-the-cluster">
<h3 id="4.2-Copy-the-kubectl-configuration-to-access-the-cluster">4.2 Copy the kubectl configuration to access the cluster<a class="headerlink" href="#4.2-Copy-the-kubectl-configuration-to-access-the-cluster" title="Permalink to this heading">¶</a></h3>
<p>Once you have the cluster created, you will be able to use your local kubectl by copying the configuration details on the overview page, and copy it to your ~/.kube/config</p>
</section>
<section id="4.3-Create-an-Alibaba-Container-Registry-to-push-the-image">
<h3 id="4.3-Create-an-Alibaba-Container-Registry-to-push-the-image">4.3 Create an Alibaba Container Registry to push the image<a class="headerlink" href="#4.3-Create-an-Alibaba-Container-Registry-to-push-the-image" title="Permalink to this heading">¶</a></h3>
<p>Finally we need to create a container registry repository by following this guide: <a class="reference external" href="https://www.alibabacloud.com/blog/up-and-running-with-alibaba-cloud-container-registry_593765">https://www.alibabacloud.com/blog/up-and-running-with-alibaba-cloud-container-registry_593765</a></p>
</section>
</section>
<section id="Setup-Seldon-Core">
<h2 id="Setup-Seldon-Core">Setup Seldon Core<a class="headerlink" href="#Setup-Seldon-Core" title="Permalink to this heading">¶</a></h2>
<p>Use the setup notebook to <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/seldon_core_setup.html#Setup-Cluster">Setup Cluster</a> with <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/seldon_core_setup.html#Ambassador">Ambassador Ingress</a> and <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/seldon_core_setup.html#Install-Seldon-Core">Install Seldon Core</a>. Instructions <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/seldon_core_setup.html">also
online</a>.</p>
<section id="Finally-we-install-the-Seldon-Analytics-Package">
<h3 id="Finally-we-install-the-Seldon-Analytics-Package">Finally we install the Seldon Analytics Package<a class="headerlink" href="#Finally-we-install-the-Seldon-Analytics-Package" title="Permalink to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>helm<span class="w"> </span>install<span class="w"> </span>seldon-core-analytics<span class="w"> </span>seldon-core-analytics<span class="w"> </span>--repo<span class="w"> </span>https://storage.googleapis.com/seldon-charts
<span class="o">!</span>kubectl<span class="w"> </span>rollout<span class="w"> </span>status<span class="w"> </span>deployment.apps/grafana-prom-deployment
<span class="o">!</span>kubectl<span class="w"> </span>patch<span class="w"> </span>svc<span class="w"> </span>grafana-prom<span class="w"> </span>--type<span class="o">=</span><span class="s1">'json'</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">'[{"op":"replace","path":"/spec/type","value":"LoadBalancer"}]'</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Error: rendered manifests contain a resource that already exists. Unable to continue with install: existing resource conflict: kind: Secret, namespace: default, name: grafana-prom-secret
deployment "grafana-prom-deployment" successfully rolled out
service/grafana-prom patched
</pre></div></div>
</div>
</section>
<section id="4.5-Push-docker-image">
<h3 id="4.5-Push-docker-image">4.5 Push docker image<a class="headerlink" href="#4.5-Push-docker-image" title="Permalink to this heading">¶</a></h3>
<p>We’ll now make sure the image is accessible within the Kubernetes cluster by pushing it to the repo that we created in step 4.3. This should look as follows in your dashboard:</p>
<p><img alt="k8s-dashboard-1" src="../_images/k8s-dashboard-1.jpg"/></p>
<section id="To-push-the-image-we-first-tag-it">
<h4 id="To-push-the-image-we-first-tag-it">To push the image we first tag it<a class="headerlink" href="#To-push-the-image-we-first-tag-it" title="Permalink to this heading">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>docker<span class="w"> </span>tag<span class="w"> </span>deep-mnist:0.1<span class="w"> </span>registry-intl.eu-west-1.aliyuncs.com/seldonalibaba/deep-mnist:0.1
</pre></div>
</div>
</div>
</section>
<section id="And-then-we-push-it">
<h4 id="And-then-we-push-it">And then we push it<a class="headerlink" href="#And-then-we-push-it" title="Permalink to this heading">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>docker<span class="w"> </span>push<span class="w"> </span>registry-intl.eu-west-1.aliyuncs.com/seldonalibaba/deep-mnist:0.1
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The push refers to repository [registry-intl.eu-west-1.aliyuncs.com/seldonalibaba/deep-mnist]

358e90f3: Preparing
e4a983d1: Preparing
74b2c556: Preparing
9472b523: Preparing
a2a7ea60: Preparing
eddb328a: Preparing
1393f8e7: Preparing
67d6e30e: Preparing
f19da2c9: Preparing
9ec591c4: Preparing
32b1ff99: Preparing
64f96dbc: Preparing
e6d76fd9: Preparing
11a84ad4: Preparing
64f96dbc: Pushing  105.6MB/141.8MBPushing     512B/4.43kBPushing  548.9kB/648.8MBPushing  7.426MB/16.85MBPushing  57.75MB/65.26MBPushing  22.51MB/556.5MBPushing  45.06MB/648.8MBPushing   66.6MB/141.8MBPushing  82.16MB/556.5MBPushing  96.63MB/556.5MB4b2c556: Pushing    377MB/648.8MBPushing  72.91MB/648.8MBPushing  158.4MB/556.5MBPushing  103.4MBPushing  197.5MB/556.5MBPushing  266.3MB/556.5MBPushing  176.6MB/648.8MBPushing  268.1MB/648.8MBPushing  269.8MB/648.8MBPushing  280.8MB/648.8MBPushing  404.4MB/556.5MBPushing  422.9MB/556.5MBPushing  345.7MB/648.8MB4b2c556: Pushed   659.3MB/648.8MBPushing  467.2MB/648.8MB0.1: digest: sha256:13ab55662f0e8479bb51d998a8014f7f059a73422295bcd400f62615d36355dc size: 3482
</pre></div></div>
</div>
</section>
</section>
</section>
<section id="5---Deploy-your-model-and-visualise-requests">
<h2 id="5---Deploy-your-model-and-visualise-requests">5 - Deploy your model and visualise requests<a class="headerlink" href="#5---Deploy-your-model-and-visualise-requests" title="Permalink to this heading">¶</a></h2>
<p><strong>IMPORTANT: Make sure you replace the URL for your repo in the format of:</strong> * registry-intl.<strong>[REPO]</strong>.aliyuncs.com/<strong>[REGISTRY]</strong>/<strong>[REPO]</strong>:0.1</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> deep_mnist_deployment.yaml
<span class="o">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">machinelearning</span><span class="o">.</span><span class="n">seldon</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1alpha2</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">SeldonDeployment</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">seldon</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">deep</span><span class="o">-</span><span class="n">mnist</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">annotations</span><span class="p">:</span>
    <span class="n">project_name</span><span class="p">:</span> <span class="n">Tensorflow</span> <span class="n">MNIST</span>
    <span class="n">deployment_version</span><span class="p">:</span> <span class="n">v1</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">deep</span><span class="o">-</span><span class="n">mnist</span>
  <span class="n">predictors</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">componentSpecs</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">spec</span><span class="p">:</span>
        <span class="n">containers</span><span class="p">:</span>
        <span class="c1"># REPLACE_FOR_IMAGE_AND_TAG</span>
        <span class="o">-</span> <span class="n">image</span><span class="p">:</span> <span class="n">registry</span><span class="o">-</span><span class="n">intl</span><span class="o">.</span><span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mf">1.</span><span class="n">aliyuncs</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">seldonalibaba</span><span class="o">/</span><span class="n">deep</span><span class="o">-</span><span class="n">mnist</span><span class="p">:</span><span class="mf">0.1</span>
          <span class="n">imagePullPolicy</span><span class="p">:</span> <span class="n">IfNotPresent</span>
          <span class="n">name</span><span class="p">:</span> <span class="n">classifier</span>
          <span class="n">resources</span><span class="p">:</span>
            <span class="n">requests</span><span class="p">:</span>
              <span class="n">memory</span><span class="p">:</span> <span class="mi">1</span><span class="n">Mi</span>
        <span class="n">terminationGracePeriodSeconds</span><span class="p">:</span> <span class="mi">20</span>
    <span class="n">graph</span><span class="p">:</span>
      <span class="n">children</span><span class="p">:</span> <span class="p">[]</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">classifier</span>
      <span class="n">endpoint</span><span class="p">:</span>
        <span class="nb">type</span><span class="p">:</span> <span class="n">REST</span>
      <span class="nb">type</span><span class="p">:</span> <span class="n">MODEL</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">single</span><span class="o">-</span><span class="n">model</span>
    <span class="n">replicas</span><span class="p">:</span> <span class="mi">1</span>
    <span class="n">annotations</span><span class="p">:</span>
      <span class="n">predictor_version</span><span class="p">:</span> <span class="n">v1</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overwriting deep_mnist_deployment.yaml
</pre></div></div>
</div>
<section id="Run-the-deployment-in-your-cluster">
<h3 id="Run-the-deployment-in-your-cluster">Run the deployment in your cluster<a class="headerlink" href="#Run-the-deployment-in-your-cluster" title="Permalink to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">deep_mnist_deployment</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</div>
</section>
<section id="And-let's-check-that-it's-been-created.">
<h3 id="And-let's-check-that-it's-been-created.">And let’s check that it’s been created.<a class="headerlink" href="#And-let's-check-that-it's-been-created." title="Permalink to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>get<span class="w"> </span>pods
</pre></div>
</div>
</div>
</section>
<section id="Test-the-model">
<h3 id="Test-the-model">Test the model<a class="headerlink" href="#Test-the-model" title="Permalink to this heading">¶</a></h3>
<p>We’ll use a random example from our dataset</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># This is the variable that was initialised at the beginning of the file</span>
<span class="n">i</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"gray"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Expected label: "</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">),</span> <span class="s2">". One hot encoding: "</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_alibaba_ack_deep_mnist_40_0.png" src="../_images/examples_alibaba_ack_deep_mnist_40_0.png"/>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Expected label:  7.0 . One hot encoding:  [[0. 0. 0. 0. 0. 0. 0. 1. 0. 0.]]
</pre></div></div>
</div>
</section>
<section id="First-we-need-to-find-the-URL-that-we'll-use">
<h3 id="First-we-need-to-find-the-URL-that-we'll-use">First we need to find the URL that we’ll use<a class="headerlink" href="#First-we-need-to-find-the-URL-that-we'll-use" title="Permalink to this heading">¶</a></h3>
<p>You need to add it to the script in the next block</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>ambassador<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.status.loadBalancer.ingress[0].ip}'</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
8.208.23.117
</pre></div></div>
</div>
<p>We can now add the URL above to send our request:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">seldon_core.seldon_client</span> <span class="kn">import</span> <span class="n">SeldonClient</span>

<span class="c1"># Add the URL you found above, here:</span>
<span class="n">HOST</span> <span class="o">=</span> <span class="s2">"8.208.23.117"</span>


<span class="n">port</span> <span class="o">=</span> <span class="s2">"80"</span>  <span class="c1"># Make sure you use the port above</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">payload_type</span> <span class="o">=</span> <span class="s2">"ndarray"</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">SeldonClient</span><span class="p">(</span>
    <span class="n">gateway</span><span class="o">=</span><span class="s2">"ambassador"</span><span class="p">,</span> <span class="n">gateway_endpoint</span><span class="o">=</span><span class="n">HOST</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="n">port</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s2">"default"</span>
<span class="p">)</span>

<span class="n">client_prediction</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">batch</span><span class="p">,</span> <span class="n">deployment_name</span><span class="o">=</span><span class="s2">"deep-mnist"</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">"text"</span><span class="p">],</span> <span class="n">payload_type</span><span class="o">=</span><span class="n">payload_type</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">client_prediction</span><span class="o">.</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
meta {
  puid: "krop281g4e1mrsgf60m7ilh1fc"
  requestPath {
    key: "classifier"
    value: "registry-intl.eu-west-1.aliyuncs.com/seldonalibaba/deep-mnist:0.1"
  }
}
data {
  names: "class:0"
  names: "class:1"
  names: "class:2"
  names: "class:3"
  names: "class:4"
  names: "class:5"
  names: "class:6"
  names: "class:7"
  names: "class:8"
  names: "class:9"
  ndarray {
    values {
      list_value {
        values {
          number_value: 4.4009637349518016e-05
        }
        values {
          number_value: 6.321029477618367e-09
        }
        values {
          number_value: 0.0001286377664655447
        }
        values {
          number_value: 0.0030034701339900494
        }
        values {
          number_value: 3.061768893530825e-06
        }
        values {
          number_value: 1.882280412246473e-05
        }
        values {
          number_value: 1.8899024567531342e-08
        }
        values {
          number_value: 0.9959828853607178
        }
        values {
          number_value: 2.070009031740483e-05
        }
        values {
          number_value: 0.0007983553223311901
        }
      }
    }
  }
}

</pre></div></div>
</div>
</section>
<section id="Let's-see-the-predictions-for-each-label">
<h3 id="Let's-see-the-predictions-for-each-label">Let’s see the predictions for each label<a class="headerlink" href="#Let's-see-the-predictions-for-each-label" title="Permalink to this heading">¶</a></h3>
<p>It seems that it correctly predicted the number 7</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">proba</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="n">client_prediction</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">list_value</span><span class="o">.</span><span class="n">ListFields</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
    <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
<span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"LABEL </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">:</span><span class="se">\t</span><span class="s2"> </span><span class="si">{</span><span class="n">proba</span><span class="o">.</span><span class="n">number_value</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">6.4f</span><span class="si">}</span><span class="s2"> %"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
LABEL 0:         0.0044 %
LABEL 1:         0.0000 %
LABEL 2:         0.0129 %
LABEL 3:         0.3003 %
LABEL 4:         0.0003 %
LABEL 5:         0.0019 %
LABEL 6:         0.0000 %
LABEL 7:         99.5983 %
LABEL 8:         0.0021 %
LABEL 9:         0.0798 %
</pre></div></div>
</div>
<section id="Finally-let's-visualise-the-metrics-that-seldon-provides-out-of-the-box">
<h4 id="Finally-let's-visualise-the-metrics-that-seldon-provides-out-of-the-box">Finally let’s visualise the metrics that seldon provides out of the box<a class="headerlink" href="#Finally-let's-visualise-the-metrics-that-seldon-provides-out-of-the-box" title="Permalink to this heading">¶</a></h4>
<p>For this we can access the URL with the command below, it will request an admin and password which by default are set to the following: * Username: admin * Password: admin</p>
<p><strong>You will be able to access it at http://[URL]/d/ejAHFXIWz/prediction-analytics?orgId=1</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>grafana-prom<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.status.loadBalancer.ingress[0].ip}'</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
8.208.25.68
</pre></div></div>
</div>
<p>The metrics include requests per second, as well as latency. You are able to add your own custom metrics, and try out other more complex deployments by following furher guides at <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/notebooks.html">https://docs.seldon.io/projects/seldon-core/en/latest/examples/notebooks.html</a></p>
<p><img alt="graf" src="../_images/graf.jpg"/></p>
</section>
</section>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="gpu_tensorflow_deep_mnist.html" title="Tensorflow GPU MNIST Model with GKE"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> "Previous" </span> Tensorflow GPU MNIST Model with GKE </span>
              </div>
            </a>
          
          
            <a href="triton_gpt2_example_azure.html" title="Pretrained GPT2 Model Deployment Example"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> "Next" </span> Pretrained GPT2 Model Deployment Example </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2024, Seldon Technologies Ltd.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>