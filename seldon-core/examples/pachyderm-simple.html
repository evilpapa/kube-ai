<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-54780881-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'UA-54780881-2');
</script>
  
  
    <title>Pachyderm-Seldon Integration: Version Controlled Models &#8212; seldon-core  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=83e35b93" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/rtd_sphinx_search.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=15a8f09d" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/rtd_search_config.js"></script>
    <script src="../_static/js/rtd_sphinx_search.min.js"></script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PVC with TFJob MNIST Example" href="pvc-tfjob.html" />
    <link rel="prev" title="Metadata Schema and Validation" href="metadata_schema.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=teal>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#examples/pachyderm-simple" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="seldon-core  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Seldon Core Documentation</span>
          <span class="md-header-nav__topic"> Pachyderm-Seldon Integration: Version Controlled Models </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/SeldonIO/seldon-core/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Seldon Core
  </div>
</a>
          </div>
        </div>
      
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="/" class="md-tabs__link">ğŸš€ Our Other Projects & Products:</a></li>
            
            <li class="md-tabs__item"><a href="https://docs.seldon.io/projects/alibi/en/stable/" class="md-tabs__link">Alibi Explain</a></li>
            
            <li class="md-tabs__item"><a href="https://docs.seldon.io/projects/alibi-detect/en/stable/" class="md-tabs__link">Alibi Detect</a></li>
            
            <li class="md-tabs__item"><a href="https://mlserver.readthedocs.io/en/latest/" class="md-tabs__link">MLServer</a></li>
            
            <li class="md-tabs__item"><a href="https://tempo.readthedocs.io/en/latest/" class="md-tabs__link">Tempo SDK</a></li>
            
            <li class="md-tabs__item"><a href="https://deploy.seldon.io" class="md-tabs__link">Seldon Enterprise Platform</a></li>
            
            <li class="md-tabs__item"><a href="https://github.com/SeldonIO/seldon-deploy-sdk#seldon-deploy-sdk" class="md-tabs__link">Seldon Enterprise Platform SDK</a></li>
          <li class="md-tabs__item"><a href="../nav/reference.html" class="md-tabs__link">å‚è€ƒ</a></li>
          <li class="md-tabs__item"><a href="../nav/archive.html" class="md-tabs__link">ä¾›å®¡æ ¸çš„å­˜æ¡£æ–‡æ¡£</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="seldon-core documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="seldon-core documentation">Seldon Core Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/SeldonIO/seldon-core/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Seldon Core
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../nav/getting-started.html" class="md-nav__link">å¼€å§‹</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/concepts.html" class="md-nav__link">æ¦‚å¿µ</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/configuration.html" class="md-nav__link">é…ç½®</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/tutorials.html" class="md-nav__link">æ•™ç¨‹</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/reference.html" class="md-nav__link">å‚è€ƒ</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../graph/annotations.html" class="md-nav__link">åŸºäºæ³¨è§£çš„é…ç½®</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../reference/benchmarking.html" class="md-nav__link">åŸºå‡†æµ‹è¯•</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../reference/ga.html" class="md-nav__link">ä¸€èˆ¬å¯ç”¨æ€§ï¼ˆGAï¼‰</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../graph/helm_charts.html" class="md-nav__link">Helm Charts</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../reference/images.html" class="md-nav__link">é•œåƒ</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../analytics/log_level.html" class="md-nav__link">æ—¥å¿—åŠç­‰çº§</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../graph/private_registries.html" class="md-nav__link">ç§æœ‰ Docker æ³¨å†Œä¸­å¿ƒ</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../reference/apis/index.html" class="md-nav__link">é¢„ä¼° APIs</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../python/api/modules.html" class="md-nav__link">Python API å‚è€ƒ</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../reference/release-highlights.html" class="md-nav__link">å‘å¸ƒäº®ç‚¹</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../reference/seldon-deployment.html" class="md-nav__link">Seldon Deployment CRD</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../graph/svcorch.html" class="md-nav__link">æœåŠ¡ç¼–æ’å™¨</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../analytics/kubeflow.html" class="md-nav__link">Kubeflow</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/archive.html" class="md-nav__link">å½’æ¡£æ–‡æ¡£</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="../R/r_wrapping_docker.html" class="md-nav__link">R è¯­è¨€å°è£… Docker</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../charts/seldon-openvino.html" class="md-nav__link">Seldon OpenVino</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ambassador_circuit_breakers.html" class="md-nav__link">Ambassador ç†”æ–­</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="custom_init_container.html" class="md-nav__link">Custom Init Containers with rclone and MinIO</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="custom_init_container.html#Cleanup" class="md-nav__link">Cleanup</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="drift_cifar10.html" class="md-nav__link">Drift CIFAR10</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="dvc.html" class="md-nav__link">DVC</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="graph-metadata.html" class="md-nav__link">å›¾å…ƒæ•°æ®</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="iris_anchor_tabular_explainer_v2.html" class="md-nav__link">Anchor Tabular Explainer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="iris_explainer_poetry.html" class="md-nav__link">Explainer for Iris model with Poetry-defined Environment</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="iris_explainer_poetry.html#Deploy-Iris-Model" class="md-nav__link">Deploy Iris Model</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="iris_explainer_poetry.html#Train-Explainer" class="md-nav__link">Train Explainer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="iris_explainer_poetry.html#Save-and-deploy-Explainer" class="md-nav__link">Save and deploy Explainer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="iris_explainer_poetry.html#Test-Deployed-explainer" class="md-nav__link">Test Deployed explainer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="istio.html" class="md-nav__link">Istio ç¤ºä¾‹</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="metadata.html" class="md-nav__link">å…ƒæ•°æ®ç¤ºä¾‹</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="metadata_grpc.html" class="md-nav__link">Metadata GRPC API example</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="metadata_grpc.html#Example-description" class="md-nav__link">Example description</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="metadata_schema.html" class="md-nav__link">å…ƒæ•°æ®æ¶æ„</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Pachyderm ç¤ºä¾‹ </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Pachyderm ç¤ºä¾‹</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#examples-pachyderm-simple--page-root" class="md-nav__link">Pachyderm-Seldon Integration: Version Controlled Models</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Highlights" class="md-nav__link">Highlights</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Prerequisites" class="md-nav__link">Prerequisites</a>
        </li>
        <li class="md-nav__item"><a href="#1.-Installing-Pachyderm" class="md-nav__link">1. Installing Pachyderm</a>
        </li>
        <li class="md-nav__item"><a href="#2.-Add-the-Training-Data" class="md-nav__link">2. Add the Training Data</a>
        </li>
        <li class="md-nav__item"><a href="#3.-Train-the-Model-Using-a-Pachyderm-Pipeline" class="md-nav__link">3. Train the Model Using a Pachyderm Pipeline</a>
        </li>
        <li class="md-nav__item"><a href="#4.-Verify-Pipeline-Success" class="md-nav__link">4. Verify Pipeline Success</a>
        </li>
        <li class="md-nav__item"><a href="#5.-Deploy-Seldon-Core-Powered-Sklearn-Server" class="md-nav__link">5. Deploy Seldon-Core Powered Sklearn Server</a>
        </li>
        <li class="md-nav__item"><a href="#6.-Test-the-Deployment" class="md-nav__link">6. Test the Deployment</a>
        </li>
        <li class="md-nav__item"><a href="#7.-Bonus:-Rebuilding-the-Model" class="md-nav__link">7. Bonus: Rebuilding the Model</a>
        </li>
        <li class="md-nav__item"><a href="#Cleanup" class="md-nav__link">Cleanup</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/examples/pachyderm-simple.nblink.txt">Show Source</a> </li>

  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="pvc-tfjob.html" class="md-nav__link">PVC TFJob</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="seldon_client.html" class="md-nav__link">Seldon å®¢æˆ·ç«¯</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="server_examples.html" class="md-nav__link">Server ç¤ºä¾‹</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="triton_mnist_e2e.html" class="md-nav__link">Triton E2E</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../graph/custom_svc_name.html" class="md-nav__link">è‡ªå®šä¹‰ Service åç§°ç¤ºä¾‹</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../graph/grpc_load_balancing_ambassador.html" class="md-nav__link">gRPC è´Ÿè½½å‡è¡¡</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../graph/model_rest_grpc_settings.html" class="md-nav__link">Rest gRPC è®¾ç½®</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../graph/model_svcorch_sep.html" class="md-nav__link">æ¨¡å‹æœåŠ¡ç¼–æ’</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../java-jni/README.html" class="md-nav__link">Java JNI</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../reference/apis/readme.html" class="md-nav__link">APIs è¯»æˆ‘</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../reference/concepts.html" class="md-nav__link">æ¦‚å¿µ</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../reference/integration_nvidia_link.html" class="md-nav__link">Nvidia å®ç°</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../reference/integration_sagemaker_link.html" class="md-nav__link">Sagemaker å®ç°</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../tutorials/blogs.html" class="md-nav__link">åšå®¢</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../tutorials/podcasts.html" class="md-nav__link">æ’­å®¢</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../tutorials/videos.html" class="md-nav__link">è§†é¢‘</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../workflow/quickstart.html" class="md-nav__link">å¿«é€Ÿå¼€å§‹</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../wrappers/language_wrappers.html" class="md-nav__link">è¯­è¨€å°è£…</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../wrappers/s2i.html" class="md-nav__link">S2I</a>
      
    
    </li></ul>
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/contributing.html" class="md-nav__link">è´¡çŒ®</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#examples-pachyderm-simple--page-root" class="md-nav__link">Pachyderm-Seldon Integration: Version Controlled Models</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Highlights" class="md-nav__link">Highlights</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Prerequisites" class="md-nav__link">Prerequisites</a>
        </li>
        <li class="md-nav__item"><a href="#1.-Installing-Pachyderm" class="md-nav__link">1. Installing Pachyderm</a>
        </li>
        <li class="md-nav__item"><a href="#2.-Add-the-Training-Data" class="md-nav__link">2. Add the Training Data</a>
        </li>
        <li class="md-nav__item"><a href="#3.-Train-the-Model-Using-a-Pachyderm-Pipeline" class="md-nav__link">3. Train the Model Using a Pachyderm Pipeline</a>
        </li>
        <li class="md-nav__item"><a href="#4.-Verify-Pipeline-Success" class="md-nav__link">4. Verify Pipeline Success</a>
        </li>
        <li class="md-nav__item"><a href="#5.-Deploy-Seldon-Core-Powered-Sklearn-Server" class="md-nav__link">5. Deploy Seldon-Core Powered Sklearn Server</a>
        </li>
        <li class="md-nav__item"><a href="#6.-Test-the-Deployment" class="md-nav__link">6. Test the Deployment</a>
        </li>
        <li class="md-nav__item"><a href="#7.-Bonus:-Rebuilding-the-Model" class="md-nav__link">7. Bonus: Rebuilding the Model</a>
        </li>
        <li class="md-nav__item"><a href="#Cleanup" class="md-nav__link">Cleanup</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/examples/pachyderm-simple.nblink.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <div class="admonition note">
<p>This page was generated from <a class="reference external" href="https://github.com/SeldonIO/seldon-core/blob/e665e4994eabf83fb43c68a5f85e96d5c45e91b5/examples/pachyderm-simple/index.ipynb">examples/pachyderm-simple/index.ipynb</a>.</p>
</div>
<section id="Pachyderm-Seldon-Integration:-Version-Controlled-Models">
<h1 id="examples-pachyderm-simple--page-root">Pachyderm-Seldon Integration: Version Controlled Models<a class="headerlink" href="#examples-pachyderm-simple--page-root" title="Permalink to this heading">Â¶</a></h1>
<p><a class="reference external" href="https://pachyderm.io/">Pachyderm</a> is a data science platform that combines Data Lineage with End-to-End Pipelines. <a class="reference external" href="https://www.seldon.io/tech/products/core/">Seldon-Core</a> is an open-source platform for rapidly deploying machine learning models.</p>
<p>This notebook will show you how to perform data-driven model training using Pachyderm and deploy that model using Seldon-Core. This represents the simplest integration between Pachyderm and Seldon.</p>
<section id="Highlights">
<h2 id="Highlights">Highlights<a class="headerlink" href="#Highlights" title="Permalink to this heading">Â¶</a></h2>
<p>The highlight in this example is the use of Pachydermâ€™s S3 gateway, where version controlled pachyderm repositories are exposed via an S3-like API. This means that Seldon-Coreâ€™s pre-packaged model servers, which typically read from blob storage, can read directly from Pachyderm.</p>
<p>This implements the machine learning best practice of provenance. You can trace the model artifactâ€™s lineage right back to the version of the data that it was trained on, without making any changes to your usual way of working.</p>
<p><img alt="overview image" src="../_images/pachyderm-simple-demo.png"/></p>
<section id="Prerequisites">
<h3 id="Prerequisites">Prerequisites<a class="headerlink" href="#Prerequisites" title="Permalink to this heading">Â¶</a></h3>
<ul class="simple">
<li><p>A kubernetes cluster with kubectl configured</p></li>
<li><p><a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/seldon_core_setup.html">A seldon-core cluster installed and configured</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">curl</span></code></p></li>
<li><p>Pachydermâ€™s <code class="docutils literal notranslate"><span class="pre">pachctl</span></code> binary installed following the <a class="reference external" href="https://docs.pachyderm.com/latest/getting_started/local_installation/#install-pachctl">official documentation</a></p></li>
</ul>
<p>Pachyderm is controlled and deployed via the <code class="docutils literal notranslate"><span class="pre">pachctl</span></code>. This document assumes that you have version <code class="docutils literal notranslate"><span class="pre">1.11.8</span></code> installed, although it should work with any <code class="docutils literal notranslate"><span class="pre">1.x.x</span></code> version.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pachctl<span class="w"> </span>version<span class="w"> </span>--client-only
<span class="o">!</span>kubectl<span class="w"> </span>get<span class="w"> </span>po<span class="w"> </span>-A
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.11.9
NAMESPACE            NAME                                           READY   STATUS    RESTARTS   AGE
istio-system         istio-ingressgateway-56c9c8cd47-v5tjv          1/1     Running   0          116s
istio-system         istiod-759c7859d5-g5nnn                        1/1     Running   0          2m19s
kube-system          coredns-6955765f44-4rfs6                       1/1     Running   0          3m39s
kube-system          coredns-6955765f44-gsggt                       1/1     Running   0          3m39s
kube-system          etcd-seldon-control-plane                      1/1     Running   0          3m32s
kube-system          kindnet-g8ptw                                  1/1     Running   0          3m39s
kube-system          kube-apiserver-seldon-control-plane            1/1     Running   0          3m32s
kube-system          kube-controller-manager-seldon-control-plane   1/1     Running   0          3m32s
kube-system          kube-proxy-7lgg5                               1/1     Running   0          3m39s
kube-system          kube-scheduler-seldon-control-plane            1/1     Running   0          3m32s
local-path-storage   local-path-provisioner-58f6947c7-pfvth         1/1     Running   0          3m39s
seldon-system        seldon-controller-manager-b9fd77c6f-pmdc2      1/1     Running   0          88s
</pre></div></div>
</div>
</section>
<section id="1.-Installing-Pachyderm">
<h3 id="1.-Installing-Pachyderm">1. Installing Pachyderm<a class="headerlink" href="#1.-Installing-Pachyderm" title="Permalink to this heading">Â¶</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">pachctl</span></code> to deploy Pachyderm to your cluster. In the command below I disable the pachyderm dashboard because it is not used in this example and I intentionally disable sharing of the docker socket to reduce the chance that rogue containers can access my system.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>create<span class="w"> </span>ns<span class="w"> </span>pachyderm
<span class="o">!</span>pachctl<span class="w"> </span>deploy<span class="w"> </span><span class="nb">local</span><span class="w"> </span>--no-expose-docker-socket<span class="w"> </span>--no-dashboard<span class="w"> </span>--namespace<span class="w"> </span>pachyderm
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
namespace/pachyderm created
serviceaccount/pachyderm created
serviceaccount/pachyderm-worker created
clusterrole.rbac.authorization.k8s.io/pachyderm created
clusterrolebinding.rbac.authorization.k8s.io/pachyderm created
role.rbac.authorization.k8s.io/pachyderm-worker created
rolebinding.rbac.authorization.k8s.io/pachyderm-worker created
deployment.apps/etcd created
service/etcd created
service/pachd created
service/pachd-peer created
deployment.apps/pachd created
secret/pachyderm-storage-secret created

Pachyderm is launching. Check its status with "kubectl get all"

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>rollout<span class="w"> </span>status<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>pachyderm<span class="w"> </span>pachd
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Waiting for deployment "pachd" rollout to finish: 0 of 1 updated replicas are available...
deployment "pachd" successfully rolled out
</pre></div></div>
</div>
</section>
<section id="2.-Add-the-Training-Data">
<h3 id="2.-Add-the-Training-Data">2. Add the Training Data<a class="headerlink" href="#2.-Add-the-Training-Data" title="Permalink to this heading">Â¶</a></h3>
<blockquote>
<div><p>Note: If you are using a non-standard Pachyderm namespace, you will need to run <code class="docutils literal notranslate"><span class="pre">pachctl</span> <span class="pre">port-forward</span></code> in a separate terminal</p>
</div></blockquote>
<p>Before we train a model, I will first create a new Pachyderm repository to version control the data, then commit the training data to that repository. You should be able to see <code class="docutils literal notranslate"><span class="pre">iris.csv</span></code> in the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch of the repository <code class="docutils literal notranslate"><span class="pre">training</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pachctl<span class="w"> </span>create<span class="w"> </span>repo<span class="w"> </span>training
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="nb">cd</span><span class="w"> </span>data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pachctl<span class="w"> </span>put<span class="w"> </span>file<span class="w"> </span>training@master<span class="w"> </span>-f<span class="w"> </span>iris.csv
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
iris.csv: 4.44 KiB / 4.44 KiB [===============================] 100.00% ? p/s 0s
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pachctl<span class="w"> </span>list<span class="w"> </span>repo
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
NAME     CREATED            SIZE (MASTER) DESCRIPTION
training About a minute ago 4.443KiB
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pachctl<span class="w"> </span>list<span class="w"> </span>file<span class="w"> </span>training@master
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
NAME      TYPE SIZE
/iris.csv file 4.443KiB
</pre></div></div>
</div>
</section>
<section id="3.-Train-the-Model-Using-a-Pachyderm-Pipeline">
<h3 id="3.-Train-the-Model-Using-a-Pachyderm-Pipeline">3. Train the Model Using a Pachyderm Pipeline<a class="headerlink" href="#3.-Train-the-Model-Using-a-Pachyderm-Pipeline" title="Permalink to this heading">Â¶</a></h3>
<p>Pachyderm Pipelines are the computational component of the Pachyderm platform. They are responsible for reading data from a specified source, such as a Pachyderm repo, transforming it according to the pipeline configuration, and writing the result to an output repo. Pachyderm pipelines can be easily chained together to create a directed acyclic graph (DAG).</p>
<p>I define a simple pipeline that is inspired by a <a class="reference external" href="https://github.com/pachyderm/pachyderm/tree/master/examples/ml/iris">similar Pachyderm example</a>. It accepts training data, trains a logistic classifier, and returns a pickled model in joblib format.</p>
<p>This uses a container built from the <a class="reference external" href="https://github.com/SeldonIO/seldon-core/tree/master/examples/pachyderm-simple/iris-train-python-svm">iris-train-python-svm</a> directory to perform the training, but you could use your own. The input is defined to be the <code class="docutils literal notranslate"><span class="pre">training</span></code> Pachyderm repository and the output will be stored in a repository with the same name as the pipeline (<code class="docutils literal notranslate"><span class="pre">model</span></code>). Remember to push the container to somewhere that the cluster can acccess. For example, you can use the
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">kind_load</span></code> target in the <a class="reference external" href="https://github.com/SeldonIO/seldon-core/blob/master/examples/pachyderm-simple/iris-train-python-svm/Makefile">Makefile</a> to push the container to a <code class="docutils literal notranslate"><span class="pre">kind</span></code> cluster.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> train.json
<span class="p">{</span>
  <span class="s2">"pipeline"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"model"</span>
  <span class="p">},</span>
  <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"A pipeline that trains a SVM model based on the data in the `data` directory by using a Python script."</span><span class="p">,</span>
  <span class="s2">"transform"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"image"</span><span class="p">:</span> <span class="s2">"seldonio/pachyderm-iris-trainer:1.0.0"</span><span class="p">,</span>
    <span class="s2">"cmd"</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">"python3"</span><span class="p">,</span>
      <span class="s2">"/code/pytrain.py"</span><span class="p">,</span>
      <span class="s2">"/pfs/training/"</span><span class="p">,</span>
      <span class="s2">"/pfs/out/"</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">"parallelism_spec"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"constant"</span><span class="p">:</span> <span class="s2">"1"</span>
  <span class="p">},</span>
  <span class="s2">"input"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"pfs"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"repo"</span><span class="p">:</span> <span class="s2">"training"</span><span class="p">,</span>
      <span class="s2">"glob"</span><span class="p">:</span> <span class="s2">"/"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overwriting train.json
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pachctl<span class="w"> </span>create<span class="w"> </span>pipeline<span class="w"> </span>-f<span class="w"> </span>train.json
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pachctl<span class="w"> </span>list<span class="w"> </span>pipeline
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
NAME  VERSION INPUT      CREATED      STATE / LAST JOB    DESCRIPTION
model 1       training:/ 1 second ago <span class="ansi-yellow-fg">starting</span> / <span class="ansi-yellow-fg">starting</span> A pipeline that trains a SVM model based on the data in the `data` directory by using a Python script.
</pre></div></div>
</div>
</section>
<section id="4.-Verify-Pipeline-Success">
<h3 id="4.-Verify-Pipeline-Success">4. Verify Pipeline Success<a class="headerlink" href="#4.-Verify-Pipeline-Success" title="Permalink to this heading">Â¶</a></h3>
<p>It may take a while for the job to start the first time, as Kubernetes pulls the container. But eventually you should see that the job completes and a new file is committed to the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch of the <code class="docutils literal notranslate"><span class="pre">model</span></code> repository.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pachctl<span class="w"> </span>list<span class="w"> </span>job
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ID                               PIPELINE STARTED            DURATION RESTART PROGRESS  DL       UL       STATE
4315d70acf4d4497ba9d3581a731c8d5 model    About a minute ago 1 second 0       1 + 0 / 1 4.443KiB 1.193KiB <span class="ansi-green-fg">success</span>
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pachctl<span class="w"> </span>list<span class="w"> </span>file<span class="w"> </span>model@master
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
NAME          TYPE SIZE
/model.joblib file 1.193KiB
</pre></div></div>
</div>
</section>
<section id="5.-Deploy-Seldon-Core-Powered-Sklearn-Server">
<h3 id="5.-Deploy-Seldon-Core-Powered-Sklearn-Server">5. Deploy Seldon-Core Powered Sklearn Server<a class="headerlink" href="#5.-Deploy-Seldon-Core-Powered-Sklearn-Server" title="Permalink to this heading">Â¶</a></h3>
<p>Now that you have a model artefact, you can use Pachydermâ€™s S3 gateway feature to directly load the version controlled model into a Seldon-Core deployment.</p>
<p>The key is to create a container secret that points to the pachyderm cluster on the right port. If you have installed Pachyderm by following this tutorial, then it will have installed with no credentials. In this case the corresponding access key and secret are not used (but must be set). The endpoint URL is pointing to the in-cluster FQDN of the pachyderm service on port <code class="docutils literal notranslate"><span class="pre">600</span></code>.</p>
<p>Next you can deploy your sklearn-based Seldon Deployment in the usual mannor, using the following format for the S3 bucket: <code class="docutils literal notranslate"><span class="pre">s3://${branch}.${repository}/${directory}</span></code>. Since our model is written to the root of the directory, the final s3 <code class="docutils literal notranslate"><span class="pre">modelUri</span></code> is <code class="docutils literal notranslate"><span class="pre">s3://master.model</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> secret.yaml

<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">seldon</span><span class="o">-</span><span class="n">init</span><span class="o">-</span><span class="n">container</span><span class="o">-</span><span class="n">secret</span>
<span class="nb">type</span><span class="p">:</span> <span class="n">Opaque</span>
<span class="n">stringData</span><span class="p">:</span>
  <span class="n">AWS_ACCESS_KEY_ID</span><span class="p">:</span> <span class="n">noauth</span>
  <span class="n">AWS_SECRET_ACCESS_KEY</span><span class="p">:</span> <span class="n">noauth</span>
  <span class="n">AWS_ENDPOINT_URL</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">pachd</span><span class="o">.</span><span class="n">pachyderm</span><span class="o">.</span><span class="n">svc</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">local</span><span class="p">:</span><span class="mi">600</span>
  <span class="n">USE_SSL</span><span class="p">:</span> <span class="s2">"false"</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overwriting secret.yaml
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>-n<span class="w"> </span>seldon<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>secret.yaml
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
secret/seldon-init-container-secret configured
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> deploy.yaml

<span class="n">apiVersion</span><span class="p">:</span> <span class="n">machinelearning</span><span class="o">.</span><span class="n">seldon</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">SeldonDeployment</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">pachyderm</span><span class="o">-</span><span class="n">sklearn</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">iris</span>
  <span class="n">predictors</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">componentSpecs</span><span class="p">:</span>
    <span class="n">graph</span><span class="p">:</span>
      <span class="n">children</span><span class="p">:</span> <span class="p">[]</span>
      <span class="n">implementation</span><span class="p">:</span> <span class="n">SKLEARN_SERVER</span>
      <span class="n">modelUri</span><span class="p">:</span> <span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">master</span><span class="o">.</span><span class="n">model</span>
      <span class="n">envSecretRefName</span><span class="p">:</span> <span class="n">seldon</span><span class="o">-</span><span class="n">init</span><span class="o">-</span><span class="n">container</span><span class="o">-</span><span class="n">secret</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">classifier</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">default</span>
    <span class="n">replicas</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overwriting deploy.yaml
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>-n<span class="w"> </span>seldon<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>deploy.yaml
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
seldondeployment.machinelearning.seldon.io/pachyderm-sklearn configured
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>-n<span class="w"> </span>seldon<span class="w"> </span>rollout<span class="w"> </span>status<span class="w"> </span>deploy/<span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>deploy<span class="w"> </span>-l<span class="w"> </span>seldon-deployment-id<span class="o">=</span>pachyderm-sklearn<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[0].metadata.name}'</span><span class="k">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Waiting for deployment "pachyderm-sklearn-default-0-classifier" rollout to finish: 1 old replicas are pending termination...
Waiting for deployment "pachyderm-sklearn-default-0-classifier" rollout to finish: 1 old replicas are pending termination...
Waiting for deployment "pachyderm-sklearn-default-0-classifier" rollout to finish: 1 old replicas are pending termination...
deployment "pachyderm-sklearn-default-0-classifier" successfully rolled out
</pre></div></div>
</div>
</section>
<section id="6.-Test-the-Deployment">
<h3 id="6.-Test-the-Deployment">6. Test the Deployment<a class="headerlink" href="#6.-Test-the-Deployment" title="Permalink to this heading">Â¶</a></h3>
<p>Now that the deployment has completed, you can call the model predict endpoint via the port-forwarded ingress FDQN and the seldon-core API. The input matches the convension expected by the mdoel (set by the training data) and results in predicted class probabilities.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
curl<span class="w"> </span>-s<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s1">'Content-Type: application/json'</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-d<span class="w"> </span><span class="s1">'{"data":{"ndarray":[[5.964, 4.006, 2.081, 1.031]]}}'</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>http://localhost:8003/seldon/seldon/pachyderm-sklearn/api/v1.0/predictions<span class="w">  </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
  "data": {
    "names": [
      "t:0",
      "t:1",
      "t:2"
    ],
    "ndarray": [
      [
        0.9550249833404882,
        0.04491709964435876,
        5.791701515296898e-05
      ]
    ]
  },
  "meta": {
    "requestPath": {
      "classifier": "seldonio/sklearnserver:1.6.0-dev"
    }
  }
}
</pre></div></div>
</div>
</section>
<section id="7.-Bonus:-Rebuilding-the-Model">
<h3 id="7.-Bonus:-Rebuilding-the-Model">7. Bonus: Rebuilding the Model<a class="headerlink" href="#7.-Bonus:-Rebuilding-the-Model" title="Permalink to this heading">Â¶</a></h3>
<p>The beauty of having models version controlled is that when you change the data, you can automatically retrain the model.</p>
<p>Below Iâ€™m overwriting the old training data with a slightly smaller version of the same. When I do this, the pipeline notices and automatically runs. That means that the model artifact is regenerated and place back in itâ€™s repo.</p>
<p>At the end, all we need to do is restart the pod, to get Seldon-Core to reload model from itâ€™s S3 endpoint. Youâ€™ll see in the final call of the predict endpoint that the result has changed, even though weâ€™re passing in the same input data. This is because the decision boundaries have changed slightly due to the different training data distribution.</p>
<p>In another example I will show you how to automate this.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="nb">cd</span><span class="w"> </span>data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pachctl<span class="w"> </span>put<span class="w"> </span>file<span class="w"> </span>training@master:/iris.csv<span class="w"> </span>-f<span class="w"> </span>iris_2.csv
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
iris_2.csv: 1.29 KiB / 1.29 KiB [=============================] 100.00% ? p/s 0s
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pachctl<span class="w"> </span>list<span class="w"> </span>file<span class="w"> </span>training@master
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
NAME      TYPE SIZE
/iris.csv file 5.729KiB
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pachctl<span class="w"> </span>list<span class="w"> </span>job
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ID                               PIPELINE STARTED       DURATION           RESTART PROGRESS  DL       UL       STATE
54168db975c2459cb5e537db4def3688 model    3 seconds ago Less than a second 0       1 + 0 / 1 5.729KiB 1.193KiB <span class="ansi-green-fg">success</span>
4315d70acf4d4497ba9d3581a731c8d5 model    5 minutes ago 1 second           0       1 + 0 / 1 4.443KiB 1.193KiB <span class="ansi-green-fg">success</span>
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>-n<span class="w"> </span>seldon<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>deploy.yaml
<span class="o">!</span>kubectl<span class="w"> </span>-n<span class="w"> </span>seldon<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>deploy.yaml
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
seldondeployment.machinelearning.seldon.io "pachyderm-sklearn" deleted
seldondeployment.machinelearning.seldon.io/pachyderm-sklearn created
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>-n<span class="w"> </span>seldon<span class="w"> </span>rollout<span class="w"> </span>status<span class="w"> </span>deploy/<span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>deploy<span class="w"> </span>-l<span class="w"> </span>seldon-deployment-id<span class="o">=</span>pachyderm-sklearn<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[0].metadata.name}'</span><span class="k">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Waiting for deployment "pachyderm-sklearn-default-0-classifier" rollout to finish: 0 of 1 updated replicas are available...
deployment "pachyderm-sklearn-default-0-classifier" successfully rolled out
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
curl<span class="w"> </span>-s<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s1">'Content-Type: application/json'</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-d<span class="w"> </span><span class="s1">'{"data":{"ndarray":[[5.964, 4.006, 2.081, 1.031]]}}'</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>http://localhost:8003/seldon/seldon/pachyderm-sklearn/api/v1.0/predictions<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
  "data": {
    "names": [
      "t:0",
      "t:1",
      "t:2"
    ],
    "ndarray": [
      [
        0.9622688698661227,
        0.03771194327740441,
        1.9186856472893013e-05
      ]
    ]
  },
  "meta": {
    "requestPath": {
      "classifier": "seldonio/sklearnserver:1.6.0-dev"
    }
  }
}
</pre></div></div>
</div>
</section>
<section id="Cleanup">
<h3 id="Cleanup">Cleanup<a class="headerlink" href="#Cleanup" title="Permalink to this heading">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>-n<span class="w"> </span>seldon<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>deploy.yaml
<span class="o">!</span>kubectl<span class="w"> </span>delete<span class="w"> </span>ns<span class="w"> </span>pachyderm
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
seldondeployment.machinelearning.seldon.io "pachyderm-sklearn" deleted
namespace "pachyderm" deleted
</pre></div></div>
</div>
</section>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="metadata_schema.html" title="Metadata Schema and Validation"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> "Previous" </span> Metadata Schema and Validation </span>
              </div>
            </a>
          
          
            <a href="pvc-tfjob.html" title="PVC with TFJob MNIST Example"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> "Next" </span> PVC with TFJob MNIST Example </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2024, Seldon Technologies Ltd.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>