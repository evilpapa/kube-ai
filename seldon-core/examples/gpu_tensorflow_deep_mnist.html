<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-54780881-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'UA-54780881-2');
</script>
  
  
    <title>Tensorflow GPU MNIST Model with GKE &#8212; seldon-core  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=83e35b93" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/rtd_sphinx_search.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=15a8f09d" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/rtd_search_config.js"></script>
    <script src="../_static/js/rtd_sphinx_search.min.js"></script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Alibaba Cloud Container Service for Kubernetes (ACK) Deep MNIST Example" href="alibaba_ack_deep_mnist.html" />
    <link rel="prev" title="Azure Kubernetes Service (AKS) Deep MNIST" href="azure_aks_deep_mnist.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=teal>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#examples/gpu_tensorflow_deep_mnist" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="seldon-core  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Seldon Core Documentation</span>
          <span class="md-header-nav__topic"> Tensorflow GPU MNIST Model with GKE </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/SeldonIO/seldon-core/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Seldon Core
  </div>
</a>
          </div>
        </div>
      
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="/" class="md-tabs__link">🚀 Our Other Projects & Products:</a></li>
            
            <li class="md-tabs__item"><a href="https://docs.seldon.io/projects/alibi/en/stable/" class="md-tabs__link">Alibi Explain</a></li>
            
            <li class="md-tabs__item"><a href="https://docs.seldon.io/projects/alibi-detect/en/stable/" class="md-tabs__link">Alibi Detect</a></li>
            
            <li class="md-tabs__item"><a href="https://mlserver.readthedocs.io/en/latest/" class="md-tabs__link">MLServer</a></li>
            
            <li class="md-tabs__item"><a href="https://tempo.readthedocs.io/en/latest/" class="md-tabs__link">Tempo SDK</a></li>
            
            <li class="md-tabs__item"><a href="https://deploy.seldon.io" class="md-tabs__link">Seldon Enterprise Platform</a></li>
            
            <li class="md-tabs__item"><a href="https://github.com/SeldonIO/seldon-deploy-sdk#seldon-deploy-sdk" class="md-tabs__link">Seldon Enterprise Platform SDK</a></li>
          <li class="md-tabs__item"><a href="../nav/tutorials.html" class="md-tabs__link">教程</a></li>
          <li class="md-tabs__item"><a href="notebooks.html" class="md-tabs__link">笔记本</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="seldon-core documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="seldon-core documentation">Seldon Core Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/SeldonIO/seldon-core/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Seldon Core
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../nav/getting-started.html" class="md-nav__link">开始</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/concepts.html" class="md-nav__link">概念</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/configuration.html" class="md-nav__link">配置</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/tutorials.html" class="md-nav__link">教程</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="notebooks.html" class="md-nav__link">笔记本</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#seldon-core" class="md-nav__link">Seldon Core 设置</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id2" class="md-nav__link">预包装推理服务示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#python" class="md-nav__link">Python 语言封装示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id3" class="md-nav__link">专门的框架示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id4" class="md-nav__link">孵化项目示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id5" class="md-nav__link">基于云的基础示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id6" class="md-nav__link">高级机器学习监控</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id7" class="md-nav__link">Seldon Core 批处理</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#mlops" class="md-nav__link">MLOps: 扩展、监控和可观察性</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id8" class="md-nav__link">生产配置及实现</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#ab" class="md-nav__link">AB 测试及渐进式部署</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id9" class="md-nav__link">复杂图示例</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id10" class="md-nav__link">入口</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id11" class="md-nav__link">基础设施</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id12" class="md-nav__link">基准测试和负载测试</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="notebooks.html#id13" class="md-nav__link">升级示例</a>
      
    
    </li></ul>
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/reference.html" class="md-nav__link">参考</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../nav/contributing.html" class="md-nav__link">贡献</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#examples-gpu-tensorflow-deep-mnist--page-root" class="md-nav__link">Tensorflow GPU MNIST Model with GKE</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#Local-Testing-Environment" class="md-nav__link">Local Testing Environment</a>
        </li>
        <li class="md-nav__item"><a href="#1)-Installing-all-dependencies-to-run-Tensorflow-GPU" class="md-nav__link">1) Installing all dependencies to run Tensorflow-GPU</a>
        </li>
        <li class="md-nav__item"><a href="#1.1)-Install-CUDA-10.0" class="md-nav__link">1.1) Install CUDA 10.0</a>
        </li>
        <li class="md-nav__item"><a href="#1.2)-Install-cuDNN-7.6" class="md-nav__link">1.2) Install cuDNN 7.6</a>
        </li>
        <li class="md-nav__item"><a href="#1.3)-Configure-CUDA-and-cuDNN" class="md-nav__link">1.3) Configure CUDA and cuDNN</a>
        </li>
        <li class="md-nav__item"><a href="#1.4)-Install-tensorflow-with-GPU" class="md-nav__link">1.4) Install tensorflow with GPU</a>
        </li>
        <li class="md-nav__item"><a href="#2)-Train-the-MNIST-model-locally" class="md-nav__link">2) Train the MNIST model locally</a>
        </li>
        <li class="md-nav__item"><a href="#Dependencies" class="md-nav__link">Dependencies</a>
        </li>
        <li class="md-nav__item"><a href="#Train-locally" class="md-nav__link">Train locally</a>
        </li>
        <li class="md-nav__item"><a href="#3)-Push-the-image-to-Google-Container-Registry" class="md-nav__link">3) Push the image to Google Container Registry</a>
        </li>
        <li class="md-nav__item"><a href="#4)-Deploy-in-GKE" class="md-nav__link">4) Deploy in GKE</a>
        </li>
        <li class="md-nav__item"><a href="#Spin-up-a-GKE-Cluster" class="md-nav__link">Spin up a GKE Cluster</a>
        </li>
        <li class="md-nav__item"><a href="#Setup-Seldon-Core" class="md-nav__link">Setup Seldon Core</a>
        </li>
        <li class="md-nav__item"><a href="#Build-the-Seldon-Graph" class="md-nav__link">Build the Seldon Graph</a>
        </li>
        <li class="md-nav__item"><a href="#Test-the-deployment-with-test-data" class="md-nav__link">Test the deployment with test data</a>
        </li>
        <li class="md-nav__item"><a href="#Clean-up" class="md-nav__link">Clean up</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/examples/gpu_tensorflow_deep_mnist.nblink.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <div class="admonition note">
<p>This page was generated from <a class="reference external" href="https://github.com/SeldonIO/seldon-core/blob/e665e4994eabf83fb43c68a5f85e96d5c45e91b5/examples/models/gpu_tensorflow_deep_mnist/gpu_tensorflow_deep_mnist.ipynb">examples/models/gpu_tensorflow_deep_mnist/gpu_tensorflow_deep_mnist.ipynb</a>.</p>
</div>
<section id="Tensorflow-GPU-MNIST-Model-with-GKE">
<h1 id="examples-gpu-tensorflow-deep-mnist--page-root">Tensorflow GPU MNIST Model with GKE<a class="headerlink" href="#examples-gpu-tensorflow-deep-mnist--page-root" title="Permalink to this heading">¶</a></h1>
<p><strong>Please note: This tutorial uses Tensorflow-gpu=1.13.1, CUDA 10.0 and cuDNN 7.6</strong></p>
<p><strong>Requirements: Ubuntu 18.+ and Python 3.6</strong></p>
<p>In this tutorial we will run a deep MNIST Tensorflow example with GPU.</p>
<p>The tutorial will be broken down into the following sections:</p>
<ol class="arabic">
<li><p>Install all dependencies to run Tensorflow-GPU</p>
<p>1.1 Installing CUDA 10.0</p>
<p>1.2 Installing cuDNN 7.6</p>
<p>1.3 Configure CUDA and cuDNN</p>
<p>1.4 Install Tensorflow GPU</p>
</li>
<li><p>Train the MNIST model locally</p></li>
<li><p>Push the Image to your proejcts Container Registry</p></li>
<li><p>Deploy the model on GKE using Seldon Core</p></li>
</ol>
<section id="Local-Testing-Environment">
<h2 id="Local-Testing-Environment">Local Testing Environment<a class="headerlink" href="#Local-Testing-Environment" title="Permalink to this heading">¶</a></h2>
<p>For the development of this example a GCE Virtual Machine was used to allow access to a GPU. The configuration for this VM is as follows:</p>
<ul class="simple">
<li><p>VM Image: TensorFlow from NVIDIA</p></li>
<li><p>8 vCPUs</p></li>
<li><p>32 GB memory</p></li>
<li><p>1x NVIDIA Tesla V100 GPU</p></li>
</ul>
</section>
<section id="1)-Installing-all-dependencies-to-run-Tensorflow-GPU">
<h2 id="1)-Installing-all-dependencies-to-run-Tensorflow-GPU">1) Installing all dependencies to run Tensorflow-GPU<a class="headerlink" href="#1)-Installing-all-dependencies-to-run-Tensorflow-GPU" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Dependencies installed in this section:</p>
<ul>
<li><p>Nvidia compute 3.0 onwards</p></li>
<li><p>CUDA 10.0</p></li>
<li><p>cuDNN 7.6</p></li>
<li><p>tensorflow-gpu 1.13.1</p></li>
</ul>
</li>
</ul>
<p><strong>Check Nvidia drivers &gt;= 3.0</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>nvidia-smi
</pre></div>
</div>
</div>
</section>
<section id="1.1)-Install-CUDA-10.0">
<h2 id="1.1)-Install-CUDA-10.0">1.1) Install CUDA 10.0<a class="headerlink" href="#1.1)-Install-CUDA-10.0" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>Download the CUDA 10.0 runfile</strong></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>wget<span class="w"> </span>https://developer.nvidia.com/compute/cuda/10.0/Prod/local_installers/cuda_10.0.130_410.48_linux
</pre></div>
</div>
</div>
<ul class="simple">
<li><p><strong>Unpack the separate files:</strong></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>cuda_10.0.130_410.48_linux
<span class="o">!</span><span class="w"> </span>./cuda_10.0.130_410.48_linux<span class="w"> </span>--extract<span class="o">=</span><span class="nv">$HOME</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p><strong>Install the Cuda 10.0 Toolkit file</strong>:</p></li>
</ul>
<p>From the terminal, run the following command</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo ./cuda-linux.10.0.130-24817639.run
</pre></div>
</div>
<p>Hold ‘d’ to scroll to the bottom of the license agreement.</p>
<p>Accept the licencing agreement and all of the default settings.</p>
<ul class="simple">
<li><p><strong>Verify the install, by installing the sample test:</strong></p></li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo ./cuda-samples.10.0.130-24817639-linux.run
</pre></div>
</div>
<p>Again, accept the agreement and all default settings</p>
<ul class="simple">
<li><p><strong>Configure the runtime library:</strong></p></li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo bash -c "echo /usr/local/cuda/lib64/ &gt; /etc/ld.so.conf.d/cuda.conf"
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo ldconfig
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Add the cuda bin to the file system:</strong></p></li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo vim /etc/environment
</pre></div>
</div>
<p>Add ‘:/usr/local/cuda/bin’ to the end of the PATH (inside quotes)</p>
<ul class="simple">
<li><p><strong>Reboot the system</strong></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>sudo<span class="w"> </span>shutdown<span class="w"> </span>-r<span class="w"> </span>now
</pre></div>
</div>
</div>
<ul class="simple">
<li><p><strong>Run the tests that we set up</strong> - this takes some time to complete, so let it run for a little while…</p></li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cd /usr/local/cuda-10.0/samples

$ sudo make
</pre></div>
</div>
<p>If run into an error involving the GCC version:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-6 10
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-6 10
</pre></div>
</div>
<p>And run again, otherwise, skip this step.</p>
<ul class="simple">
<li><p>After complete, <strong>run a devicequery and bandwidth test</strong>:</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

<span class="nb">cd</span><span class="w"> </span>/usr/local/cuda/samples/bin/x86_64/linux/release
./deviceQuery
</pre></div>
</div>
</div>
<p><strong>Remember to clean up by removing all of the downloaded runtime packages</strong></p>
</section>
<section id="1.2)-Install-cuDNN-7.6">
<h2 id="1.2)-Install-cuDNN-7.6">1.2) Install cuDNN 7.6<a class="headerlink" href="#1.2)-Install-cuDNN-7.6" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>Download all 3 .deb files for CUDA10.0 and Ubuntu 18.04</strong></p></li>
</ul>
<p>You will have to create a Nvidia account for this and go to the archive section of the cuDNN downloads</p>
<p>Ensure you download all 3 files: - Runtime - Developer - Code Samples</p>
<p><strong>Unpackage the three files in this order</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
sudo<span class="w"> </span>dpkg<span class="w"> </span>-i<span class="w"> </span>~/libcudnn7_7.6.0.64-1+cuda10.0_amd64.deb
sudo<span class="w"> </span>dpkg<span class="w"> </span>-i<span class="w"> </span>~/libcudnn7-dev_7.6.0.64-1+cuda10.0_amd64.deb
sudo<span class="w"> </span>dpkg<span class="w"> </span>-i<span class="w"> </span>~/libcudnn7-doc_7.6.0.64-1+cuda10.0_amd64.deb
</pre></div>
</div>
</div>
<ul class="simple">
<li><p><strong>Verify the install is successful with the MNIST example</strong></p></li>
</ul>
<p>From the download folder. Copy the files to somewhere with write access:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>cp<span class="w"> </span>-r<span class="w"> </span>/usr/src/cudnn_samples_v7/<span class="w"> </span>~
</pre></div>
</div>
</div>
<p><strong>Go to the MNIST example code, compile and run it</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
<span class="nb">cd</span><span class="w"> </span>~/cudnn_samples_v7/mnistCUDNN
sudo<span class="w"> </span>make
sudo<span class="w"> </span>./mnistCUDNN
</pre></div>
</div>
</div>
<p><strong>Remember to clean up by removing all of the downloaded runtime packages</strong></p>
</section>
<section id="1.3)-Configure-CUDA-and-cuDNN">
<h2 id="1.3)-Configure-CUDA-and-cuDNN">1.3) Configure CUDA and cuDNN<a class="headerlink" href="#1.3)-Configure-CUDA-and-cuDNN" title="Permalink to this heading">¶</a></h2>
<p><strong>Add LD_LIBRARY_PATH in your .bashrc file:</strong></p>
<p>Add the following line in the end or your .bashrc file export export:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LD_LIBRARY_PATH=/usr/local/cuda/lib64:${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
</pre></div>
</div>
<p>And source it with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ source ~/.bashrc
</pre></div>
</div>
</section>
<section id="1.4)-Install-tensorflow-with-GPU">
<h2 id="1.4)-Install-tensorflow-with-GPU">1.4) Install tensorflow with GPU<a class="headerlink" href="#1.4)-Install-tensorflow-with-GPU" title="Permalink to this heading">¶</a></h2>
<p><strong>Require v=1.13.1 as with CUDA 10.0</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>pip3<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>tensorflow-gpu<span class="o">==</span><span class="m">1</span>.13.1
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">ConfigProto</span><span class="p">(</span><span class="n">log_device_placement</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
</section>
<section id="2)-Train-the-MNIST-model-locally">
<h2 id="2)-Train-the-MNIST-model-locally">2) Train the MNIST model locally<a class="headerlink" href="#2)-Train-the-MNIST-model-locally" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Wrap a Tensorflow MNIST python model for use as a prediction microservice in seldon-core</p>
<ul>
<li><p>Run locally on Docker to test</p></li>
<li><p>Deploy on seldon-core running on minikube</p></li>
</ul>
</li>
</ul>
</section>
<section id="Dependencies">
<h2 id="Dependencies">Dependencies<a class="headerlink" href="#Dependencies" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/kubernetes/helm">Helm</a></p></li>
<li><p><a class="reference external" href="https://github.com/kubernetes/minikube">Minikube</a></p></li>
<li><p><a class="reference external" href="https://github.com/openshift/source-to-image">S2I</a></p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3<span class="w"> </span>install<span class="w"> </span>seldon-core
</pre></div>
</div>
</section>
<section id="Train-locally">
<h2 id="Train-locally">Train locally<a class="headerlink" href="#Train-locally" title="Permalink to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.examples.tutorials.mnist</span> <span class="kn">import</span> <span class="n">input_data</span>

<span class="n">mnist</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">read_data_sets</span><span class="p">(</span><span class="s2">"MNIST_data/"</span><span class="p">,</span> <span class="n">one_hot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">784</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">"x"</span><span class="p">)</span>

    <span class="n">W</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">784</span><span class="p">,</span> <span class="mi">10</span><span class="p">]))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">10</span><span class="p">]))</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"y"</span><span class="p">)</span>

    <span class="n">y_</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

    <span class="n">cross_entropy</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span>
        <span class="o">-</span><span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">y_</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">reduction_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">)</span>

    <span class="n">train_step</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">GradientDescentOptimizer</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">cross_entropy</span><span class="p">)</span>

    <span class="n">init</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">initialize_all_variables</span><span class="p">()</span>

    <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">batch_xs</span><span class="p">,</span> <span class="n">batch_ys</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">next_batch</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_step</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">batch_xs</span><span class="p">,</span> <span class="n">y_</span><span class="p">:</span> <span class="n">batch_ys</span><span class="p">})</span>

    <span class="n">correct_prediction</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y_</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">correct_prediction</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">mnist</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">images</span><span class="p">,</span> <span class="n">y_</span><span class="p">:</span> <span class="n">mnist</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">labels</span><span class="p">}))</span>

    <span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Saver</span><span class="p">()</span>

    <span class="n">saver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="s2">"model/deep_mnist_model"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Wrap model using s2i</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>s2i<span class="w"> </span>build<span class="w"> </span>.<span class="w"> </span>seldonio/seldon-core-s2i-python3-tf-gpu:0.1<span class="w"> </span>deep-mnist-gpu:0.1
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>docker<span class="w"> </span>run<span class="w"> </span>--name<span class="w"> </span><span class="s2">"mnist_predictor"</span><span class="w"> </span>-d<span class="w"> </span>--rm<span class="w"> </span>-p<span class="w"> </span><span class="m">5000</span>:5000<span class="w"> </span>deep-mnist-gpu:0.1
</pre></div>
</div>
</div>
<p>Send some random features that conform to the contract</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>seldon-core-tester<span class="w"> </span>contract.json<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span><span class="m">5000</span><span class="w"> </span>-p
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>docker<span class="w"> </span>rm<span class="w"> </span>mnist_predictor<span class="w"> </span>--force
</pre></div>
</div>
</div>
</section>
<section id="3)-Push-the-image-to-Google-Container-Registry">
<h2 id="3)-Push-the-image-to-Google-Container-Registry">3) Push the image to Google Container Registry<a class="headerlink" href="#3)-Push-the-image-to-Google-Container-Registry" title="Permalink to this heading">¶</a></h2>
<p><strong>Configure access to container registry</strong> (follow the configuration to link to your own project).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gcloud auth configure-docker
</pre></div>
</div>
<p><strong>Tag Image with your project’s registry path</strong> (Edit the command below)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>docker<span class="w"> </span>tag<span class="w"> </span>deep-mnist-gpu:0.1<span class="w"> </span>gcr.io/&lt;YOUR_PROJECT_ID&gt;/deep-mnist-gpu:0.1
</pre></div>
</div>
</div>
<p><strong>Push the Image to the Container Registry</strong> (Again edit command below)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>docker<span class="w"> </span>push<span class="w"> </span>gcr.io/&lt;YOUR_PROJECT_ID&gt;/deep-mnist-gpu:0.1
</pre></div>
</div>
</div>
</section>
<section id="4)-Deploy-in-GKE">
<h2 id="4)-Deploy-in-GKE">4) Deploy in GKE<a class="headerlink" href="#4)-Deploy-in-GKE" title="Permalink to this heading">¶</a></h2>
</section>
<section id="Spin-up-a-GKE-Cluster">
<h2 id="Spin-up-a-GKE-Cluster">Spin up a GKE Cluster<a class="headerlink" href="#Spin-up-a-GKE-Cluster" title="Permalink to this heading">¶</a></h2>
<p>For this example only one node is needed within the cluster. The cluster should have the following <strong>config</strong>:</p>
<ul class="simple">
<li><p>8 CPUs</p></li>
<li><p>30 GB Total Memory</p></li>
<li><p>1 Node with 1X NVIDIA Tesla V100 GPU</p></li>
<li><p>Ubuntu Node image</p></li>
</ul>
<p>Leave the rest of the config as default.</p>
<p><strong>Connect to your cluster and check the context.</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>gcloud<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>project<span class="w"> </span>&lt;YOUR_PROJECT_ID&gt;
<span class="o">!</span>gcloud<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>get-credentials<span class="w"> </span>&lt;YOUR_CLUSTER_NAME&gt;
<span class="o">!</span>kubectl<span class="w"> </span>config<span class="w"> </span>current-context
</pre></div>
</div>
</div>
<p><strong>Installing NVIDIA GPU device drivers</strong></p>
<p>(The below command is for the Ubuntu Node Image - if using a COS image, please see the Google Cloud Documentation for the correct command).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/master/nvidia-driver-installer/ubuntu/daemonset-preloaded.yaml
</pre></div>
</div>
</div>
</section>
<section id="Setup-Seldon-Core">
<h2 id="Setup-Seldon-Core">Setup Seldon Core<a class="headerlink" href="#Setup-Seldon-Core" title="Permalink to this heading">¶</a></h2>
<p>Use the setup notebook to <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/seldon_core_setup.html#Setup-Cluster">Setup Cluster</a> with <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/seldon_core_setup.html#Ambassador">Ambassador Ingress</a> and <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/seldon_core_setup.html#Install-Seldon-Core">Install Seldon Core</a>. Instructions <a class="reference external" href="https://docs.seldon.io/projects/seldon-core/en/latest/examples/seldon_core_setup.html">also
online</a>.</p>
</section>
<section id="Build-the-Seldon-Graph">
<h2 id="Build-the-Seldon-Graph">Build the Seldon Graph<a class="headerlink" href="#Build-the-Seldon-Graph" title="Permalink to this heading">¶</a></h2>
<p>First lets look at the Seldon Graph Yaml file:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[74]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>deep_mnist_gpu.json
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{
    "apiVersion": "machinelearning.seldon.io/v1alpha2",
    "kind": "SeldonDeployment",
    "metadata": {
        "labels": {
            "app": "seldon"
        },
        "name": "deep-mnist-gpu"
    },
    "spec": {
        "annotations": {
            "project_name": "Tensorflow MNIST",
            "deployment_version": "v1"
        },
        "name": "deep-mnist-gpu",
        "predictors": [
            {
                "componentSpecs": [{
                    "spec": {
                        "containers": [
                            {
                                "image": "gcr.io/&lt;YOUR_PROJECT_ID&gt;/deep-mnist-gpu:0.1",
                                "imagePullPolicy": "IfNotPresent",
                                "name": "classifier",
                                "resources": {
                                    "limits": {
                                        "nvidia.com/gpu": 1
                                    }
                                }
                            }
                        ],
                        "terminationGracePeriodSeconds": 20
                    }
                }],
                "graph": {
                    "children": [],
                    "name": "classifier",
                    "endpoint": {
                        "type" : "REST"
                    },
                    "type": "MODEL"
                },
                "name": "single-model",
                "replicas": 1,
                "annotations": {
                    "predictor_version" : "v1"
                }
            }
        ]
    }
}
</pre></div></div>
</div>
<p><strong>Change the image name in this file (line 24) to match the path to the image in your container registry.</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$vim deep_mnist_gpu.json
</pre></div>
</div>
<p>Next, we are ready to <strong>build the seldon graph</strong>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>deep_mnist_gpu.json
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
seldondeployment.machinelearning.seldon.io/deep-mnist-gpu created
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>rollout<span class="w"> </span>status<span class="w"> </span>deploy/deep-mnist-gpu-single-model-8969cc0
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Error from server (NotFound): deployments.extensions "deep-mnist-gpu-single-model-8969cc0" not found
</pre></div></div>
</div>
<p>Check the deployment is running</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>get<span class="w"> </span>pods
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
NAME                                                   READY   STATUS    RESTARTS   AGE
ambassador-865c877494-2td9s                            1/1     Running   0          101m
ambassador-865c877494-2vsk2                            1/1     Running   0          101m
ambassador-865c877494-qzh4c                            1/1     Running   0          101m
deep-mnist-gpu-single-model-0588ac2-865d745b7d-kqcp9   2/2     Running   0          71m
seldon-operator-controller-manager-0                   1/1     Running   1          101m
</pre></div></div>
</div>
</section>
<section id="Test-the-deployment-with-test-data">
<h2 id="Test-the-deployment-with-test-data">Test the deployment with test data<a class="headerlink" href="#Test-the-deployment-with-test-data" title="Permalink to this heading">¶</a></h2>
<p><strong>Change the IP address to the External IP of your Ambassador deployment.</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>kubectl<span class="w"> </span>get<span class="w"> </span>svc
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
NAME                                         TYPE           CLUSTER-IP     EXTERNAL-IP     PORT(S)                      AGE
ambassador                                   LoadBalancer   10.76.8.138    104.197.71.69   80:30783/TCP,443:32277/TCP   101m
ambassador-admins                            ClusterIP      10.76.12.144   &lt;none&gt;          8877/TCP                     101m
deep-mnist-gpu-deep-mnist-gpu                ClusterIP      10.76.5.205    &lt;none&gt;          8000/TCP,5001/TCP            71m
kubernetes                                   ClusterIP      10.76.0.1      &lt;none&gt;          443/TCP                      107m
seldon-87fe3957f4554e9b5af993717a0b9327      ClusterIP      10.76.14.160   &lt;none&gt;          9000/TCP                     71m
seldon-operator-controller-manager-service   ClusterIP      10.76.8.100    &lt;none&gt;          443/TCP                      101m
webhook-server-service                       ClusterIP      10.76.7.151    &lt;none&gt;          443/TCP                      101m
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>seldon-core-api-tester<span class="w"> </span>contract.json<span class="w"> </span>&lt;EXTERNAL_IP_ADDRESS&gt;<span class="w"> </span><span class="sb">`</span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>ambassador<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.spec.ports[0].port}'</span><span class="sb">`</span><span class="w"> </span><span class="err">\</span>
    <span class="n">deep</span><span class="o">-</span><span class="n">mnist</span><span class="o">-</span><span class="n">gpu</span> <span class="o">--</span><span class="n">namespace</span> <span class="n">default</span> <span class="o">-</span><span class="n">p</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
----------------------------------------
SENDING NEW REQUEST:

[[0.798 0.827 0.034 0.384 0.938 0.036 0.135 0.555 0.86  0.263 0.411 0.894
  0.327 0.865 0.906 0.914 0.133 0.565 0.803 0.417 0.825 0.678 0.805 0.206
  0.017 0.698 0.41  0.503 0.984 0.214 0.468 0.366 0.132 0.973 0.472 0.346
  0.001 0.662 0.412 0.537 0.522 0.242 0.289 0.676 0.379 0.542 0.452 0.467
  0.392 1.    0.771 0.442 0.352 0.505 0.259 0.505 0.664 0.942 0.457 0.417
  0.895 0.42  0.322 0.885 0.578 0.528 0.222 0.283 0.137 0.605 0.915 0.182
  0.42  0.94  0.262 0.599 0.552 0.437 0.179 0.928 0.831 0.193 0.391 0.416
  0.315 0.012 0.815 0.925 0.52  0.773 0.93  0.673 0.757 0.979 0.151 0.459
  0.621 0.553 0.605 0.176 0.702 0.814 0.784 0.952 0.513 0.125 0.68  0.043
  0.377 0.67  0.466 0.824 0.245 0.221 0.324 0.749 0.182 0.992 0.243 0.855
  0.477 0.176 0.262 0.537 0.69  0.717 0.059 0.711 0.26  0.149 0.34  0.71
  0.041 0.623 0.447 0.319 0.089 0.954 0.435 0.267 0.416 0.275 0.923 0.254
  0.542 0.995 0.782 0.337 0.991 0.187 0.183 0.479 0.73  0.288 0.6   0.583
  0.392 0.389 0.572 0.281 0.016 0.097 0.745 0.161 0.053 0.994 0.998 0.21
  0.348 0.531 0.423 0.894 0.153 0.759 0.277 0.002 0.113 0.236 0.171 0.979
  0.315 0.171 0.217 0.328 0.995 0.231 0.134 0.69  0.468 0.437 0.536 0.198
  0.412 0.15  0.465 0.402 0.975 0.698 0.057 0.885 0.433 0.463 0.73  0.285
  0.429 0.068 0.942 0.367 0.96  0.042 0.383 0.498 0.563 0.606 0.139 0.148
  0.151 0.4   0.946 0.805 0.954 0.739 0.925 0.305 0.909 0.222 0.475 0.729
  0.679 0.43  0.7   0.085 0.103 0.3   0.073 0.263 0.472 0.998 0.615 0.218
  0.677 0.555 0.155 0.093 0.36  0.149 0.343 0.801 0.896 0.106 0.253 0.875
  0.245 0.853 0.909 0.958 0.362 0.663 0.674 0.298 0.139 0.118 0.242 0.282
  0.095 0.755 0.635 0.168 0.259 0.515 0.77  0.196 0.185 0.659 0.379 0.64
  0.351 0.184 0.723 0.639 0.893 0.132 0.833 0.377 0.486 0.262 0.091 0.694
  0.043 0.957 0.927 0.469 0.47  0.407 0.166 0.673 0.065 0.582 0.403 0.795
  0.39  0.991 0.723 0.863 0.347 0.612 0.63  0.628 0.298 0.398 0.788 0.491
  0.497 0.669 0.016 0.609 0.778 0.379 0.454 0.113 0.4   0.649 0.155 0.687
  0.317 0.248 0.044 0.933 0.615 0.335 0.022 0.661 0.582 0.418 0.053 0.924
  0.69  0.723 0.007 0.149 0.703 0.1   0.799 0.991 0.877 0.626 0.191 0.829
  0.07  0.814 0.989 0.664 0.192 0.849 0.611 0.78  0.397 0.281 0.688 0.876
  0.423 0.185 0.036 0.476 0.417 0.804 0.336 0.498 0.653 0.585 0.339 0.155
  0.438 0.781 0.321 0.462 0.595 0.324 0.463 0.065 0.655 0.534 0.01  0.906
  0.836 0.389 0.457 0.629 0.831 0.145 0.082 0.889 0.231 0.075 0.404 0.408
  0.035 0.226 0.371 0.961 0.907 0.366 0.937 0.818 0.373 0.813 0.645 0.009
  0.16  0.797 0.81  0.48  0.76  0.464 0.127 0.842 0.531 0.362 0.546 0.95
  0.788 0.069 0.276 0.79  0.287 0.64  0.797 0.262 0.132 0.317 0.766 0.759
  0.714 0.642 0.601 0.482 0.529 0.43  0.934 0.07  0.137 0.794 0.5   0.065
  0.157 0.672 0.858 0.336 0.991 0.054 0.352 0.163 0.981 0.481 0.29  0.3
  0.38  0.136 0.911 0.231 0.556 0.798 0.496 0.407 0.237 0.474 0.676 0.356
  0.757 0.954 0.217 0.165 0.948 0.746 0.986 0.501 0.216 0.638 0.398 0.863
  0.462 0.924 0.889 0.448 0.325 0.922 0.895 0.331 0.491 0.626 0.207 0.133
  0.68  0.304 0.126 0.835 0.233 0.485 0.217 0.405 0.44  0.124 0.71  0.332
  0.546 0.58  0.151 0.447 0.104 0.206 0.257 0.053 0.716 0.804 0.67  0.789
  0.804 0.473 0.008 0.318 0.033 0.381 0.634 0.407 0.659 0.62  0.497 0.689
  0.83  0.384 0.67  0.911 0.101 0.668 0.355 0.579 0.111 0.446 0.596 0.814
  0.318 0.355 0.07  0.542 0.017 0.21  0.327 0.599 0.059 0.252 0.951 0.56
  0.367 0.813 0.074 0.964 0.079 0.68  0.446 0.019 0.7   0.903 0.918 0.74
  0.22  0.241 0.656 0.283 0.625 0.209 0.154 0.862 0.254 0.151 0.323 0.789
  0.393 0.023 0.668 0.55  0.408 0.54  0.207 0.064 0.844 0.323 0.216 0.688
  0.273 0.71  0.542 0.32  0.277 0.535 0.621 0.014 0.272 0.235 0.959 0.067
  0.027 0.585 0.001 0.853 0.189 0.687 0.059 0.284 0.419 0.995 0.151 0.391
  0.184 0.741 0.752 0.956 0.646 0.84  0.619 0.993 0.37  0.499 0.491 0.318
  0.782 0.724 0.748 0.552 0.485 0.667 0.206 0.813 0.511 0.128 0.936 0.33
  0.937 0.484 0.157 0.878 0.834 0.133 0.809 0.977 0.567 0.366 0.964 0.535
  0.678 0.64  0.076 0.866 0.211 0.853 0.619 0.103 0.433 0.667 0.73  0.136
  0.519 0.612 0.184 0.044 0.448 0.233 0.885 0.38  0.172 0.804 0.106 0.724
  0.107 0.619 0.554 0.548 0.812 0.587 0.577 0.417 0.962 0.774 0.364 0.485
  0.881 0.533 0.714 0.52  0.963 0.718 0.651 0.375 0.889 0.239 0.148 0.715
  0.551 0.768 0.073 0.599 0.671 0.947 0.059 0.453 0.356 0.271 0.156 0.096
  0.975 0.454 0.594 0.605 0.689 0.151 0.823 0.286 0.107 0.031 0.59  0.801
  0.847 0.291 0.516 0.977 0.883 0.169 0.848 0.954 0.371 0.632 0.313 0.397
  0.944 0.937 0.051 0.193 0.221 0.446 0.327 0.456 0.619 0.924 0.326 0.848
  0.496 0.515 0.668 0.703 0.942 0.712 0.533 0.656 0.691 0.669 0.407 0.42
  0.659 0.933 1.    0.244 0.566 0.613 0.747 0.896 0.236 0.355 0.338 0.243
  0.069 0.416 0.684 0.923 0.392 0.654 0.523 0.38  0.319 0.327 0.522 0.985
  0.01  0.316 0.938 0.907]]
RECEIVED RESPONSE:
meta {
  puid: "14k74obmqhus06jl6pai9hcg7r"
  requestPath {
    key: "classifier"
    value: "gcr.io/dev-joel/deep-mnist-gpu:0.1"
  }
}
data {
  names: "class:0"
  names: "class:1"
  names: "class:2"
  names: "class:3"
  names: "class:4"
  names: "class:5"
  names: "class:6"
  names: "class:7"
  names: "class:8"
  names: "class:9"
  ndarray {
    values {
      list_value {
        values {
          number_value: 0.0025008211378008127
        }
        values {
          number_value: 7.924897005295861e-08
        }
        values {
          number_value: 0.057240355759859085
        }
        values {
          number_value: 0.21792393922805786
        }
        values {
          number_value: 6.878228759887861e-06
        }
        values {
          number_value: 0.5588285326957703
        }
        values {
          number_value: 0.0005614690016955137
        }
        values {
          number_value: 0.0004520844086073339
        }
        values {
          number_value: 0.161981999874115
        }
        values {
          number_value: 0.0005038614035584033
        }
      }
    }
  }
}


</pre></div></div>
</div>
</section>
<section id="Clean-up">
<h2 id="Clean-up">Clean up<a class="headerlink" href="#Clean-up" title="Permalink to this heading">¶</a></h2>
<p>Make sure you delete the cluster once you have finished with it to avoid any ongoing charges.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>gcloud<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>delete<span class="w"> </span>&lt;YOUR_CLUSTER_NAME&gt;
</pre></div>
</div>
</div>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="azure_aks_deep_mnist.html" title="Azure Kubernetes Service (AKS) Deep MNIST"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> "Previous" </span> Azure Kubernetes Service (AKS) Deep MNIST </span>
              </div>
            </a>
          
          
            <a href="alibaba_ack_deep_mnist.html" title="Alibaba Cloud Container Service for Kubernetes (ACK) Deep MNIST Example"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> "Next" </span> Alibaba Cloud Container Service for Kubernetes (ACK) Deep MNIST Example </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2024, Seldon Technologies Ltd.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>